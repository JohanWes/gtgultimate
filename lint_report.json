[{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\api\\_lib\\mongodb.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[496,499],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[496,499],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[593,596],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[593,596],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[677,680],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[677,680],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { MongoClient } from 'mongodb';\r\n\r\nif (!process.env.MONGODB_URI) {\r\n    throw new Error('Invalid/Missing environment variable: \"MONGODB_URI\"');\r\n}\r\n\r\nconst uri = process.env.MONGODB_URI;\r\nconst options = {};\r\n\r\nlet client;\r\nlet clientPromise: Promise<MongoClient>;\r\n\r\nif (process.env.NODE_ENV === 'development') {\r\n    // In development mode, use a global variable so that the value\r\n    // is preserved across module reloads caused by HMR (Hot Module Replacement).\r\n    if (!(global as any)._mongoClientPromise) {\r\n        client = new MongoClient(uri, options);\r\n        (global as any)._mongoClientPromise = client.connect();\r\n    }\r\n    clientPromise = (global as any)._mongoClientPromise;\r\n} else {\r\n    // In production mode, it's best to not use a global variable.\r\n    client = new MongoClient(uri, options);\r\n    clientPromise = client.connect();\r\n}\r\n\r\nexport default clientPromise;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\api\\admin\\add-game.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":34,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":19},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":34,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":34,"endColumn":24,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1154,1155],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport clientPromise from '../_lib/mongodb.js';\r\nimport crypto from 'crypto';\r\nimport type { VercelRequest, VercelResponse } from '@vercel/node';\r\n\r\nfunction generateCropPositions(count: number) {\r\n    return Array.from({ length: count }, () => ({\r\n        x: Math.floor(Math.random() * 100),\r\n        y: Math.floor(Math.random() * 100),\r\n    }));\r\n}\r\n\r\nexport default async function handler(req: VercelRequest, res: VercelResponse) {\r\n    if (req.method !== 'POST') {\r\n        return res.status(405).json({ error: 'Method not allowed' });\r\n    }\r\n\r\n    // 1. Authentication\r\n    const adminKey = req.headers['x-admin-key'];\r\n    const envKey = process.env.ADMIN_KEY;\r\n\r\n    if (!envKey) {\r\n        return res.status(500).json({ error: 'Server misconfiguration: ADMIN_KEY not set' });\r\n    }\r\n\r\n    let authorized = false;\r\n    if (adminKey && envKey) {\r\n        try {\r\n            const bufferA = Buffer.from(adminKey as string);\r\n            const bufferB = Buffer.from(envKey);\r\n            if (bufferA.length === bufferB.length && crypto.timingSafeEqual(bufferA, bufferB)) {\r\n                authorized = true;\r\n            }\r\n        } catch (e) { }\r\n    }\r\n\r\n    if (!authorized) {\r\n        return res.status(401).json({ error: 'Unauthorized' });\r\n    }\r\n\r\n    const { gameData, selectedScreenshots } = req.body;\r\n    if (!gameData || !selectedScreenshots || !Array.isArray(selectedScreenshots)) {\r\n        return res.status(400).json({ error: 'Invalid data' });\r\n    }\r\n\r\n    if (selectedScreenshots.length !== 5) {\r\n        return res.status(400).json({ error: 'Exactly 5 screenshots must be selected.' });\r\n    }\r\n\r\n    try {\r\n        const client = await clientPromise;\r\n        const db = client.db('guessthegame');\r\n\r\n        // Check availability (ID check)\r\n        const existingGame = await db.collection('games').findOne({ id: gameData.id });\r\n        if (existingGame) {\r\n            return res.status(409).json({ error: 'Game already exists (ID match).' });\r\n        }\r\n\r\n        const cropPositions = generateCropPositions(5);\r\n\r\n        const newGame = {\r\n            id: gameData.id,\r\n            name: gameData.name,\r\n            year: gameData.year,\r\n            platform: gameData.platform,\r\n            genre: gameData.genre,\r\n            rating: gameData.rating,\r\n            screenshots: selectedScreenshots,\r\n            cover: gameData.cover,\r\n            cropPositions: cropPositions,\r\n            createdAt: new Date() // Good practice for DB\r\n        };\r\n\r\n        await db.collection('games').insertOne(newGame);\r\n\r\n        console.log(`Admin added new game: ${newGame.name}`);\r\n        res.json({ success: true, game: newGame });\r\n\r\n    } catch (err) {\r\n        console.error('Error adding game:', err);\r\n        res.status(500).json({ error: 'Internal server error' });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\api\\admin\\delete-game.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":27,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport clientPromise from '../_lib/mongodb.js';\r\nimport crypto from 'crypto';\r\n\r\nimport type { VercelRequest, VercelResponse } from '@vercel/node';\r\n\r\nexport default async function handler(req: VercelRequest, res: VercelResponse) {\r\n    if (req.method !== 'POST') {\r\n        return res.status(405).json({ error: 'Method not allowed' });\r\n    }\r\n\r\n    const adminKey = req.headers['x-admin-key'];\r\n    const envKey = process.env.ADMIN_KEY;\r\n\r\n    if (!envKey) {\r\n        return res.status(500).json({ error: 'Server misconfiguration: ADMIN_KEY not set' });\r\n    }\r\n\r\n    let authorized = false;\r\n    if (adminKey && envKey) {\r\n        try {\r\n            const bufferA = Buffer.from(adminKey as string);\r\n            const bufferB = Buffer.from(envKey);\r\n            if (bufferA.length === bufferB.length && crypto.timingSafeEqual(bufferA, bufferB)) {\r\n                authorized = true;\r\n            }\r\n        } catch (e) {\r\n            // Ignore errors\r\n        }\r\n    }\r\n\r\n    if (!authorized) {\r\n        return res.status(401).json({ error: 'Unauthorized' });\r\n    }\r\n\r\n    const { id } = req.body;\r\n\r\n    if (!id) {\r\n        return res.status(400).json({ error: 'Missing id' });\r\n    }\r\n\r\n    try {\r\n        const client = await clientPromise;\r\n        const db = client.db('guessthegame');\r\n\r\n        const result = await db.collection('games').deleteOne({ id: id });\r\n\r\n        if (result.deletedCount === 0) {\r\n            return res.status(404).json({ error: 'Game not found' });\r\n        }\r\n\r\n        console.log(`Admin deleted game ${id}`);\r\n        res.json({ success: true });\r\n\r\n    } catch (err) {\r\n        console.error('Error deleting game:', err);\r\n        res.status(500).json({ error: 'Internal server error' });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\api\\admin\\migrate-screenshots.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\api\\admin\\request-game.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1189,1192],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1189,1192],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2217,2220],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2217,2220],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":88,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":88,"endColumn":19},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":88,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":88,"endColumn":24,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3152,3153],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":141,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5057,5060],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5057,5060],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport clientPromise from '../_lib/mongodb.js';\r\nimport crypto from 'crypto';\r\nimport type { VercelRequest, VercelResponse } from '@vercel/node';\r\nimport axios from 'axios';\r\nimport Fuse from 'fuse.js';\r\n\r\n// --- IGDB HELPER FUNCTIONS ---\r\n// Note: In a serverless environment, local variables like token check might not persist between cold starts,\r\n// but it's acceptable to re-authenticate occasionally.\r\nlet igdbToken: string | null = null;\r\nlet tokenExpiry = 0;\r\n\r\nasync function getIgdbAccessToken(): Promise<string> {\r\n    if (igdbToken && Date.now() < tokenExpiry) {\r\n        return igdbToken;\r\n    }\r\n\r\n    console.log('Authenticating with IGDB...');\r\n    try {\r\n        const response = await axios.post('https://id.twitch.tv/oauth2/token', null, {\r\n            params: {\r\n                client_id: process.env.VITE_IGDB_CLIENT_ID,\r\n                client_secret: process.env.VITE_IGDB_CLIENT_SECRET,\r\n                grant_type: 'client_credentials',\r\n            },\r\n        });\r\n        igdbToken = response.data.access_token;\r\n        tokenExpiry = Date.now() + (response.data.expires_in * 1000) - 60000; // Buffer of 1 min\r\n        return igdbToken;\r\n    } catch (error: any) {\r\n        console.error('Error getting access token:', error.response?.data || error.message);\r\n        throw new Error('Failed to authenticate with IGDB');\r\n    }\r\n}\r\n\r\nasync function searchIgdbGame(name: string, accessToken: string) {\r\n    const query = `\r\n        fields id, name, first_release_date, platforms.name, genres.name, aggregated_rating, rating, screenshots.url, cover.url, rating_count;\r\n        search \"${name.replace(/\"/g, '\\\\\"')}\";\r\n        limit 1;\r\n    `;\r\n\r\n    try {\r\n        const response = await axios.post(\r\n            'https://api.igdb.com/v4/games',\r\n            query,\r\n            {\r\n                headers: {\r\n                    'Client-ID': process.env.VITE_IGDB_CLIENT_ID,\r\n                    'Authorization': `Bearer ${accessToken}`,\r\n                    'Content-Type': 'text/plain',\r\n                },\r\n            }\r\n        );\r\n\r\n        if (response.data && response.data.length > 0) {\r\n            return response.data[0];\r\n        }\r\n        return null;\r\n    } catch (error: any) {\r\n        console.error(`Error searching for ${name}:`, error.response?.data || error.message);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport default async function handler(req: VercelRequest, res: VercelResponse) {\r\n    if (req.method !== 'POST') {\r\n        return res.status(405).json({ error: 'Method not allowed' });\r\n    }\r\n\r\n    // 1. Authentication\r\n    const adminKey = req.headers['x-admin-key'];\r\n    const envKey = process.env.ADMIN_KEY;\r\n\r\n    if (!envKey) {\r\n        return res.status(500).json({ error: 'Server misconfiguration: ADMIN_KEY not set' });\r\n    }\r\n\r\n    let authorized = false;\r\n    if (adminKey && envKey) {\r\n        try {\r\n            const bufferA = Buffer.from(adminKey as string);\r\n            const bufferB = Buffer.from(envKey);\r\n            if (bufferA.length === bufferB.length && crypto.timingSafeEqual(bufferA, bufferB)) {\r\n                authorized = true;\r\n            }\r\n        } catch (e) { }\r\n    }\r\n\r\n    if (!authorized) {\r\n        return res.status(401).json({ error: 'Unauthorized' });\r\n    }\r\n\r\n    const { name, skipCheck } = req.body;\r\n    if (!name) return res.status(400).json({ error: 'Missing name' });\r\n\r\n    try {\r\n        // 2. Duplicate Check with MongoDB + Fuse.js\r\n        if (!skipCheck) {\r\n            const client = await clientPromise;\r\n            const db = client.db('guessthegame');\r\n            // Fetch names only for efficiency? Or all data needed for Fuse? Fuse needs keys.\r\n            const allGames = await db.collection('games').find({}, { projection: { name: 1 } }).toArray();\r\n\r\n            const fuse = new Fuse(allGames, {\r\n                keys: ['name'],\r\n                threshold: 0.3,\r\n                includeScore: true\r\n            });\r\n\r\n            const results = fuse.search(name);\r\n            if (results.length > 0) {\r\n                const similarGames = results.map(r => r.item.name).slice(0, 5);\r\n                return res.status(409).json({\r\n                    error: 'Potential duplicates found',\r\n                    similarGames: similarGames\r\n                });\r\n            }\r\n        }\r\n\r\n        // 3. Fetch from IGDB\r\n        const token = await getIgdbAccessToken();\r\n        const gameData = await searchIgdbGame(name, token);\r\n\r\n        if (!gameData) {\r\n            return res.status(404).json({ error: `Game \"${name}\" not found on IGDB.` });\r\n        }\r\n\r\n        // 4. Process screenshots\r\n        const allScreenshots = gameData.screenshots || [];\r\n        if (allScreenshots.length < 5) {\r\n            return res.status(400).json({\r\n                error: `Found \"${gameData.name}\" but it only has ${allScreenshots.length} screenshots (minimum 5 required).`\r\n            });\r\n        }\r\n\r\n        // Return up to 10 screenshots\r\n        const screenshots = allScreenshots\r\n            .slice(0, 10)\r\n            .map((s: any) => s.url.replace('t_thumb', 't_720p').replace('//', 'https://'));\r\n\r\n        const cover = gameData.cover ? gameData.cover.url.replace('t_thumb', 't_cover_big').replace('//', 'https://') : null;\r\n\r\n        const responseData = {\r\n            id: gameData.id,\r\n            name: gameData.name,\r\n            year: gameData.first_release_date ? new Date(gameData.first_release_date * 1000).getFullYear() : 0,\r\n            platform: gameData.platforms ? gameData.platforms[0].name : 'Unknown',\r\n            genre: gameData.genres ? gameData.genres[0].name : 'Unknown',\r\n            rating: Math.round(gameData.aggregated_rating || gameData.rating || 0),\r\n            cover: cover,\r\n            availableScreenshots: screenshots\r\n        };\r\n\r\n        res.json(responseData);\r\n\r\n    } catch (err) {\r\n        console.error('Error requesting game:', err);\r\n        res.status(500).json({ error: 'Internal server error' });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\api\\admin\\search-local.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":22,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":19},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":22,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":22,"endColumn":24,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[799,800],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport clientPromise from '../_lib/mongodb.js';\r\nimport crypto from 'crypto';\r\nimport type { VercelRequest, VercelResponse } from '@vercel/node';\r\n\r\nexport default async function handler(req: VercelRequest, res: VercelResponse) {\r\n    if (req.method !== 'POST') {\r\n        return res.status(405).json({ error: 'Method not allowed' });\r\n    }\r\n\r\n    const adminKey = req.headers['x-admin-key'];\r\n    const envKey = process.env.ADMIN_KEY;\r\n\r\n    let authorized = false;\r\n    if (adminKey && envKey) {\r\n        try {\r\n            const bufferA = Buffer.from(adminKey as string);\r\n            const bufferB = Buffer.from(envKey);\r\n            if (bufferA.length === bufferB.length && crypto.timingSafeEqual(bufferA, bufferB)) {\r\n                authorized = true;\r\n            }\r\n        } catch (e) { }\r\n    }\r\n\r\n    if (!authorized) {\r\n        return res.status(401).json({ error: 'Unauthorized' });\r\n    }\r\n\r\n    const { query } = req.body;\r\n\r\n    try {\r\n        const client = await clientPromise;\r\n        const db = client.db('guessthegame');\r\n\r\n        if (!query) {\r\n            // Return top 50 if no query\r\n            const games = await db.collection('games')\r\n                .find({})\r\n                .limit(50)\r\n                .toArray();\r\n            return res.json(games);\r\n        }\r\n\r\n        // Use Regex for simple search \r\n        // Note: For large DBs, text index is better, but regex is fine for ~2600 items\r\n        const games = await db.collection('games')\r\n            .find({\r\n                name: { $regex: query, $options: 'i' }\r\n            })\r\n            .limit(50)\r\n            .toArray();\r\n\r\n        res.json(games);\r\n\r\n    } catch (err) {\r\n        console.error('Error searching games:', err);\r\n        res.status(500).json({ error: 'Internal server error' });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\api\\admin\\update-game.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":27,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1351,1354],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1351,1354],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport clientPromise from '../_lib/mongodb.js';\r\nimport crypto from 'crypto';\r\n\r\nimport type { VercelRequest, VercelResponse } from '@vercel/node';\r\n\r\nexport default async function handler(req: VercelRequest, res: VercelResponse) {\r\n    if (req.method !== 'POST') {\r\n        return res.status(405).json({ error: 'Method not allowed' });\r\n    }\r\n\r\n    const adminKey = req.headers['x-admin-key'];\r\n    const envKey = process.env.ADMIN_KEY;\r\n\r\n    if (!envKey) {\r\n        return res.status(500).json({ error: 'Server misconfiguration: ADMIN_KEY not set' });\r\n    }\r\n\r\n    let authorized = false;\r\n    if (adminKey && envKey) {\r\n        try {\r\n            const bufferA = Buffer.from(adminKey as string);\r\n            const bufferB = Buffer.from(envKey);\r\n            if (bufferA.length === bufferB.length && crypto.timingSafeEqual(bufferA, bufferB)) {\r\n                authorized = true;\r\n            }\r\n        } catch (e) {\r\n            // Ignore errors\r\n        }\r\n    }\r\n\r\n    if (!authorized) {\r\n        return res.status(401).json({ error: 'Unauthorized' });\r\n    }\r\n\r\n    const { id, name } = req.body;\r\n\r\n    if (!id || !name) {\r\n        return res.status(400).json({ error: 'Missing id or name' });\r\n    }\r\n\r\n    try {\r\n        const client = await clientPromise;\r\n        const db = client.db('guessthegame');\r\n\r\n        const updateFields: any = { name: name.trim() };\r\n        if (req.body.platform) updateFields.platform = req.body.platform.trim();\r\n        if (req.body.genre) updateFields.genre = req.body.genre.trim();\r\n\r\n        const result = await db.collection('games').updateOne(\r\n            { id: id },\r\n            { $set: updateFields }\r\n        );\r\n\r\n        if (result.matchedCount === 0) {\r\n            return res.status(404).json({ error: 'Game not found' });\r\n        }\r\n\r\n        console.log(`Admin update: Game ${id} renamed to ${name}`);\r\n        res.json({ success: true, message: 'Game updated' });\r\n\r\n    } catch (err) {\r\n        console.error('Error updating game:', err);\r\n        res.status(500).json({ error: 'Internal server error' });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\api\\admin\\verify.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":24,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import crypto from 'crypto';\r\n\r\nimport type { VercelRequest, VercelResponse } from '@vercel/node';\r\n\r\nexport default function handler(req: VercelRequest, res: VercelResponse) {\r\n    if (req.method !== 'POST') {\r\n        return res.status(405).json({ error: 'Method not allowed' });\r\n    }\r\n\r\n    const adminKey = req.headers['x-admin-key'];\r\n    const envKey = process.env.ADMIN_KEY;\r\n\r\n    if (!envKey) {\r\n        return res.status(500).json({ error: 'Server misconfiguration: ADMIN_KEY not set' });\r\n    }\r\n\r\n    if (adminKey && envKey) {\r\n        try {\r\n            const bufferA = Buffer.from(adminKey as string);\r\n            const bufferB = Buffer.from(envKey);\r\n            if (bufferA.length === bufferB.length && crypto.timingSafeEqual(bufferA, bufferB)) {\r\n                return res.status(200).json({ success: true });\r\n            }\r\n        } catch (e) {\r\n            // Ignore errors, auth failed\r\n        }\r\n    }\r\n\r\n    return res.status(401).json({ error: 'Invalid admin key' });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\api\\games.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_id' is assigned a value but never used.","line":17,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport clientPromise from './_lib/mongodb.js';\r\n\r\nexport default async function handler(req, res) {\r\n    if (req.method !== 'GET') {\r\n        return res.status(405).json({ error: 'Method not allowed' });\r\n    }\r\n\r\n    try {\r\n        const client = await clientPromise;\r\n        const db = client.db('guessthegame');\r\n\r\n        const games = await db.collection('games').find({}).toArray();\r\n\r\n        // Remove MongoDB internal _id field to keep client cleaner\r\n        const cleanGames = games.map(game => {\r\n            const { _id, ...rest } = game;\r\n            return rest;\r\n        });\r\n\r\n        res.status(200).json(cleanGames);\r\n    } catch (error) {\r\n        console.error('API Error:', error);\r\n        res.status(500).json({ error: 'Internal Server Error' });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\api\\highscores.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\api\\image-proxy.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":23,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport type { VercelRequest, VercelResponse } from '@vercel/node';\r\nimport sharp from 'sharp';\r\nimport axios from 'axios';\r\n\r\nconst ALLOWED_IMAGE_HOSTS = ['images.igdb.com'];\r\n\r\nexport default async function handler(req: VercelRequest, res: VercelResponse) {\r\n    const { url, x, y, zoom } = req.query;\r\n\r\n    if (!url || Array.isArray(url)) {\r\n        return res.status(400).json({ error: 'Missing or invalid url parameter' });\r\n    }\r\n\r\n    const decodedUrl = decodeURIComponent(url as string);\r\n\r\n    // SSRF Protection: Validate Host\r\n    try {\r\n        const parsedUrl = new URL(decodedUrl);\r\n        if (!ALLOWED_IMAGE_HOSTS.includes(parsedUrl.hostname)) {\r\n            return res.status(403).json({ error: 'Domain not allowed' });\r\n        }\r\n    } catch (e) {\r\n        return res.status(400).json({ error: 'Invalid URL' });\r\n    }\r\n\r\n    try {\r\n        const response = await axios({\r\n            url: decodedUrl,\r\n            responseType: 'arraybuffer'\r\n        });\r\n\r\n        const buffer = Buffer.from(response.data);\r\n\r\n        // If no crop parameters, return original image\r\n        if (!x || !y || !zoom || parseFloat(zoom as string) <= 100) {\r\n            res.setHeader('Content-Type', response.headers['content-type']);\r\n            res.setHeader('Cache-Control', 'public, max-age=31536000'); // Cache for 1 year\r\n            return res.send(buffer);\r\n        }\r\n\r\n        // Apply cropping\r\n        const image = sharp(buffer);\r\n        const metadata = await image.metadata();\r\n        const width = metadata.width || 0;\r\n        const height = metadata.height || 0;\r\n\r\n        const zoomVal = parseFloat(zoom as string);\r\n        const xPos = parseFloat(x as string);\r\n        const yPos = parseFloat(y as string);\r\n\r\n        // Logical logic for crop (same as prod-server.js)\r\n        const scale = zoomVal / 100;\r\n        const cropWidth = Math.round(width / scale);\r\n        const cropHeight = Math.round(height / scale);\r\n\r\n        const maxScrollX = width - cropWidth;\r\n        const maxScrollY = height - cropHeight;\r\n\r\n        let cropX = Math.round(maxScrollX * (xPos / 100));\r\n        let cropY = Math.round(maxScrollY * (yPos / 100));\r\n\r\n        // Clamp values\r\n        cropX = Math.max(0, Math.min(cropX, maxScrollX));\r\n        cropY = Math.max(0, Math.min(cropY, maxScrollY));\r\n\r\n        const croppedImage = await image\r\n            .extract({ left: cropX, top: cropY, width: cropWidth, height: cropHeight })\r\n            .toBuffer();\r\n\r\n        res.setHeader('Content-Type', response.headers['content-type']);\r\n        res.setHeader('Cache-Control', 'public, max-age=86400'); // 1 day\r\n        res.send(croppedImage);\r\n\r\n    } catch (err) {\r\n        console.error('Error proxying image:', err);\r\n        res.status(500).json({ error: 'Failed to proxy image' });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\api\\run\\[id].ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[94,97],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[94,97],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[104,107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[104,107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[588,591],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[588,591],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import clientPromise from '../_lib/mongodb.js';\r\n\r\nexport default async function handler(req: any, res: any) {\r\n    if (req.method !== 'GET') {\r\n        return res.status(405).json({ error: 'Method not allowed' });\r\n    }\r\n\r\n    const { id } = req.query;\r\n\r\n    if (!id || typeof id !== 'string') {\r\n        return res.status(400).json({ error: 'Invalid ID' });\r\n    }\r\n\r\n    try {\r\n        const client = await clientPromise;\r\n        const db = client.db('guessthegame');\r\n        const collection = db.collection('runs');\r\n\r\n        const run = await collection.findOne({ _id: id } as any);\r\n\r\n        if (!run) {\r\n            return res.status(404).json({ error: 'Run not found' });\r\n        }\r\n\r\n        // Run data is immutable once saved, cache for 1 hour\r\n        res.setHeader('Cache-Control', 's-maxage=3600, stale-while-revalidate');\r\n        return res.status(200).json(run);\r\n    } catch (error) {\r\n        console.error('Get Run API Error:', error);\r\n        return res.status(500).json({ error: 'Internal Server Error' });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\api\\run\\save.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[132,135],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[132,135],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[142,145],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[142,145],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[726,729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[726,729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import clientPromise from '../_lib/mongodb.js';\r\nimport { randomUUID } from 'crypto';\r\n\r\nexport default async function handler(req: any, res: any) {\r\n    if (req.method !== 'POST') {\r\n        return res.status(405).json({ error: 'Method not allowed' });\r\n    }\r\n\r\n    try {\r\n        const { history, totalScore, totalGames } = req.body;\r\n\r\n        if (!history || !Array.isArray(history)) {\r\n            return res.status(400).json({ error: 'Invalid data' });\r\n        }\r\n\r\n        const client = await clientPromise;\r\n        const db = client.db('guessthegame');\r\n        const collection = db.collection('runs');\r\n\r\n        const runId = randomUUID().substring(0, 8); // Short ID for shareability\r\n\r\n        const runData: any = {\r\n            _id: runId, // Use custom short ID as _id\r\n            history,\r\n            totalScore,\r\n            totalGames,\r\n            createdAt: new Date().toISOString()\r\n        };\r\n\r\n        await collection.insertOne(runData);\r\n\r\n        return res.status(201).json({ id: runId });\r\n    } catch (error) {\r\n        console.error('Save Run API Error:', error);\r\n        return res.status(500).json({ error: 'Internal Server Error' });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\lib\\mongodb.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[496,499],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[496,499],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[593,596],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[593,596],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[677,680],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[677,680],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { MongoClient } from 'mongodb';\r\n\r\nif (!process.env.MONGODB_URI) {\r\n    throw new Error('Invalid/Missing environment variable: \"MONGODB_URI\"');\r\n}\r\n\r\nconst uri = process.env.MONGODB_URI;\r\nconst options = {};\r\n\r\nlet client;\r\nlet clientPromise: Promise<MongoClient>;\r\n\r\nif (process.env.NODE_ENV === 'development') {\r\n    // In development mode, use a global variable so that the value\r\n    // is preserved across module reloads caused by HMR (Hot Module Replacement).\r\n    if (!(global as any)._mongoClientPromise) {\r\n        client = new MongoClient(uri, options);\r\n        (global as any)._mongoClientPromise = client.connect();\r\n    }\r\n    clientPromise = (global as any)._mongoClientPromise;\r\n} else {\r\n    // In production mode, it's best to not use a global variable.\r\n    client = new MongoClient(uri, options);\r\n    clientPromise = client.connect();\r\n}\r\n\r\nexport default clientPromise;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\prod-server.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\scripts\\analyze_platforms.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\scripts\\extract_synopses.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\scripts\\extract_titles.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[665,668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[665,668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import fs from 'fs/promises';\r\nimport path from 'path';\r\nimport { fileURLToPath } from 'url';\r\n\r\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\r\nconst GAMES_DB_PATH = path.join(__dirname, '../data/games_db.json');\r\nconst TITLES_OUTPUT_PATH = path.join(__dirname, '../titles.txt');\r\n\r\nasync function extractTitles() {\r\n    try {\r\n        console.log('Reading games databases...');\r\n        const gamesData = await fs.readFile(GAMES_DB_PATH, 'utf-8');\r\n\r\n        const games = JSON.parse(gamesData);\r\n\r\n        console.log(`Found ${games.length} main games.`);\r\n\r\n        // Extract names from main games\r\n        const mainTitles = games.map((game: any) => game.name);\r\n\r\n        // Combine with bait games\r\n        const allTitles = [...mainTitles];\r\n\r\n        // Sort alphabetically (optional but nice)\r\n        allTitles.sort((a, b) => a.localeCompare(b));\r\n\r\n        const outputContent = allTitles.join('\\n');\r\n\r\n        await fs.writeFile(TITLES_OUTPUT_PATH, outputContent);\r\n        console.log(`Successfully extracted ${allTitles.length} total titles to ${TITLES_OUTPUT_PATH}`);\r\n    } catch (error) {\r\n        console.error('Error extracting titles:', error);\r\n    }\r\n}\r\n\r\nextractTitles();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\scripts\\fetch_games.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1774,1777],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1774,1777],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2108,2111],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2108,2111],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":103,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":103,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":103,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3294,3297],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3294,3297],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":122,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":122,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":126,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4001,4004],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4001,4004],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":131,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":131,"endColumn":19}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport fs from 'fs/promises';\r\nimport path from 'path';\r\nimport axios from 'axios';\r\nimport { fileURLToPath } from 'url';\r\nimport dotenv from 'dotenv';\r\n\r\n// Load environment variables from .env file\r\ndotenv.config();\r\n\r\nconst CLIENT_ID = process.env.VITE_IGDB_CLIENT_ID;\r\nconst CLIENT_SECRET = process.env.VITE_IGDB_CLIENT_SECRET;\r\n\r\n// Validate that required environment variables are set\r\nif (!CLIENT_ID || !CLIENT_SECRET) {\r\n    console.error('Error: Missing required environment variables.');\r\n    console.error('Please create a .env file with VITE_IGDB_CLIENT_ID and VITE_IGDB_CLIENT_SECRET');\r\n    console.error('See .env.example for reference.');\r\n    process.exit(1);\r\n}\r\n\r\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\r\nconst GAMES_LIST_PATH = path.join(__dirname, '../games.json');\r\nconst OUTPUT_FILE = path.join(__dirname, '../data/games_db.json');\r\nconst OUTPUT_FILE = path.join(__dirname, '../data/games_db.json');\r\n\r\ninterface GameEntry {\r\n    name: string;\r\n    year?: number;\r\n}\r\n\r\ninterface IGDBGame {\r\n    id: number;\r\n    name: string;\r\n    first_release_date?: number;\r\n    platforms?: { name: string }[];\r\n    genres?: { name: string }[];\r\n    aggregated_rating?: number;\r\n    rating?: number;\r\n    screenshots?: { url: string }[];\r\n    cover?: { url: string };\r\n    rating_count?: number;\r\n}\r\n\r\nasync function getAccessToken() {\r\n    console.log('Authenticating with IGDB...');\r\n    try {\r\n        const response = await axios.post('https://id.twitch.tv/oauth2/token', null, {\r\n            params: {\r\n                client_id: CLIENT_ID,\r\n                client_secret: CLIENT_SECRET,\r\n                grant_type: 'client_credentials',\r\n            },\r\n        });\r\n        return response.data.access_token;\r\n    } catch (error: any) {\r\n        console.error('Error getting access token:', error.response?.data || error.message);\r\n        process.exit(1);\r\n    }\r\n}\r\n\r\nasync function parseGamesList(): Promise<GameEntry[]> {\r\n    const content = await fs.readFile(GAMES_LIST_PATH, 'utf-8');\r\n    const rawGames = JSON.parse(content);\r\n    return rawGames.map((g: any) => ({\r\n        name: g.gamename,\r\n        year: g.releaseyear\r\n    }));\r\n}\r\n\r\nasync function searchGame(name: string, year: number | undefined, accessToken: string): Promise<IGDBGame | null> {\r\n    let query = `\r\n        fields name, first_release_date, platforms.name, genres.name, aggregated_rating, rating, screenshots.url, cover.url, rating_count;\r\n        search \"${name.replace(/\"/g, '\\\\\"')}\";\r\n        limit 1;\r\n    `;\r\n\r\n    if (year) {\r\n        query += `where release_dates.y = ${year};`;\r\n    }\r\n\r\n    try {\r\n        const response = await axios.post(\r\n            'https://api.igdb.com/v4/games',\r\n            query,\r\n            {\r\n                headers: {\r\n                    'Client-ID': CLIENT_ID,\r\n                    'Authorization': `Bearer ${accessToken}`,\r\n                    'Content-Type': 'text/plain',\r\n                },\r\n            }\r\n        );\r\n\r\n        if (response.data && response.data.length > 0) {\r\n            return response.data[0];\r\n        }\r\n\r\n        // Fallback: Try searching without year if strict match fails, but check year manually\r\n        // Or just return null for now to be safe\r\n        return null;\r\n\r\n    } catch (error: any) {\r\n        // console.error(`Error searching for ${name}:`, error.response?.data || error.message);\r\n        return null;\r\n    }\r\n}\r\n\r\nfunction generateCropPositions(count: number) {\r\n    return Array.from({ length: count }, () => ({\r\n        x: Math.floor(Math.random() * 100),\r\n        y: Math.floor(Math.random() * 100),\r\n    }));\r\n}\r\n\r\nasync function main() {\r\n    const token = await getAccessToken();\r\n    let gamesList: GameEntry[] = [];\r\n    try {\r\n        gamesList = await parseGamesList();\r\n        console.log(`Found ${gamesList.length} games in games.json`);\r\n    } catch (error) {\r\n        console.log('games.json not found, skipping main list update.');\r\n    }\r\n\r\n    let existingGames: any[] = [];\r\n    try {\r\n        const existingContent = await fs.readFile(OUTPUT_FILE, 'utf-8');\r\n        existingGames = JSON.parse(existingContent);\r\n        console.log(`Loaded ${existingGames.length} existing games from DB.`);\r\n    } catch (error) {\r\n        console.log('No existing DB found, starting fresh.');\r\n    }\r\n\r\n\r\n\r\n    const processedGames = [...existingGames];\r\n    const existingNames = new Set(existingGames.map(g => g.name.toLowerCase()));\r\n    const existingNames = new Set(existingGames.map(g => g.name.toLowerCase()));\r\n\r\n    let foundCount = 0;\r\n    let missingCount = 0;\r\n    let skippedCount = 0;\r\n\r\n    // Process in chunks to avoid rate limits (4 requests per second is the limit, let's be safe with serial or small batches)\r\n    // Serial for simplicity and safety\r\n    for (const gameEntry of gamesList) {\r\n        const lowerName = gameEntry.name.toLowerCase();\r\n\r\n        if (existingNames.has(lowerName)) {\r\n            // console.log(`Skipping ${gameEntry.name} (already exists in DB)`);\r\n            skippedCount++;\r\n            continue;\r\n        }\r\n\r\n        // if (baitNames.has(lowerName)) {\r\n        //     console.log(`Skipping ${gameEntry.name} (exists in bait games)`);\r\n        //     skippedCount++;\r\n        //     continue;\r\n        // }\r\n\r\n        // Rate limit delay (250ms = 4 req/s)\r\n        await new Promise(resolve => setTimeout(resolve, 300));\r\n\r\n        process.stdout.write(`Fetching ${gameEntry.name} (${gameEntry.year})... `);\r\n        const gameData = await searchGame(gameEntry.name, gameEntry.year, token);\r\n\r\n        if (gameData) {\r\n            // Process screenshots\r\n            const allScreenshots = gameData.screenshots || [];\r\n            // Prefer 1080p/720p, but IGDB returns thumbnails by default in URL. \r\n            // We need to replace 't_thumb' with 't_720p' or 't_1080p'.\r\n\r\n            if (allScreenshots.length < 5) {\r\n                console.log('Skipped (not enough screenshots)');\r\n                missingCount++;\r\n                continue;\r\n            }\r\n\r\n            const screenshots = allScreenshots\r\n                .slice(0, 5)\r\n                .map(s => s.url.replace('t_thumb', 't_720p').replace('//', 'https://'));\r\n\r\n            const cropPositions = generateCropPositions(screenshots.length);\r\n\r\n            processedGames.push({\r\n                id: gameData.id,\r\n                name: gameData.name,\r\n                year: gameEntry.year, // Use our year as source of truth for display if needed, or API's\r\n                platform: gameData.platforms ? gameData.platforms[0].name : 'Unknown',\r\n                genre: gameData.genres ? gameData.genres[0].name : 'Unknown',\r\n                rating: Math.round(gameData.aggregated_rating || gameData.rating || 0),\r\n                screenshots: screenshots,\r\n                cover: gameData.cover ? gameData.cover.url.replace('t_thumb', 't_cover_big').replace('//', 'https://') : null,\r\n                cropPositions: cropPositions\r\n            });\r\n            console.log('Found!');\r\n            foundCount++;\r\n        } else {\r\n            console.log('Not found.');\r\n            missingCount++;\r\n        }\r\n    }\r\n\r\n\r\n\r\n    await fs.writeFile(OUTPUT_FILE, JSON.stringify(processedGames, null, 2));\r\n    console.log(`\\nFinished! Saved ${processedGames.length} games to ${OUTPUT_FILE}`);\r\n    console.log(`Found: ${foundCount}, Missing: ${missingCount}, Skipped: ${skippedCount}`);\r\n}\r\n\r\nmain();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\scripts\\fetch_synopses.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2286,2289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2286,2289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Fetch Synopses Migration Script\r\n * \r\n * Iterates through all games in games_db.json and fetches the 'summary' field\r\n * from IGDB, appending it to each game object.\r\n * \r\n * Usage: npx tsx scripts/fetch_synopses.ts\r\n */\r\n\r\nimport fs from 'fs/promises';\r\nimport path from 'path';\r\nimport axios from 'axios';\r\nimport { fileURLToPath } from 'url';\r\nimport dotenv from 'dotenv';\r\n\r\ndotenv.config();\r\n\r\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\r\nconst GAMES_DB_PATH = path.join(__dirname, '../data/games_db.json');\r\nconst BACKUP_PATH = path.join(__dirname, '../data/games_db.backup.json');\r\n\r\nconst CLIENT_ID = process.env.VITE_IGDB_CLIENT_ID;\r\nconst CLIENT_SECRET = process.env.VITE_IGDB_CLIENT_SECRET;\r\n\r\n// IGDB allows batching up to 500 IDs per request\r\nconst BATCH_SIZE = 50;\r\nconst RATE_LIMIT_DELAY = 300; // ms between requests\r\n\r\ninterface Game {\r\n    id: number;\r\n    name: string;\r\n    synopsis?: string;\r\n    [key: string]: unknown;\r\n}\r\n\r\nasync function getAccessToken(): Promise<string> {\r\n    console.log(' Authenticating with IGDB...');\r\n    const response = await axios.post('https://id.twitch.tv/oauth2/token', null, {\r\n        params: {\r\n            client_id: CLIENT_ID,\r\n            client_secret: CLIENT_SECRET,\r\n            grant_type: 'client_credentials',\r\n        },\r\n    });\r\n    console.log(' Authenticated successfully\\n');\r\n    return response.data.access_token;\r\n}\r\n\r\nasync function fetchSynopsesForIds(ids: number[], token: string): Promise<Map<number, string>> {\r\n    const query = `\r\n        fields id, summary;\r\n        where id = (${ids.join(',')});\r\n        limit ${ids.length};\r\n    `;\r\n\r\n    try {\r\n        const response = await axios.post(\r\n            'https://api.igdb.com/v4/games',\r\n            query,\r\n            {\r\n                headers: {\r\n                    'Client-ID': CLIENT_ID,\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'text/plain',\r\n                },\r\n            }\r\n        );\r\n\r\n        const synopsisMap = new Map<number, string>();\r\n        for (const game of response.data) {\r\n            if (game.summary) {\r\n                synopsisMap.set(game.id, game.summary);\r\n            }\r\n        }\r\n        return synopsisMap;\r\n    } catch (error: any) {\r\n        console.error(` Error fetching batch:`, error.response?.data || error.message);\r\n        return new Map();\r\n    }\r\n}\r\n\r\nasync function main() {\r\n    if (!CLIENT_ID || !CLIENT_SECRET) {\r\n        console.error(' Missing IGDB credentials in .env file');\r\n        process.exit(1);\r\n    }\r\n\r\n    // Load games database\r\n    console.log(' Loading games database...');\r\n    const gamesData = await fs.readFile(GAMES_DB_PATH, 'utf-8');\r\n    const games: Game[] = JSON.parse(gamesData);\r\n    console.log(`   Found ${games.length} games\\n`);\r\n\r\n    // Create backup\r\n    console.log(' Creating backup...');\r\n    await fs.writeFile(BACKUP_PATH, gamesData);\r\n    console.log(`   Backup saved to: ${BACKUP_PATH}\\n`);\r\n\r\n    // Filter games that don't already have a synopsis\r\n    const gamesNeedingSynopsis = games.filter(g => !g.synopsis);\r\n    console.log(` Games needing synopsis: ${gamesNeedingSynopsis.length}`);\r\n    console.log(`   Games already with synopsis: ${games.length - gamesNeedingSynopsis.length}\\n`);\r\n\r\n    if (gamesNeedingSynopsis.length === 0) {\r\n        console.log(' All games already have synopses. Nothing to do!');\r\n        return;\r\n    }\r\n\r\n    // Get access token\r\n    const token = await getAccessToken();\r\n\r\n    // Process in batches\r\n    const totalBatches = Math.ceil(gamesNeedingSynopsis.length / BATCH_SIZE);\r\n    let fetchedCount = 0;\r\n    let missingCount = 0;\r\n\r\n    // Create a map for quick lookup\r\n    const synopsisMap = new Map<number, string>();\r\n\r\n    console.log(` Fetching synopses in ${totalBatches} batches of ${BATCH_SIZE}...\\n`);\r\n\r\n    for (let i = 0; i < gamesNeedingSynopsis.length; i += BATCH_SIZE) {\r\n        const batch = gamesNeedingSynopsis.slice(i, i + BATCH_SIZE);\r\n        const batchIds = batch.map(g => g.id);\r\n        const batchNum = Math.floor(i / BATCH_SIZE) + 1;\r\n\r\n        process.stdout.write(`   Batch ${batchNum}/${totalBatches} (IDs: ${batchIds.length})... `);\r\n\r\n        const batchSynopses = await fetchSynopsesForIds(batchIds, token);\r\n\r\n        // Merge into main map\r\n        for (const [id, synopsis] of batchSynopses) {\r\n            synopsisMap.set(id, synopsis);\r\n        }\r\n\r\n        const foundInBatch = batchSynopses.size;\r\n        const missingInBatch = batchIds.length - foundInBatch;\r\n        fetchedCount += foundInBatch;\r\n        missingCount += missingInBatch;\r\n\r\n        console.log(`Found: ${foundInBatch}, Missing: ${missingInBatch}`);\r\n\r\n        // Rate limit delay\r\n        if (i + BATCH_SIZE < gamesNeedingSynopsis.length) {\r\n            await new Promise(resolve => setTimeout(resolve, RATE_LIMIT_DELAY));\r\n        }\r\n    }\r\n\r\n    // Apply synopses to games array\r\n    console.log('\\n Applying synopses to games...');\r\n    for (const game of games) {\r\n        const synopsis = synopsisMap.get(game.id);\r\n        if (synopsis) {\r\n            game.synopsis = synopsis;\r\n        }\r\n    }\r\n\r\n    // Save updated database\r\n    console.log(' Saving updated database...');\r\n    await fs.writeFile(GAMES_DB_PATH, JSON.stringify(games, null, 2));\r\n\r\n    // Summary\r\n    console.log('\\n' + '='.repeat(50));\r\n    console.log(' MIGRATION COMPLETE');\r\n    console.log('='.repeat(50));\r\n    console.log(`   Total games: ${games.length}`);\r\n    console.log(`   Synopses fetched: ${fetchedCount}`);\r\n    console.log(`   Games without synopsis: ${missingCount}`);\r\n    console.log(`   Backup location: ${BACKUP_PATH}`);\r\n    console.log('='.repeat(50));\r\n}\r\n\r\nmain().catch(err => {\r\n    console.error('Fatal error:', err);\r\n    process.exit(1);\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\scripts\\master_cleanup.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'gamesDbRaw' is never reassigned. Use 'const' instead.","line":41,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":41,"endColumn":19,"fix":{"range":[1653,1712],"text":"const gamesDbRaw = await fs.readFile(GAMES_DB_PATH, 'utf-8');"}},{"ruleId":"prefer-const","severity":2,"message":"'gamesDb' is never reassigned. Use 'const' instead.","line":43,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":43,"endColumn":16,"fix":{"range":[1720,1757],"text":"const gamesDb = JSON.parse(gamesDbRaw);"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2014,2017],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2014,2017],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'newName' is never reassigned. Use 'const' instead.","line":55,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":55,"endColumn":20,"fix":{"range":[2146,2192],"text":"const newName = convertRomanToArabic(game.name);"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":91,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3618,3621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3618,3621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":3,"fixableWarningCount":0,"source":"import fs from 'fs/promises';\r\nimport path from 'path';\r\nimport { fileURLToPath } from 'url';\r\n\r\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\r\nconst GAMES_DB_PATH = path.join(__dirname, '../data/games_db.json');\r\nconst TITLES_OUTPUT_PATH = path.join(__dirname, '../titles.txt');\r\n\r\n// Roman Numeral Map (1-30)\r\nconst ROMAN_MAP: { [key: string]: string } = {\r\n    'I': '1', 'II': '2', 'III': '3', 'IV': '4', 'V': '5',\r\n    'VI': '6', 'VII': '7', 'VIII': '8', 'IX': '9', 'X': '10',\r\n    'XI': '11', 'XII': '12', 'XIII': '13', 'XIV': '14', 'XV': '15',\r\n    'XVI': '16', 'XVII': '17', 'XVIII': '18', 'XIX': '19', 'XX': '20',\r\n    'XXI': '21', 'XXII': '22', 'XXIII': '23', 'XXIV': '24', 'XXV': '25',\r\n    'XXVI': '26', 'XXVII': '27', 'XXVIII': '28', 'XXIX': '29', 'XXX': '30'\r\n};\r\n\r\n// Sort by length descending to match longer numerals first\r\nconst SORTED_NUMERALS = Object.keys(ROMAN_MAP).sort((a, b) => b.length - a.length);\r\nconst ROMAN_REGEX = new RegExp(`\\\\b(${SORTED_NUMERALS.join('|')})\\\\b`, 'g');\r\n\r\nfunction convertRomanToArabic(name: string): string {\r\n    // Special case check: \"I\" at the start of a sentence/title might be the pronoun \"I\"\r\n    // But \"Mortal Kombat I\" is valid.\r\n    // \"I Am Bread\" -> \"1 Am Bread\" (False positive risk)\r\n    // Given \"aggressive\" instruction, we proceed, but maybe we can skip \"I\" if it's the *only* word? No.\r\n\r\n    if (!name) return name;\r\n\r\n    return name.replace(ROMAN_REGEX, (match) => {\r\n        return ROMAN_MAP[match] || match;\r\n    });\r\n}\r\n\r\nasync function main() {\r\n    console.log('Starting Master Cleanup...');\r\n\r\n    // 1. Load Data\r\n    console.log('Loading files...');\r\n    let gamesDbRaw = await fs.readFile(GAMES_DB_PATH, 'utf-8');\r\n\r\n    let gamesDb = JSON.parse(gamesDbRaw);\r\n\r\n    console.log(`Initial Counts - Games DB: ${gamesDb.length}`);\r\n\r\n    // 2. Process Games DB\r\n    // - Convert Roman to Arabic\r\n    // - Deduplicate internally\r\n    console.log('Processing Games DB...');\r\n    const processedGamesMap = new Map<string, any>(); // Key: normalized name, Value: game object\r\n    let gamesConvertedCount = 0;\r\n\r\n    for (const game of gamesDb) {\r\n        let newName = convertRomanToArabic(game.name);\r\n        if (newName !== game.name) {\r\n            gamesConvertedCount++;\r\n        }\r\n\r\n        // Update name\r\n        game.name = newName;\r\n\r\n        // Normalization for deduplication: lowercase, trim\r\n        const normalized = newName.toLowerCase().trim();\r\n\r\n        if (!processedGamesMap.has(normalized)) {\r\n            processedGamesMap.set(normalized, game);\r\n        } else {\r\n            // Duplicate found, keep the one already in map (first occurrence)\r\n            // console.log(`Duplicate removed from Games DB: ${game.name}`);\r\n        }\r\n    }\r\n\r\n    const cleanedGamesDb = Array.from(processedGamesMap.values());\r\n    console.log(`Games DB Processed: ${gamesConvertedCount} titles converted. New Count: ${cleanedGamesDb.length} (Removed ${gamesDb.length - cleanedGamesDb.length} duplicates)`);\r\n\r\n\r\n\r\n    // 4. Save Files\r\n    console.log('Saving files...');\r\n\r\n    // Sort Games DB by name for tidiness (optional but good)\r\n    // cleanedGamesDb.sort((a, b) => a.name.localeCompare(b.name)); \r\n    // Actually, maybe preserve original order or sort? The user didn't ask to sort, but it helps. \r\n    // I'll leave order as is (first occurrence order) to minimize diffs if order matters.\r\n\r\n    await fs.writeFile(GAMES_DB_PATH, JSON.stringify(cleanedGamesDb, null, 2));\r\n\r\n    // 5. Extract Titles (Update titles.txt)\r\n    console.log('Updating titles.txt...');\r\n    const titles = cleanedGamesDb.map((g: any) => g.name).join('\\n');\r\n    await fs.writeFile(TITLES_OUTPUT_PATH, titles);\r\n\r\n    console.log('Master Cleanup Complete!');\r\n}\r\n\r\nmain().catch(console.error);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\scripts\\migrate_screenshots.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1703,1706],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1703,1706],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":94,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":94,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2958,2961],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2958,2961],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":121,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3823,3826],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3823,3826],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":182,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":182,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":182,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5982,5985],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5982,5985],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import fs from 'fs/promises';\r\nimport path from 'path';\r\nimport axios from 'axios';\r\nimport { fileURLToPath } from 'url';\r\nimport dotenv from 'dotenv';\r\n\r\n// Load environment variables from .env file\r\ndotenv.config();\r\n\r\nconst CLIENT_ID = process.env.VITE_IGDB_CLIENT_ID;\r\nconst CLIENT_SECRET = process.env.VITE_IGDB_CLIENT_SECRET;\r\n\r\n// Validate that required environment variables are set\r\nif (!CLIENT_ID || !CLIENT_SECRET) {\r\n    console.error('Error: Missing required environment variables.');\r\n    console.error('Please create a .env file with VITE_IGDB_CLIENT_ID and VITE_IGDB_CLIENT_SECRET');\r\n    console.error('See .env.example for reference.');\r\n    process.exit(1);\r\n}\r\n\r\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\r\nconst DB_FILE = path.join(__dirname, '../data/games_db.json');\r\nconst BACKUP_FILE = path.join(__dirname, '../data/games_db_backup.json');\r\n\r\ninterface Game {\r\n    id: number;\r\n    name: string;\r\n    year?: number;\r\n    platform: string;\r\n    genre: string;\r\n    rating: number;\r\n    screenshots: string[];\r\n    cover: string | null;\r\n    cropPositions: { x: number; y: number }[];\r\n}\r\n\r\ninterface IGDBScreenshot {\r\n    url: string;\r\n}\r\n\r\ninterface IGDBGame {\r\n    screenshots?: IGDBScreenshot[];\r\n}\r\n\r\nasync function getAccessToken(): Promise<string> {\r\n    console.log('Authenticating with IGDB...');\r\n    try {\r\n        const response = await axios.post('https://id.twitch.tv/oauth2/token', null, {\r\n            params: {\r\n                client_id: CLIENT_ID,\r\n                client_secret: CLIENT_SECRET,\r\n                grant_type: 'client_credentials',\r\n            },\r\n        });\r\n        return response.data.access_token;\r\n    } catch (error: any) {\r\n        console.error('Error getting access token:', error.response?.data || error.message);\r\n        process.exit(1);\r\n    }\r\n}\r\n\r\nasync function fetchScreenshotsForGame(gameId: number, accessToken: string): Promise<string[] | null> {\r\n    const query = `\r\n        fields screenshots.url;\r\n        where id = ${gameId};\r\n        limit 1;\r\n    `;\r\n\r\n    try {\r\n        const response = await axios.post(\r\n            'https://api.igdb.com/v4/games',\r\n            query,\r\n            {\r\n                headers: {\r\n                    'Client-ID': CLIENT_ID,\r\n                    'Authorization': `Bearer ${accessToken}`,\r\n                    'Content-Type': 'text/plain',\r\n                },\r\n            }\r\n        );\r\n\r\n        if (response.data && response.data.length > 0) {\r\n            const gameData: IGDBGame = response.data[0];\r\n            const screenshots = gameData.screenshots || [];\r\n\r\n            if (screenshots.length >= 5) {\r\n                // Return first 5 screenshots with proper formatting\r\n                return screenshots\r\n                    .slice(0, 5)\r\n                    .map(s => s.url.replace('t_thumb', 't_720p').replace('//', 'https://'));\r\n            }\r\n        }\r\n        return null;\r\n    } catch (error: any) {\r\n        // Return null on error to fallback to shuffle\r\n        return null;\r\n    }\r\n}\r\n\r\nfunction shuffleArray<T>(array: T[]): T[] {\r\n    const shuffled = [...array];\r\n    for (let i = shuffled.length - 1; i > 0; i--) {\r\n        const j = Math.floor(Math.random() * (i + 1));\r\n        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\r\n    }\r\n    return shuffled;\r\n}\r\n\r\nfunction generateCropPositions(count: number): { x: number; y: number }[] {\r\n    return Array.from({ length: count }, () => ({\r\n        x: Math.floor(Math.random() * 100),\r\n        y: Math.floor(Math.random() * 100),\r\n    }));\r\n}\r\n\r\nasync function createBackup(): Promise<void> {\r\n    console.log('Creating backup of games_db.json...');\r\n    try {\r\n        await fs.copyFile(DB_FILE, BACKUP_FILE);\r\n        console.log(` Backup created: ${BACKUP_FILE}\\n`);\r\n    } catch (error: any) {\r\n        console.error('Error creating backup:', error.message);\r\n        throw new Error('Failed to create backup');\r\n    }\r\n}\r\n\r\nexport async function runMigration() {\r\n    // Create backup first\r\n    await createBackup();\r\n\r\n    // Load existing database\r\n    let games: Game[] = [];\r\n    try {\r\n        const content = await fs.readFile(DB_FILE, 'utf-8');\r\n        games = JSON.parse(content);\r\n        console.log(`Loaded ${games.length} games from database.\\n`);\r\n    } catch (error) {\r\n        console.error('Error loading games database:', error);\r\n        throw new Error('Failed to load games database');\r\n    }\r\n\r\n    // Get access token\r\n    const token = await getAccessToken();\r\n    console.log(' Authentication successful\\n');\r\n\r\n    // Statistics\r\n    let updatedCount = 0;\r\n    let shuffledCount = 0;\r\n    let errorCount = 0;\r\n\r\n    console.log('Starting screenshot migration...\\n');\r\n\r\n    // Process each game\r\n    for (let i = 0; i < games.length; i++) {\r\n        const game = games[i];\r\n        const progress = `[${i + 1}/${games.length}]`;\r\n\r\n        process.stdout.write(`${progress} ${game.name}... `);\r\n\r\n        // Rate limit delay (250ms = 4 req/s max)\r\n        if (i > 0) {\r\n            await new Promise(resolve => setTimeout(resolve, 300));\r\n        }\r\n\r\n        try {\r\n            // Try to fetch new screenshots from API\r\n            const newScreenshots = await fetchScreenshotsForGame(game.id, token);\r\n\r\n            if (newScreenshots && newScreenshots.length === 5) {\r\n                // Successfully fetched 5 new screenshots\r\n                game.screenshots = newScreenshots;\r\n                game.cropPositions = generateCropPositions(5);\r\n                updatedCount++;\r\n                console.log(' Updated with new screenshots');\r\n            } else {\r\n                // Fallback: shuffle existing screenshots\r\n                game.screenshots = shuffleArray(game.screenshots);\r\n                game.cropPositions = generateCropPositions(game.screenshots.length);\r\n                shuffledCount++;\r\n                console.log(' Shuffled existing screenshots');\r\n            }\r\n        } catch (error: any) {\r\n            // Error handling - still shuffle on error\r\n            game.screenshots = shuffleArray(game.screenshots);\r\n            game.cropPositions = generateCropPositions(game.screenshots.length);\r\n            shuffledCount++;\r\n            errorCount++;\r\n            console.log(' Error, shuffled existing screenshots');\r\n        }\r\n    }\r\n\r\n    // Save updated database\r\n    console.log('\\nSaving updated database...');\r\n    await fs.writeFile(DB_FILE, JSON.stringify(games, null, 2));\r\n\r\n    // Print statistics\r\n    console.log('\\n' + '='.repeat(50));\r\n    console.log('MIGRATION COMPLETE');\r\n    console.log('='.repeat(50));\r\n    console.log(`Total games:          ${games.length}`);\r\n    console.log(`Updated with new:     ${updatedCount}`);\r\n    console.log(`Shuffled existing:    ${shuffledCount}`);\r\n    console.log(`Errors (shuffled):    ${errorCount}`);\r\n    console.log('='.repeat(50));\r\n    console.log(`\\nBackup location: ${BACKUP_FILE}`);\r\n    console.log(`To restore backup: copy games_db_backup.json to games_db.json`);\r\n\r\n    return {\r\n        success: true,\r\n        totalGames: games.length,\r\n        updatedCount,\r\n        shuffledCount,\r\n        errorCount\r\n    };\r\n}\r\n\r\nasync function main() {\r\n    try {\r\n        await runMigration();\r\n    } catch (error) {\r\n        console.error('Migration failed:', error);\r\n        process.exit(1);\r\n    }\r\n}\r\n\r\n// Only run main if this file is executed directly\r\nif (import.meta.url === `file://${process.argv[1]}`) {\r\n    main().catch(console.error);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\App.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Johan\\repos\\guessthegame\\src\\App.tsx:101:9\n   99 |       const id = path.split('/share/')[1];\n  100 |       if (id) {\n> 101 |         setShareId(id);\n      |         ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  102 |       }\n  103 |     }\n  104 |   }, []);","line":101,"column":9,"nodeType":null,"endLine":101,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from 'react';\r\nimport { AnimatePresence } from 'framer-motion';\r\nimport { PageTransition } from './components/PageTransition';\r\nimport { Layout } from './components/Layout';\r\nimport { GameArea } from './components/GameArea';\r\nimport { EndlessGameArea } from './components/EndlessGameArea';\r\nimport { HighScoreModal } from './components/HighScoreModal';\r\nimport { TutorialModal } from './components/TutorialModal';\r\nimport { useGameState } from './hooks/useGameState';\r\nimport { useEndlessState } from './hooks/useEndlessState';\r\nimport { useEndlessStats } from './hooks/useEndlessStats';\r\nimport { useSettings } from './hooks/useSettings';\r\nimport type { GameMode } from './types';\r\nimport { MobileTutorialModal } from './components/MobileTutorialModal';\r\nimport { useIsMobile } from './hooks/useIsMobile';\r\nimport { RunSummary } from './components/RunSummary';\r\n\r\nfunction App() {\r\n  const [mode, setMode] = useState<GameMode>('standard');\r\n  const [showHighScoreModal, setShowHighScoreModal] = useState(false);\r\n  const [isStatsOpen, setIsStatsOpen] = useState(false);\r\n  const isMobile = useIsMobile();\r\n\r\n  const gameState = useGameState();\r\n  const { currentGame, currentProgress, games, submitGuess, nextLevel, isLoading, error } = gameState;\r\n\r\n  const endlessState = useEndlessState(games);\r\n  const endlessStats = useEndlessStats();\r\n\r\n  // Track stats when endless history changes\r\n  const prevHistoryLength = useRef(endlessState.state.history.length);\r\n  useEffect(() => {\r\n    const history = endlessState.state.history;\r\n    if (history.length > prevHistoryLength.current) {\r\n      // New entry added\r\n      const lastEntry = history[history.length - 1];\r\n      const game = games.find(g => g.id === lastEntry.gameId);\r\n      if (game) {\r\n        const wasCorrect = lastEntry.status === 'won';\r\n        // Guess count: for 'won', it's the score divided by points (approximation)\r\n        // Better: count guesses from the result. For skipped/lost, we don't count guess distribution.\r\n        // The score tells us: 5pts= 1 guess, 4= 2, 3= 3, 2= 4, 1= 5\r\n        // But with hot streak it doubles. Let's just use a rough estimate.\r\n        // Actually, let's find the guess count from the current state's guesses at time of win.\r\n        // Since the history entry is added at the moment of result, we can approximate:\r\n        // Score 5 = guess 1, 4 = guess 2, 3 = guess 3, 2 = guess 4, 1 = guess 5 (ignoring hot streak)\r\n        let guessCount = 5;\r\n        if (wasCorrect && lastEntry.score > 0) {\r\n          const baseScore = lastEntry.score <= 5 ? lastEntry.score : Math.ceil(lastEntry.score / 2);\r\n          guessCount = Math.max(1, 6 - baseScore);\r\n        }\r\n        endlessStats.recordResult(game, wasCorrect, guessCount);\r\n      }\r\n    }\r\n    prevHistoryLength.current = history.length;\r\n  }, [endlessState.state.history, games, endlessStats]);\r\n\r\n  // Tutorial state from settings context\r\n  const { isTutorialOpen, setIsTutorialOpen, markTutorialSeen, settings } = useSettings();\r\n\r\n  // Apply theme\r\n  useEffect(() => {\r\n    document.body.dataset.theme = settings.theme;\r\n  }, [settings.theme]);\r\n\r\n  const handleModeSwitch = (newMode: GameMode) => {\r\n    if (mode === newMode) return;\r\n    setMode(newMode);\r\n  };\r\n\r\n  const handleModalClose = () => {\r\n    setShowHighScoreModal(false);\r\n  };\r\n\r\n  const handlePlayAgain = () => {\r\n    setShowHighScoreModal(false);\r\n    endlessState.nextLevel();\r\n  };\r\n\r\n  const handleRequestHighScore = () => {\r\n    // Only show the modal if it hasn't been shown yet for this game over\r\n    if (!endlessState.state.highScoreModalShown) {\r\n      setShowHighScoreModal(true);\r\n      endlessState.markHighScoreModalShown();\r\n    } else {\r\n      // If already shown, just restart the game\r\n      endlessState.nextLevel();\r\n    }\r\n  };\r\n\r\n  // URL Routing for Share Page\r\n  // Simple check for path: /share/[id]\r\n  const [shareId, setShareId] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    const path = window.location.pathname;\r\n    if (path.startsWith('/share/')) {\r\n      // Extract ID\r\n      const id = path.split('/share/')[1];\r\n      if (id) {\r\n        setShareId(id);\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  const handleExitShareMode = () => {\r\n    // Clear URL and return to standard mode\r\n    window.history.pushState({}, '', '/');\r\n    setShareId(null);\r\n    setMode('standard'); // Or endless if preferred, but standard is default landing\r\n  };\r\n\r\n  if (shareId) {\r\n    if (isLoading) {\r\n      return (\r\n        <div className=\"min-h-screen flex items-center justify-center bg-background text-white\">\r\n          <div className=\"animate-pulse text-xl\">Loading...</div>\r\n        </div>\r\n      );\r\n    }\r\n    return <RunSummary runId={shareId} allGames={games} onPlay={handleExitShareMode} />;\r\n  }\r\n\r\n  // Removed global loading check to allow inline loading\r\n  // if (isLoading) { ... }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-background text-error\">\r\n        <div className=\"text-center\">\r\n          <h1 className=\"text-2xl font-bold mb-2\">Error Loading Data</h1>\r\n          <p>{error}</p>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className=\"mt-4 px-4 py-2 bg-white text-black rounded-lg hover:bg-gray-200\"\r\n          >\r\n            Retry\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Layout\r\n      gameState={gameState}\r\n      currentMode={mode}\r\n      onModeSwitch={handleModeSwitch}\r\n      isStatsOpen={isStatsOpen}\r\n      onStatsOpenChange={setIsStatsOpen}\r\n      endlessStats={{\r\n        stats: endlessStats.stats,\r\n        totalGames: endlessStats.totalGames,\r\n        winRate: endlessStats.winRate,\r\n        averageGuesses: endlessStats.averageGuesses,\r\n        resetStats: endlessStats.resetStats,\r\n      }}\r\n    >\r\n\r\n      <AnimatePresence mode=\"wait\">\r\n        {mode === 'standard' ? (\r\n          (currentGame || isLoading) && (\r\n            <PageTransition key=\"standard\" className=\"h-full\">\r\n              <GameArea\r\n                game={currentGame || null}\r\n                allGames={games}\r\n                guesses={currentProgress?.guesses || []}\r\n                status={currentProgress?.status || 'playing'}\r\n                allProgress={gameState.allProgress}\r\n                onGuess={submitGuess}\r\n                onSkip={gameState.skipGuess}\r\n                onNextLevel={nextLevel}\r\n                isLoading={isLoading}\r\n              />\r\n            </PageTransition>\r\n          )\r\n        ) : (\r\n          (endlessState.currentGame || isLoading) && (\r\n            <PageTransition key=\"endless\" className=\"h-full\">\r\n              <EndlessGameArea\r\n                game={endlessState.currentGame || null}\r\n                allGames={games}\r\n                state={endlessState.state}\r\n                onGuess={endlessState.submitGuess}\r\n                onSkip={endlessState.skipGuess}\r\n                onNextLevel={endlessState.nextLevel}\r\n                onUseLifeline={endlessState.useLifeline}\r\n                onBuyShopItem={endlessState.buyShopItem}\r\n                onRequestHighScore={handleRequestHighScore}\r\n                isHighScoreModalOpen={showHighScoreModal}\r\n                onMarkShopVisited={endlessState.markShopVisited}\r\n                isStatsOpen={isStatsOpen}\r\n                isLoading={isLoading}\r\n              />\r\n            </PageTransition>\r\n          )\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {showHighScoreModal && (\r\n        <HighScoreModal\r\n          score={endlessState.state.score}\r\n          onPlayAgain={handlePlayAgain}\r\n          onClose={handleModalClose}\r\n          runData={{\r\n            history: endlessState.state.history,\r\n            totalScore: endlessState.state.score,\r\n            totalGames: endlessState.state.history.length\r\n          }}\r\n        />\r\n      )}\r\n\r\n      {isMobile ? (\r\n        <MobileTutorialModal\r\n          isOpen={isTutorialOpen}\r\n          onClose={() => {\r\n            setIsTutorialOpen(false);\r\n            markTutorialSeen();\r\n          }}\r\n          onComplete={markTutorialSeen}\r\n        />\r\n      ) : (\r\n        <TutorialModal\r\n          isOpen={isTutorialOpen}\r\n          onClose={() => {\r\n            setIsTutorialOpen(false);\r\n            markTutorialSeen();\r\n          }}\r\n          onComplete={markTutorialSeen}\r\n        />\r\n      )}\r\n    </Layout>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\AppMinimal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\components\\AdminGameEditor.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1081,1084],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1081,1084],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":121,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4406,4409],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4406,4409],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":157,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5601,5604],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5601,5604],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":215,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7576,7579],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7576,7579],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":270,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":270,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9301,9304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9301,9304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":295,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":295,"endColumn":21}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { X, AlertTriangle, Search, Check, Image as ImageIcon, Download } from 'lucide-react';\r\nimport type { Game } from '../types';\r\nimport { useSettings } from '../hooks/useSettings';\r\nimport clsx from 'clsx';\r\n\r\ninterface AdminGameEditorProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    game: Game | null;\r\n    onUpdate: (newName: string) => void;\r\n    onDelete?: () => void;\r\n}\r\n\r\ntype Mode = 'edit' | 'request' | 'database';\r\ntype RequestStep = 'search' | 'review';\r\n\r\nexport function AdminGameEditor({ isOpen, onClose, game, onUpdate, onDelete }: AdminGameEditorProps) {\r\n    const [mode, setMode] = useState<Mode>('edit');\r\n\r\n    // Edit Mode State\r\n    const [name, setName] = useState('');\r\n    const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\r\n\r\n    // Request Mode State\r\n    const [requestStep, setRequestStep] = useState<RequestStep>('search');\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [foundGame, setFoundGame] = useState<any | null>(null);\r\n    const [selectedScreenshots, setSelectedScreenshots] = useState<string[]>([]);\r\n\r\n    // New state for editing metadata during request\r\n    const [editPlatform, setEditPlatform] = useState('');\r\n    const [editGenre, setEditGenre] = useState('');\r\n\r\n    // Database Mode State\r\n    const [dbSearchQuery, setDbSearchQuery] = useState('');\r\n    const [dbSearchResults, setDbSearchResults] = useState<Game[]>([]);\r\n    const [editingGameId, setEditingGameId] = useState<number | null>(null);\r\n\r\n    // Edit Mode Extended State\r\n    const [platform, setPlatform] = useState('');\r\n    const [genre, setGenre] = useState('');\r\n\r\n    // Shared State\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [similarGames, setSimilarGames] = useState<string[]>([]);\r\n\r\n    const { settings } = useSettings();\r\n\r\n    useEffect(() => {\r\n        if (isOpen) {\r\n            // Reset states when opening\r\n            setMode('edit');\r\n            setRequestStep('search');\r\n            setError(null);\r\n            setFoundGame(null);\r\n            setSelectedScreenshots([]);\r\n            setSearchQuery('');\r\n            setEditPlatform('');\r\n            setEditGenre('');\r\n            setDbSearchQuery('');\r\n            setDbSearchResults([]);\r\n            setEditingGameId(null);\r\n\r\n            if (game) {\r\n                setName(game.name);\r\n                setPlatform(game.platform);\r\n                setGenre(game.genre);\r\n            }\r\n        }\r\n    }, [isOpen, game]);\r\n\r\n    // Effect to handle internal editing game override\r\n    useEffect(() => {\r\n        if (editingGameId && mode === 'edit') {\r\n            const gameToEdit = dbSearchResults.find(g => g.id === editingGameId);\r\n            if (gameToEdit) {\r\n                setName(gameToEdit.name);\r\n                setPlatform(gameToEdit.platform);\r\n                setGenre(gameToEdit.genre);\r\n            }\r\n        } else if (game && mode === 'edit' && !editingGameId) {\r\n            // Fallback to prop game if not editing a specific DB game\r\n            setName(game.name);\r\n            setPlatform(game.platform);\r\n            setGenre(game.genre);\r\n        }\r\n    }, [mode, editingGameId, dbSearchResults, game]);\r\n\r\n    if (!isOpen) return null;\r\n\r\n    const handleUpdate = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setIsLoading(true);\r\n        setError(null);\r\n\r\n        try {\r\n            const response = await fetch('/api/admin/update-game', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'x-admin-key': settings.adminKey\r\n                },\r\n                body: JSON.stringify({\r\n                    id: editingGameId || game?.id,\r\n                    name: name,\r\n                    platform: platform,\r\n                    genre: genre\r\n                }),\r\n            });\r\n\r\n            if (!response.ok) throw new Error('Failed to update game');\r\n\r\n            const data = await response.json();\r\n            if (data.success) {\r\n                onUpdate(name);\r\n                if (editingGameId) {\r\n                    // Refresh DB search if we were editing from DB\r\n                    handleDbSearch(new Event('submit') as any);\r\n                    setMode('database');\r\n                    setEditingGameId(null);\r\n                } else {\r\n                    onClose();\r\n                }\r\n            } else {\r\n                setError(data.error || 'Unknown error');\r\n            }\r\n        } catch {\r\n            setError('Failed to connect to server');\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleDelete = async () => {\r\n        setIsLoading(true);\r\n        setError(null);\r\n\r\n        try {\r\n            const response = await fetch('/api/admin/delete-game', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'x-admin-key': settings.adminKey\r\n                },\r\n                body: JSON.stringify({ id: editingGameId || game?.id }),\r\n            });\r\n\r\n            if (!response.ok) throw new Error('Failed to delete game');\r\n\r\n            const data = await response.json();\r\n            if (data.success) {\r\n                if (onDelete && !editingGameId) onDelete();\r\n                if (editingGameId) {\r\n                    handleDbSearch(new Event('submit') as any);\r\n                    setMode('database');\r\n                    setEditingGameId(null);\r\n                } else {\r\n                    onClose();\r\n                }\r\n            } else {\r\n                setError(data.error || 'Unknown error');\r\n            }\r\n        } catch {\r\n            setError('Failed to connect to server');\r\n        } finally {\r\n            setIsLoading(false);\r\n            setShowDeleteConfirm(false);\r\n        }\r\n    };\r\n\r\n    const handleSearch = async (e: React.FormEvent, skipCheck = false) => {\r\n        if (e && e.preventDefault) e.preventDefault();\r\n        setIsLoading(true);\r\n        setError(null);\r\n        setFoundGame(null);\r\n        setSimilarGames([]);\r\n\r\n        try {\r\n            const response = await fetch('/api/admin/request-game', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'x-admin-key': settings.adminKey\r\n                },\r\n                body: JSON.stringify({ name: searchQuery, skipCheck }),\r\n            });\r\n\r\n            // 409 Conflict means potential duplicates\r\n            if (response.status === 409) {\r\n                const data = await response.json();\r\n                setError(data.error);\r\n                if (data.similarGames) {\r\n                    setSimilarGames(data.similarGames);\r\n                }\r\n                return;\r\n            }\r\n\r\n            if (!response.ok) {\r\n                const data = await response.json();\r\n                throw new Error(data.error || 'Failed to search game');\r\n            }\r\n\r\n            const data = await response.json();\r\n            setFoundGame(data);\r\n\r\n            // Initialize edit fields\r\n            setEditPlatform(data.platform || 'Unknown');\r\n            setEditGenre(data.genre || 'Unknown');\r\n\r\n            setRequestStep('review');\r\n            setSelectedScreenshots(data.availableScreenshots.slice(0, 5));\r\n        } catch (err: any) {\r\n            setError(err.message);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const toggleScreenshot = (url: string) => {\r\n        if (selectedScreenshots.includes(url)) {\r\n            setSelectedScreenshots(prev => prev.filter(s => s !== url));\r\n        } else {\r\n            if (selectedScreenshots.length >= 5) {\r\n                return;\r\n            }\r\n            setSelectedScreenshots(prev => [...prev, url]);\r\n        }\r\n    };\r\n\r\n    const handleAddGame = async () => {\r\n        if (selectedScreenshots.length !== 5) {\r\n            setError('Please select exactly 5 screenshots');\r\n            return;\r\n        }\r\n\r\n        setIsLoading(true);\r\n        setError(null);\r\n\r\n        try {\r\n            const response = await fetch('/api/admin/add-game', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'x-admin-key': settings.adminKey\r\n                },\r\n                body: JSON.stringify({\r\n                    gameData: {\r\n                        ...foundGame,\r\n                        platform: editPlatform,\r\n                        genre: editGenre\r\n                    },\r\n                    selectedScreenshots\r\n                }),\r\n            });\r\n\r\n            if (!response.ok) {\r\n                const data = await response.json();\r\n                throw new Error(data.error || 'Failed to save game');\r\n            }\r\n\r\n            const data = await response.json();\r\n            if (data.success) {\r\n                onClose();\r\n                alert(`Added ${data.game.name}!`);\r\n                window.location.reload();\r\n            }\r\n        } catch (err: any) {\r\n            setError(err.message);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleDbSearch = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setIsLoading(true);\r\n        setError(null);\r\n\r\n        try {\r\n            const response = await fetch('/api/admin/search-local', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'x-admin-key': settings.adminKey\r\n                },\r\n                body: JSON.stringify({ query: dbSearchQuery }),\r\n            });\r\n\r\n            if (!response.ok) throw new Error('Search failed');\r\n            const data = await response.json();\r\n            setDbSearchResults(data);\r\n        } catch (err) {\r\n            setError('Failed to search database');\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const startEditingKey = (gameData: Game) => {\r\n        setEditingGameId(gameData.id);\r\n        setMode('edit');\r\n    };\r\n\r\n    return createPortal(\r\n        <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-in fade-in duration-200\">\r\n            <div className={clsx(\r\n                \"bg-surface border border-white/10 rounded-xl max-h-[90vh] overflow-hidden flex flex-col shadow-2xl animate-in zoom-in-95 duration-200 relative\",\r\n                requestStep === 'review' ? \"w-full max-w-4xl\" : \"w-full max-w-md\"\r\n            )}>\r\n                {/* Header */}\r\n                <div className=\"p-6 border-b border-white/10 flex-shrink-0\">\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                        <div className=\"flex gap-4\">\r\n                            {/* Tabs */}\r\n                            <button\r\n                                onClick={() => setMode('edit')}\r\n                                className={clsx(\r\n                                    \"text-lg font-bold transition-colors\",\r\n                                    mode === 'edit' ? \"text-white\" : \"text-gray-500 hover:text-gray-300\"\r\n                                )}\r\n                            >\r\n                                Edit Game\r\n                            </button>\r\n                            <span className=\"text-gray-600\">|</span>\r\n                            <button\r\n                                onClick={() => setMode('request')}\r\n                                className={clsx(\r\n                                    \"text-lg font-bold transition-colors\",\r\n                                    mode === 'request' ? \"text-white\" : \"text-gray-500 hover:text-gray-300\"\r\n                                )}\r\n                            >\r\n                                Request Game\r\n                            </button>\r\n                            <span className=\"text-gray-600\">|</span>\r\n                            <button\r\n                                onClick={() => setMode('database')}\r\n                                className={clsx(\r\n                                    \"text-lg font-bold transition-colors\",\r\n                                    mode === 'database' ? \"text-white\" : \"text-gray-500 hover:text-gray-300\"\r\n                                )}\r\n                            >\r\n                                Check DB\r\n                            </button>\r\n                        </div>\r\n                        <button onClick={onClose} className=\"p-2 text-gray-400 hover:text-white hover:bg-white/10 rounded-lg transition-colors\">\r\n                            <X size={20} />\r\n                        </button>\r\n                    </div>\r\n                    {mode === 'edit' && (\r\n                        <div className=\"text-xs text-gray-500 font-mono\">\r\n                            ID: {editingGameId || (game ? game.id : 'None')}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Content - Scrollable */}\r\n                <div className=\"p-6 overflow-y-auto min-h-0 flex-1\">\r\n                    {mode === 'edit' ? (\r\n                        (game || editingGameId) ? (\r\n                            // ... (Edit mode content remains same for now)\r\n                            !showDeleteConfirm ? (\r\n                                <form onSubmit={handleUpdate} className=\"space-y-6\">\r\n                                    <div className=\"space-y-2\">\r\n                                        <label className=\"block text-sm font-medium text-gray-400\">Game Name</label>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={name}\r\n                                            onChange={(e) => setName(e.target.value)}\r\n                                            className=\"w-full bg-black/50 border border-white/10 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-primary transition-colors\"\r\n                                        />\r\n                                    </div>\r\n                                    <div className=\"space-y-2\">\r\n                                        <label className=\"block text-sm font-medium text-gray-400\">Platform</label>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={platform}\r\n                                            onChange={(e) => setPlatform(e.target.value)}\r\n                                            className=\"w-full bg-black/50 border border-white/10 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-primary transition-colors\"\r\n                                        />\r\n                                    </div>\r\n                                    <div className=\"space-y-2\">\r\n                                        <label className=\"block text-sm font-medium text-gray-400\">Genre</label>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={genre}\r\n                                            onChange={(e) => setGenre(e.target.value)}\r\n                                            className=\"w-full bg-black/50 border border-white/10 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-primary transition-colors\"\r\n                                        />\r\n                                    </div>\r\n\r\n                                    <div className=\"flex justify-between items-center pt-2\">\r\n                                        <button\r\n                                            type=\"button\"\r\n                                            onClick={() => setShowDeleteConfirm(true)}\r\n                                            className=\"px-4 py-2 text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded-lg text-sm font-medium\"\r\n                                        >\r\n                                            Delete Game\r\n                                        </button>\r\n                                        <button\r\n                                            type=\"submit\"\r\n                                            disabled={isLoading}\r\n                                            className=\"px-6 py-2 bg-primary text-white font-bold rounded-lg hover:bg-primary-hover disabled:opacity-50\"\r\n                                        >\r\n                                            {isLoading ? 'Saving...' : 'Save'}\r\n                                        </button>\r\n                                    </div>\r\n                                </form>\r\n                            ) : (\r\n                                <div className=\"space-y-6\">\r\n                                    <div className=\"p-4 bg-red-500/10 border border-red-500/20 rounded-lg\">\r\n                                        <h3 className=\"font-bold text-red-400 mb-2 flex items-center gap-2\"><AlertTriangle size={20} /> Delete Game?</h3>\r\n                                        <p className=\"text-gray-300 text-sm\">Permanently delete <span className=\"font-bold text-white\">{name}</span>?</p>\r\n                                    </div>\r\n                                    <div className=\"flex justify-end gap-3\">\r\n                                        <button onClick={() => setShowDeleteConfirm(false)} className=\"px-4 py-2 text-gray-400 hover:text-white\">Cancel</button>\r\n                                        <button onClick={handleDelete} disabled={isLoading} className=\"px-4 py-2 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 disabled:opacity-50\">\r\n                                            {isLoading ? 'Deleting...' : 'Confirm Delete'}\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            )\r\n                        ) : (\r\n                            <div className=\"text-center text-gray-400 py-8\">Select a game to edit.</div>\r\n                        )\r\n                    ) : mode === 'database' ? (\r\n                        /* DATABASE MODE */\r\n                        <div className=\"space-y-6\">\r\n                            <form onSubmit={handleDbSearch} className=\"space-y-4\">\r\n                                <div className=\"flex gap-2\">\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        value={dbSearchQuery}\r\n                                        onChange={(e) => setDbSearchQuery(e.target.value)}\r\n                                        className=\"flex-1 bg-black/50 border border-white/10 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-primary transition-colors\"\r\n                                        placeholder=\"Search local database...\"\r\n                                        autoFocus\r\n                                    />\r\n                                    <button\r\n                                        type=\"submit\"\r\n                                        disabled={isLoading}\r\n                                        className=\"px-6 bg-primary text-white font-bold rounded-lg hover:bg-primary-hover disabled:opacity-50\"\r\n                                    >\r\n                                        <Search size={20} />\r\n                                    </button>\r\n                                </div>\r\n                            </form>\r\n\r\n                            <div className=\"space-y-2\">\r\n                                {dbSearchResults.map((g) => (\r\n                                    <div key={g.id} className=\"flex items-center justify-between p-3 bg-white/5 hover:bg-white/10 rounded-lg border border-white/5 transition-colors group\">\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            {g.cover && (\r\n                                                <img src={g.cover} alt=\"\" className=\"w-10 h-10 object-cover rounded\" />\r\n                                            )}\r\n                                            <div>\r\n                                                <div className=\"font-bold text-white\">{g.name}</div>\r\n                                                <div className=\"text-xs text-gray-400 flex gap-2\">\r\n                                                    <span>{g.platform}</span>\r\n                                                    <span></span>\r\n                                                    <span>{g.genre}</span>\r\n                                                    <span></span>\r\n                                                    <span>{g.year}</span>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                            <button\r\n                                                onClick={() => startEditingKey(g)}\r\n                                                className=\"p-2 text-gray-400 hover:text-white hover:bg-white/10 rounded\"\r\n                                            >\r\n                                                Edit\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                                {dbSearchResults.length === 0 && !isLoading && (\r\n                                    <div className=\"text-center text-gray-500 py-8\">\r\n                                        No games found or search not initiated.\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        /* REQUEST MODE */\r\n                        <div className=\"space-y-6\">\r\n                            {requestStep === 'search' ? (\r\n                                <form onSubmit={handleSearch} className=\"space-y-4\">\r\n                                    <div className=\"space-y-2\">\r\n                                        <label className=\"block text-sm font-medium text-gray-400\">Search for a Game</label>\r\n                                        <div className=\"relative\">\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                value={searchQuery}\r\n                                                onChange={(e) => setSearchQuery(e.target.value)}\r\n                                                className=\"w-full bg-black/50 border border-white/10 rounded-lg pl-11 pr-4 py-3 text-white focus:outline-none focus:border-primary transition-colors\"\r\n                                                placeholder=\"e.g. The Witcher 3\"\r\n                                                autoFocus\r\n                                            />\r\n                                            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500\" size={20} />\r\n                                        </div>\r\n                                    </div>\r\n                                    <button type=\"submit\" disabled={isLoading} className=\"w-full py-3 bg-primary text-white font-bold rounded-lg hover:bg-primary-hover disabled:opacity-50\">\r\n                                        {isLoading ? 'Searching...' : 'Search on IGDB'}\r\n                                    </button>\r\n                                </form>\r\n                            ) : (\r\n                                /* REVIEW STEP */\r\n                                <div className=\"space-y-6\">\r\n                                    <div className=\"flex gap-4 p-4 bg-white/5 rounded-lg border border-white/10\">\r\n                                        {foundGame?.cover ? (\r\n                                            <img src={foundGame.cover} alt=\"Cover\" className=\"w-24 h-32 object-cover rounded shadow-lg\" />\r\n                                        ) : (\r\n                                            <div className=\"w-24 h-32 bg-gray-800 rounded flex items-center justify-center text-gray-600\"><ImageIcon size={32} /></div>\r\n                                        )}\r\n                                        <div className=\"flex-1\">\r\n                                            <h3 className=\"text-xl font-bold text-white mb-3\">{foundGame?.name}</h3>\r\n\r\n                                            <div className=\"grid grid-cols-2 gap-4 max-w-lg\">\r\n                                                <div className=\"space-y-1\">\r\n                                                    <label className=\"text-xs font-medium text-gray-500 uppercase\">Platform</label>\r\n                                                    <input\r\n                                                        type=\"text\"\r\n                                                        value={editPlatform}\r\n                                                        onChange={(e) => setEditPlatform(e.target.value)}\r\n                                                        className=\"w-full bg-black/30 border border-white/10 rounded px-2 py-1 text-sm text-white focus:outline-none focus:border-primary transition-colors\"\r\n                                                    />\r\n                                                </div>\r\n                                                <div className=\"space-y-1\">\r\n                                                    <label className=\"text-xs font-medium text-gray-500 uppercase\">Genre</label>\r\n                                                    <input\r\n                                                        type=\"text\"\r\n                                                        value={editGenre}\r\n                                                        onChange={(e) => setEditGenre(e.target.value)}\r\n                                                        className=\"w-full bg-black/30 border border-white/10 rounded px-2 py-1 text-sm text-white focus:outline-none focus:border-primary transition-colors\"\r\n                                                    />\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            <div className=\"flex flex-wrap gap-2 mt-3 text-sm text-gray-400\">\r\n                                                <span className=\"bg-white/10 px-2 py-0.5 rounded\" title=\"Year\">{foundGame?.year}</span>\r\n                                                <span className=\"bg-yellow-500/20 text-yellow-300 px-2 py-0.5 rounded\" title=\"Rating\"> {foundGame?.rating}</span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div>\r\n                                        <div className=\"flex justify-between items-center mb-3\">\r\n                                            <label className=\"text-sm font-medium text-gray-300\">Select 5 Screenshots</label>\r\n                                            <span className={clsx(\"text-sm font-bold\", selectedScreenshots.length === 5 ? \"text-green-400\" : \"text-orange-400\")}>\r\n                                                {selectedScreenshots.length} / 5 Selected\r\n                                            </span>\r\n                                        </div>\r\n                                        <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2\">\r\n                                            {foundGame?.availableScreenshots.map((url: string, idx: number) => {\r\n                                                const isSelected = selectedScreenshots.includes(url);\r\n                                                return (\r\n                                                    <div\r\n                                                        key={idx}\r\n                                                        onClick={() => toggleScreenshot(url)}\r\n                                                        className={clsx(\r\n                                                            \"aspect-video rounded cursor-pointer relative group overflow-hidden border-2 transition-all\",\r\n                                                            isSelected ? \"border-green-500 opacity-100\" : \"border-transparent opacity-60 hover:opacity-100\"\r\n                                                        )}\r\n                                                    >\r\n                                                        <img src={url} alt={`Screenshot ${idx}`} className=\"w-full h-full object-cover\" />\r\n                                                        {isSelected && (\r\n                                                            <div className=\"absolute inset-0 bg-green-500/30 flex items-center justify-center backdrop-blur-[1px]\">\r\n                                                                <Check className=\"text-white drop-shadow-md\" size={32} strokeWidth={3} />\r\n                                                            </div>\r\n                                                        )}\r\n                                                    </div>\r\n                                                );\r\n                                            })}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"flex justify-between items-center pt-4 border-t border-white/10\">\r\n                                        <button\r\n                                            onClick={() => setRequestStep('search')}\r\n                                            className=\"px-4 py-2 text-gray-400 hover:text-white\"\r\n                                        >\r\n                                            Back to Search\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={handleAddGame}\r\n                                            disabled={isLoading || selectedScreenshots.length !== 5}\r\n                                            className=\"px-6 py-2 bg-green-600 text-white font-bold rounded-lg hover:bg-green-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n                                        >\r\n                                            <Download size={18} />\r\n                                            {isLoading ? 'Saving...' : 'Import Game'}\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Error Message & Duplicates Warning */}\r\n                {error && (\r\n                    <div className=\"mx-6 mb-6 p-4 bg-red-500/10 border border-red-500/20 rounded-lg\">\r\n                        <div className=\"flex items-center gap-2 text-red-400 text-sm font-bold mb-2\">\r\n                            <AlertTriangle size={16} />\r\n                            {error}\r\n                        </div>\r\n\r\n                        {similarGames.length > 0 && (\r\n                            <div className=\"mt-2 space-y-3\">\r\n                                <p className=\"text-gray-300 text-sm\">\r\n                                    Are you sure you want to add this game? It might already exist as:\r\n                                </p>\r\n                                <ul className=\"list-disc list-inside text-sm text-gray-400 pl-2\">\r\n                                    {similarGames.map((game, idx) => (\r\n                                        <li key={idx} className=\"font-medium text-white\">{game}</li>\r\n                                    ))}\r\n                                </ul>\r\n                                <div className=\"flex gap-3 pt-2\">\r\n                                    <button\r\n                                        onClick={() => { setError(null); setSimilarGames([]); }}\r\n                                        className=\"px-3 py-1.5 text-xs font-bold text-gray-400 hover:text-white bg-white/5 hover:bg-white/10 rounded transition-colors\"\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={(e) => handleSearch(e, true)}\r\n                                        className=\"px-3 py-1.5 text-xs font-bold text-white bg-red-500/20 hover:bg-red-500/40 border border-red-500/30 rounded transition-colors\"\r\n                                    >\r\n                                        I'm sure, Search Anyway\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>,\r\n        document.body\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\components\\AdminMigrationDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1531,1534],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1531,1534],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\r\nimport { X, AlertTriangle, Database, CheckCircle, XCircle } from 'lucide-react';\r\nimport { useSettings } from '../hooks/useSettings';\r\n\r\ninterface AdminMigrationDialogProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\ninterface MigrationResult {\r\n    success: boolean;\r\n    totalGames: number;\r\n    updatedCount: number;\r\n    shuffledCount: number;\r\n    errorCount: number;\r\n    message?: string;\r\n}\r\n\r\nexport function AdminMigrationDialog({ isOpen, onClose }: AdminMigrationDialogProps) {\r\n    const [confirmText, setConfirmText] = useState('');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [result, setResult] = useState<MigrationResult | null>(null);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    const { settings } = useSettings();\r\n\r\n    const isConfirmed = confirmText.trim().toLowerCase() === 'i understand';\r\n\r\n    const handleMigrate = async () => {\r\n        setIsLoading(true);\r\n        setError(null);\r\n\r\n        try {\r\n            const response = await fetch('/api/admin/migrate-screenshots', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'x-admin-key': settings.adminKey\r\n                }\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (!response.ok) {\r\n                throw new Error(data.error || 'Migration failed');\r\n            }\r\n\r\n            setResult(data);\r\n        } catch (err: any) {\r\n            setError(err.message || 'Failed to connect to server');\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleClose = () => {\r\n        setConfirmText('');\r\n        setResult(null);\r\n        setError(null);\r\n        onClose();\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-in fade-in duration-200\">\r\n            <div className=\"bg-surface border border-red-500/30 rounded-xl p-6 max-w-lg w-full shadow-2xl animate-in zoom-in-95 duration-200 relative\">\r\n                <button\r\n                    onClick={handleClose}\r\n                    className=\"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors\"\r\n                    disabled={isLoading}\r\n                >\r\n                    <X size={24} />\r\n                </button>\r\n\r\n                <div className=\"flex items-center gap-3 mb-6\">\r\n                    <Database className=\"text-red-500\" size={28} />\r\n                    <h2 className=\"text-2xl font-bold text-white\">Migrate Screenshots</h2>\r\n                </div>\r\n\r\n                {!result ? (\r\n                    <>\r\n                        <div className=\"mb-6 p-4 bg-red-500/10 border border-red-500/30 rounded-lg\">\r\n                            <div className=\"flex items-start gap-3 mb-3\">\r\n                                <AlertTriangle className=\"text-red-400 flex-shrink-0 mt-0.5\" size={20} />\r\n                                <div>\r\n                                    <h3 className=\"text-lg font-bold text-red-400 mb-2\"> Critical Database Operation</h3>\r\n                                    <p className=\"text-gray-300 text-sm leading-relaxed\">\r\n                                        This will modify <span className=\"font-bold text-white\">ALL {/* Will be filled from API */}games</span> in the database by:\r\n                                    </p>\r\n                                    <ul className=\"mt-2 ml-4 space-y-1 text-sm text-gray-300\">\r\n                                        <li> Fetching 5 new screenshots from IGDB API</li>\r\n                                        <li> Shuffling existing screenshots if API fails</li>\r\n                                        <li> Generating new random crop positions</li>\r\n                                    </ul>\r\n                                    <p className=\"mt-3 text-sm font-bold text-red-400\">\r\n                                        A backup will be created automatically, but this operation affects the entire game database.\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-4 mb-6\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-400 mb-2\">\r\n                                    Type <span className=\"font-bold text-white\">\"I understand\"</span> to proceed:\r\n                                </label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={confirmText}\r\n                                    onChange={(e) => setConfirmText(e.target.value)}\r\n                                    className=\"w-full bg-black/50 border border-white/10 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-red-500 transition-colors\"\r\n                                    placeholder=\"I understand\"\r\n                                    disabled={isLoading}\r\n                                    autoFocus\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        {error && (\r\n                            <div className=\"mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm\">\r\n                                {error}\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className=\"flex justify-end gap-3 pt-4 border-t border-white/10\">\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={handleClose}\r\n                                className=\"px-4 py-2 text-gray-400 hover:text-white transition-colors\"\r\n                                disabled={isLoading}\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={handleMigrate}\r\n                                disabled={!isConfirmed || isLoading}\r\n                                className=\"px-6 py-2 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                            >\r\n                                {isLoading ? 'Migrating...' : 'Start Migration'}\r\n                            </button>\r\n                        </div>\r\n                    </>\r\n                ) : (\r\n                    <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-200\">\r\n                        <div className={`p-4 rounded-lg border ${result.success ? 'bg-green-500/10 border-green-500/30' : 'bg-red-500/10 border-red-500/30'}`}>\r\n                            <div className=\"flex items-center gap-3 mb-3\">\r\n                                {result.success ? (\r\n                                    <CheckCircle className=\"text-green-400\" size={24} />\r\n                                ) : (\r\n                                    <XCircle className=\"text-red-400\" size={24} />\r\n                                )}\r\n                                <h3 className={`text-xl font-bold ${result.success ? 'text-green-400' : 'text-red-400'}`}>\r\n                                    {result.success ? 'Migration Complete!' : 'Migration Failed'}\r\n                                </h3>\r\n                            </div>\r\n\r\n                            {result.message && (\r\n                                <p className=\"text-gray-300 text-sm mb-3\">{result.message}</p>\r\n                            )}\r\n\r\n                            {result.success && (\r\n                                <div className=\"grid grid-cols-2 gap-3 mt-4\">\r\n                                    <div className=\"bg-black/30 rounded p-3\">\r\n                                        <div className=\"text-2xl font-bold text-white\">{result.totalGames}</div>\r\n                                        <div className=\"text-xs text-gray-400\">Total Games</div>\r\n                                    </div>\r\n                                    <div className=\"bg-black/30 rounded p-3\">\r\n                                        <div className=\"text-2xl font-bold text-green-400\">{result.updatedCount}</div>\r\n                                        <div className=\"text-xs text-gray-400\">New Screenshots</div>\r\n                                    </div>\r\n                                    <div className=\"bg-black/30 rounded p-3\">\r\n                                        <div className=\"text-2xl font-bold text-blue-400\">{result.shuffledCount}</div>\r\n                                        <div className=\"text-xs text-gray-400\">Shuffled</div>\r\n                                    </div>\r\n                                    <div className=\"bg-black/30 rounded p-3\">\r\n                                        <div className=\"text-2xl font-bold text-red-400\">{result.errorCount}</div>\r\n                                        <div className=\"text-xs text-gray-400\">Errors</div>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"flex justify-end pt-4 border-t border-white/10\">\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={handleClose}\r\n                                className=\"px-6 py-2 bg-white text-black font-bold rounded-lg hover:bg-gray-200 transition-colors\"\r\n                            >\r\n                                Done\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\components\\ConsultantOptions.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\components\\EndlessGameArea.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-refresh/only-export-components').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[0,57],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-refresh/only-export-components').","line":39,"column":1,"severity":1,"nodeType":null,"fix":{"range":[1509,1573],"text":" "}},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'game'. Either include it or remove the dependency array.","line":90,"column":8,"nodeType":"ArrayExpression","endLine":90,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [game, game.name]","fix":{"range":[3540,3552],"text":"[game, game.name]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'settings.adminKey'. Either include it or remove the dependency array.","line":138,"column":8,"nodeType":"ArrayExpression","endLine":138,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [settings.adminKey, state.status]","fix":{"range":[5382,5396],"text":"[settings.adminKey, state.status]"}}]},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported).","line":168,"column":5,"severity":1,"nodeType":null,"fix":{"range":[6346,6373],"text":" "}},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'coverImageSrc'. Either include it or remove the dependency array.","line":315,"column":8,"nodeType":"ArrayExpression","endLine":315,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [coverImageSrc, game.id]","fix":{"range":[12863,12873],"text":"[coverImageSrc, game.id]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":3,"source":"/* eslint-disable react-refresh/only-export-components */\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport type { Game, EndlessState, LifelineType, ConsultantOption } from '../types';\r\nimport { generateAnagram } from '../utils/endlessUtils';\r\nimport { redactGameName } from '../utils/redaction';\r\n\r\nimport { ShopModal } from './ShopModal';\r\nimport { SearchInput } from './SearchInput';\r\nimport { ScreenshotViewer } from './ScreenshotViewer';\r\nimport { InfoPanel } from './InfoPanel';\r\nimport { ConsultantOptions } from './ConsultantOptions';\r\nimport { Lifelines } from './Lifelines';\r\nimport type { ConsultantOptionsHandle } from '../types';\r\nimport { TopScoresTicker } from './TopScoresTicker';\r\nimport { AdminGameEditor } from './AdminGameEditor';\r\nimport { clsx } from 'clsx';\r\nimport { AlertCircle, X, ArrowRight, Flame } from 'lucide-react';\r\nimport { useSettings } from '../hooks/useSettings';\r\nimport synopsisData from '../assets/synopsis.json';\r\n\r\n\r\ninterface EndlessGameAreaProps {\r\n    game: Game | null;\r\n    allGames: Game[];\r\n    state: EndlessState;\r\n    onGuess: (game: Game, isFatal?: boolean) => void;\r\n    onSkip: () => void;\r\n    onNextLevel: () => void;\r\n    onUseLifeline: (type: LifelineType) => void;\r\n    onBuyShopItem: (itemId: string, cost?: number) => void;\r\n    onRequestHighScore: () => void;\r\n    isHighScoreModalOpen: boolean;\r\n    onMarkShopVisited: () => void;\r\n    isStatsOpen: boolean;\r\n    isLoading?: boolean;\r\n}\r\n\r\n// eslint-disable-next-line react-refresh/only-export-components\r\nexport function EndlessGameArea({\r\n    game,\r\n    allGames,\r\n    state,\r\n    onGuess,\r\n    onSkip,\r\n    onNextLevel,\r\n    onUseLifeline,\r\n    onBuyShopItem,\r\n    onRequestHighScore,\r\n    isHighScoreModalOpen,\r\n    onMarkShopVisited,\r\n    isStatsOpen,\r\n    isLoading = false\r\n}: EndlessGameAreaProps) {\r\n    const [showShop, setShowShop] = useState(false);\r\n    const [anagramHint, setAnagramHint] = useState<string | null>(null);\r\n    const [consultantOptions, setConsultantOptions] = useState<ConsultantOption[] | null>(null);\r\n    const [doubleTroubleGame, setDoubleTroubleGame] = useState<Game | null>(null);\r\n    const consultantRef = useRef<ConsultantOptionsHandle>(null);\r\n\r\n    // Animation states\r\n    const [animatingButton, setAnimatingButton] = useState<LifelineType | null>(null);\r\n    const [errorMessage, setErrorMessage] = useState<string | null>(null);\r\n    const [similarNameMessage, setSimilarNameMessage] = useState<boolean>(false);\r\n\r\n    const [showFireEffect, setShowFireEffect] = useState(false);\r\n\r\n    // Cover Peek State\r\n    const [showCoverPeek, setShowCoverPeek] = useState(false);\r\n    const [coverPeekTimeLeft, setCoverPeekTimeLeft] = useState(5);\r\n\r\n    // Synopsis State\r\n    const [showSynopsis, setShowSynopsis] = useState(false);\r\n    const [synopsisText, setSynopsisText] = useState<string | null>(null);\r\n\r\n    // Admin Mode State\r\n    const [adminModalOpen, setAdminModalOpen] = useState(false);\r\n    const [, setBackspaceCount] = useState(0);\r\n    const [displayGameName, setDisplayGameName] = useState(game?.name || '');\r\n\r\n    // Obfuscate cover image for Cover Peek\r\n    // REMOVED: const [obfuscatedCover] = useObfuscatedImages(game.cover ? [game.cover] : undefined);\r\n    const [coverImageSrc, setCoverImageSrc] = useState<string | null>(null);\r\n    const [isLoadingCover, setIsLoadingCover] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (game) {\r\n            setDisplayGameName(game.name);\r\n        }\r\n    }, [game?.name]);\r\n\r\n    // Admin Access Listener\r\n    useEffect(() => {\r\n        if (state.status === 'playing') {\r\n            setBackspaceCount(0);\r\n            return;\r\n        }\r\n\r\n        const handleKeyDown = async (e: KeyboardEvent) => {\r\n            if (e.key === 'Backspace') {\r\n                setBackspaceCount(prev => {\r\n                    const newCount = prev + 1;\r\n                    if (newCount === 5) {\r\n                        // Verify admin key before opening\r\n                        if (!settings.adminKey) {\r\n                            console.log('No admin key configured');\r\n                            return 0;\r\n                        }\r\n\r\n                        fetch('/api/admin/verify', {\r\n                            method: 'POST',\r\n                            headers: {\r\n                                'Content-Type': 'application/json',\r\n                                'x-admin-key': settings.adminKey\r\n                            }\r\n                        })\r\n                            .then(res => res.json())\r\n                            .then(data => {\r\n                                if (data.success) {\r\n                                    setAdminModalOpen(true);\r\n                                } else {\r\n                                    console.log('Invalid admin key');\r\n                                }\r\n                            })\r\n                            .catch(err => console.error('Admin verification failed', err));\r\n\r\n                        return 0;\r\n                    }\r\n                    return newCount;\r\n                });\r\n            } else {\r\n                setBackspaceCount(0);\r\n            }\r\n        };\r\n\r\n        window.addEventListener('keydown', handleKeyDown);\r\n        return () => window.removeEventListener('keydown', handleKeyDown);\r\n    }, [state.status]);\r\n\r\n    // Handle Fire Effect Pulse\r\n    useEffect(() => {\r\n        if (state.isHotStreakActive) {\r\n            setShowFireEffect(true);\r\n            const timer = setTimeout(() => setShowFireEffect(false), 2100);\r\n            return () => clearTimeout(timer);\r\n        } else {\r\n            setShowFireEffect(false);\r\n        }\r\n    }, [state.isHotStreakActive]);\r\n\r\n    // Handle Cover Peek Timer\r\n    useEffect(() => {\r\n        if (showCoverPeek && coverPeekTimeLeft > 0) {\r\n            const timer = setInterval(() => {\r\n                setCoverPeekTimeLeft(prev => {\r\n                    if (prev <= 0.1) {\r\n                        setShowCoverPeek(false);\r\n                        return 5;\r\n                    }\r\n                    return prev - 0.1;\r\n                });\r\n            }, 100);\r\n            return () => clearInterval(timer);\r\n        }\r\n    }, [showCoverPeek, coverPeekTimeLeft]);\r\n\r\n    // Detect similar name guess\r\n    // eslint-disable-next-line\r\n    useEffect(() => {\r\n        if (state.guesses.length > 0) {\r\n            const lastGuess = state.guesses[state.guesses.length - 1];\r\n            if (lastGuess.result === 'similar-name') {\r\n                setSimilarNameMessage(true);\r\n                setTimeout(() => setSimilarNameMessage(false), 2000);\r\n            }\r\n        }\r\n    }, [state.guesses]);\r\n\r\n    // Use persisted crop positions from state\r\n    // const cropPositions = state.cropPositions;\r\n\r\n    // Show shop every 5 levels\r\n    useEffect(() => {\r\n        if (state.streak > 0 && state.streak % 5 === 0 && state.status === 'playing' && state.guesses.length === 0 && state.streak > state.lastShopStreak) {\r\n            setShowShop(true);\r\n        }\r\n    }, [state.streak, state.status, state.guesses.length, state.lastShopStreak]);\r\n\r\n    const handleUseLifeline = (type: LifelineType) => {\r\n        setAnimatingButton(type);\r\n        setTimeout(() => setAnimatingButton(null), 500); // Reset animation state\r\n\r\n        if (type === 'cover_peek') {\r\n            setShowCoverPeek(true);\r\n            setCoverPeekTimeLeft(5);\r\n\r\n            // Lazy load the cover image if not already loaded\r\n            if (!coverImageSrc && game?.cover) {\r\n                setIsLoadingCover(true);\r\n                // Use the proxy endpoint directly\r\n                // We default to a decent quality/size if needed, but standard proxy without params returns full image\r\n                const proxyUrl = `/api/image-proxy?url=${encodeURIComponent(game.cover)}`;\r\n\r\n                fetch(proxyUrl)\r\n                    .then(res => res.blob())\r\n                    .then(blob => {\r\n                        const objectUrl = URL.createObjectURL(blob);\r\n                        setCoverImageSrc(objectUrl);\r\n                        setIsLoadingCover(false);\r\n                    })\r\n                    .catch(err => {\r\n                        console.error(\"Failed to load cover:\", err);\r\n                        setIsLoadingCover(false);\r\n                        setErrorMessage(\"Failed to load cover image\");\r\n                    });\r\n            }\r\n        } else if (type === 'anagram' && game) {\r\n            setAnagramHint(generateAnagram(game.name));\r\n        } else if (type === 'consultant' && game) {\r\n            // Play sound\r\n            const audio = new Audio('/sounds/let-s-play.mp3');\r\n            audio.volume = 0.1;\r\n            audio.play().catch(() => console.log('Could not play sound'));\r\n\r\n            // Create the correct answer option\r\n            const correctOption: ConsultantOption = game;\r\n\r\n            // Pick 3 random real games from the database (not the current game)\r\n            // We use 3 wrong options + 1 correct option = 4 total\r\n            const otherRealGames = allGames\r\n                .filter(g => g.id !== game.id)\r\n                .sort(() => 0.5 - Math.random())\r\n                .slice(0, 3);\r\n\r\n            const wrongOptions: ConsultantOption[] = otherRealGames;\r\n            const options = [correctOption, ...wrongOptions].sort(() => 0.5 - Math.random());\r\n            setConsultantOptions(options);\r\n        } else if (type === 'double_trouble' && game) {\r\n            // Pick a random game that is NOT the current game\r\n            const otherGames = allGames.filter(g => g.id !== game.id);\r\n            const randomGame = otherGames[Math.floor(Math.random() * otherGames.length)];\r\n            setDoubleTroubleGame(randomGame);\r\n        } else if (type === 'synopsis' && game) {\r\n            // Look up synopsis from separate data file\r\n            const synopsis = synopsisData[game.id.toString() as keyof typeof synopsisData];\r\n\r\n            // Check if synopsis is available - if not, don't consume the lifeline\r\n            if (!synopsis) {\r\n                setErrorMessage('No synopsis available for this game');\r\n                setTimeout(() => setErrorMessage(null), 3000);\r\n                return; // Don't call onUseLifeline - refund\r\n            }\r\n            // Redact the game name from the synopsis\r\n            const redacted = redactGameName(synopsis, game.name);\r\n            setSynopsisText(redacted);\r\n            setShowSynopsis(true);\r\n        }\r\n        onUseLifeline(type);\r\n    };\r\n\r\n    const handleSearchInputGuess = (name: string) => {\r\n        const guessedGame = allGames.find(g => g.name === name);\r\n        if (guessedGame) {\r\n            // Check if already guessed (won) in history\r\n            const alreadyWon = state.history.some(h => h.gameId === guessedGame.id && h.status === 'won');\r\n            if (alreadyWon) {\r\n                setErrorMessage(`Already guessed: ${guessedGame.name}`);\r\n                setTimeout(() => setErrorMessage(null), 3000);\r\n                return;\r\n            }\r\n\r\n            // Check if it matches EITHER the main game OR the double trouble game\r\n            if (doubleTroubleGame && guessedGame.id === doubleTroubleGame.id) {\r\n                // If they guessed the double trouble game, we treat it as a win!\r\n                // We pass the MAIN game to onGuess so the system registers it as a win for the current level\r\n                if (game) onGuess(game);\r\n            } else {\r\n                onGuess(guessedGame);\r\n            }\r\n        } else {\r\n            // If not found in allGames, it might be a partial match or typo, but we don't have bait games anymore.\r\n            // Just treat it as a wrong guess with a placeholder if needed, or better yet, SearchInput shouldn't allow selecting it if it's not in the list.\r\n            // But SearchInput allows free text? If so, we create a dummy game.\r\n            const dummyGame: Game = {\r\n                id: -1,\r\n                name: name,\r\n                year: 0,\r\n                platform: '',\r\n                genre: '',\r\n                rating: 0,\r\n                screenshots: [],\r\n                cover: null,\r\n                cropPositions: []\r\n            };\r\n            onGuess(dummyGame);\r\n        }\r\n    };\r\n\r\n    // Reset local state on new level\r\n    useEffect(() => {\r\n        setAnagramHint(null);\r\n        setConsultantOptions(null);\r\n        setDoubleTroubleGame(null);\r\n        setShowCoverPeek(false);\r\n        setCoverPeekTimeLeft(5);\r\n        setShowSynopsis(false);\r\n        setSynopsisText(null);\r\n\r\n        // Cleanup previous cover image\r\n        if (coverImageSrc) {\r\n            URL.revokeObjectURL(coverImageSrc);\r\n            setCoverImageSrc(null);\r\n        }\r\n        setIsLoadingCover(false);\r\n    }, [game?.id]);\r\n\r\n    const { settings, isSettingsOpen } = useSettings();\r\n\r\n    // Handle Enter key for Next Level / Try Again\r\n    useEffect(() => {\r\n        const handleKeyDown = (e: KeyboardEvent) => {\r\n            // Disable all keyboard shortcuts when Cover Peek or Synopsis is active\r\n            if (showCoverPeek || showSynopsis) return;\r\n\r\n            if (adminModalOpen || isSettingsOpen || isStatsOpen) return;\r\n\r\n            // Next Level on Enter\r\n            if (state.status !== 'playing' && e.key === 'Enter') {\r\n                // If high score modal is open, do nothing (let the modal handle Enter for form submission)\r\n                if (isHighScoreModalOpen) return;\r\n\r\n                if (settings.nextLevelOnEnter) {\r\n                    e.preventDefault();\r\n                    consultantRef.current?.stopSounds();\r\n                    if (state.isGameOver) {\r\n                        onRequestHighScore();\r\n                    } else {\r\n                        onNextLevel();\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Skip on Esc\r\n            if (state.status === 'playing' && e.key === 'Escape') {\r\n                if (settings.skipOnEsc) {\r\n                    e.preventDefault();\r\n                    onSkip();\r\n                }\r\n            }\r\n        };\r\n\r\n        window.addEventListener('keydown', handleKeyDown);\r\n        return () => window.removeEventListener('keydown', handleKeyDown);\r\n    }, [state.status, state.isGameOver, onNextLevel, onRequestHighScore, onSkip, settings, isHighScoreModalOpen, showCoverPeek, showSynopsis, adminModalOpen, isSettingsOpen, isStatsOpen]);\r\n\r\n    const [mounted, setMounted] = useState(false);\r\n    useEffect(() => {\r\n        setMounted(true);\r\n    }, []);\r\n\r\n    // Moved ShopModal to be rendered as an overlay at the bottom\r\n\r\n\r\n\r\n    const revealedCount = state.status === 'playing' ? state.guesses.length + 1 : 5;\r\n\r\n    // Share Run Logic\r\n    const [isSharing, setIsSharing] = useState(false);\r\n    const [shareCopied, setShareCopied] = useState(false);\r\n\r\n    const handleShareRun = async () => {\r\n        if (isSharing || !state.history.length) return;\r\n        setIsSharing(true);\r\n\r\n        try {\r\n            const runData = {\r\n                history: state.history,\r\n                totalScore: state.score,\r\n                totalGames: state.history.length\r\n            };\r\n\r\n            const response = await fetch('/api/run/save', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(runData)\r\n            });\r\n\r\n            if (!response.ok) throw new Error('Failed to save run');\r\n\r\n            const { id } = await response.json();\r\n            const url = `${window.location.origin}/share/${id}`;\r\n\r\n            await navigator.clipboard.writeText(url);\r\n            setShareCopied(true);\r\n            setTimeout(() => setShareCopied(false), 3000);\r\n        } catch (error) {\r\n            console.error('Share failed:', error);\r\n            setErrorMessage('Failed to share run');\r\n        } finally {\r\n            setIsSharing(false);\r\n        }\r\n    };\r\n\r\n    // Input Area\r\n    return (\r\n        <div className={clsx(\r\n            \"mx-auto pb-8 px-0 sm:px-4 game-container endless-game transition-all duration-500\",\r\n            settings.miniaturesInPicture ? \"max-w-[85rem]\" : \"max-w-6xl\"\r\n        )}>\r\n            <AdminGameEditor\r\n                isOpen={adminModalOpen}\r\n                onClose={() => setAdminModalOpen(false)}\r\n                game={game}\r\n                onUpdate={(newName) => {\r\n                    setDisplayGameName(newName);\r\n                    // We don't mutate game.name directly here as it's a prop\r\n                    // The parent component or global state should handle the update if needed\r\n                    // But for display purposes in this component, setDisplayGameName is sufficient\r\n                }}\r\n                onDelete={() => {\r\n                    onSkip();\r\n                }}\r\n            />\r\n            <div className=\"flex flex-col-reverse lg:flex-row gap-4 items-start\">\r\n                {/* Left Column: Game Area */}\r\n                <div className=\"flex-1 w-full space-y-4 min-w-0\">\r\n                    {/* Screenshot Viewer */}\r\n                    <div className={clsx(\r\n                        \"relative rounded-none sm:rounded-xl transition-all duration-500\",\r\n                        showFireEffect && state.guesses.length < 2 && \"animate-pulse-fire border-2 border-orange-500/50\"\r\n                    )}>\r\n                        <ScreenshotViewer\r\n                            screenshots={game?.screenshots || []}\r\n                            revealedCount={revealedCount}\r\n                            status={state.status}\r\n                            cropPositions={game?.cropPositions || []}\r\n                            doubleTroubleGame={doubleTroubleGame || undefined}\r\n                            currentLevelIndex={state.currentLevelIndex}\r\n                            zoomOutActive={state.zoomOutActive}\r\n                            miniaturesInPicture={settings.miniaturesInPicture}\r\n                            isLoading={isLoading}\r\n                        />\r\n\r\n                        {state.status === 'playing' && !isLoading && (\r\n                            <button\r\n                                onClick={onSkip}\r\n                                className=\"absolute top-4 left-4 bg-red-500/80 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-bold shadow-lg backdrop-blur-sm transition-all hover:scale-105 z-20 active:animate-lifeline-slide\"\r\n                            >\r\n                                SKIP\r\n                            </button>\r\n                        )}\r\n\r\n                        {/* Anagram Hint Overlay */}\r\n                        {anagramHint && state.status === 'playing' && (\r\n                            <div className=\"absolute top-4 left-28 right-4 flex justify-start pointer-events-none z-20\">\r\n                                <div className=\"bg-black/30 text-yellow-300 px-4 py-2 rounded-xl text-base font-mono tracking-wider border border-yellow-500/30 shadow-lg backdrop-blur-sm animate-lifeline-shake break-words whitespace-normal leading-tight text-left\">\r\n                                    {anagramHint}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Similar Name Popup */}\r\n                        {similarNameMessage && (\r\n                            <div className=\"absolute top-4 left-0 right-0 flex justify-center pointer-events-none z-50\">\r\n                                <div className=\"bg-yellow-500 text-black px-4 py-2 rounded-full shadow-lg font-bold animate-in fade-in slide-in-from-bottom-2 border border-yellow-400 flex items-center gap-2\">\r\n                                    <AlertCircle size={18} />\r\n                                    <span>Similar Name!</span>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Cover Peek Overlay */}\r\n                        {showCoverPeek && game?.cover && state.status === 'playing' && (\r\n                            <div className=\"absolute inset-0 z-30 bg-black/90 backdrop-blur-sm rounded-xl overflow-hidden animate-in fade-in duration-300 flex items-center justify-center\">\r\n                                {/* Blurred Cover Art */}\r\n                                {isLoadingCover ? (\r\n                                    <div className=\"text-white font-bold animate-pulse\">Loading Cover...</div>\r\n                                ) : (\r\n                                    <img\r\n                                        src={coverImageSrc || ''}\r\n                                        alt=\"Cover art\"\r\n                                        className=\"h-full w-auto object-contain\"\r\n                                        style={{\r\n                                            filter: 'blur(9px)',\r\n                                            transform: 'scale(1.1)'\r\n                                        }}\r\n                                    />\r\n                                )}\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Synopsis Overlay */}\r\n                        {showSynopsis && synopsisText && state.status === 'playing' && (\r\n                            <div className=\"absolute inset-0 z-30 bg-black/95 backdrop-blur-sm rounded-xl overflow-hidden animate-in fade-in duration-300 flex items-center justify-center p-6\">\r\n                                <div className=\"max-w-lg text-center\">\r\n                                    <h3 className=\"text-green-400 font-bold text-lg mb-4 uppercase tracking-wider flex items-center justify-center gap-2\">\r\n                                        <span></span> Synopsis\r\n                                    </h3>\r\n                                    <p className=\"text-gray-200 text-base leading-relaxed\">\r\n                                        {synopsisText}\r\n                                    </p>\r\n                                    <button\r\n                                        onClick={() => setShowSynopsis(false)}\r\n                                        className=\"mt-6 px-4 py-2 bg-green-600 hover:bg-green-500 text-white font-bold rounded-lg transition-colors\"\r\n                                    >\r\n                                        Got it!\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Cover Peek Timer Bar - Below Screenshot Viewer */}\r\n                    {showCoverPeek && state.status === 'playing' && (\r\n                        <div className=\"w-full max-w-md mx-auto animate-in fade-in duration-300\">\r\n                            <div className=\"bg-black/60 rounded-full p-1 backdrop-blur-sm border border-white/10\">\r\n                                <div\r\n                                    className=\"h-3 bg-gradient-to-r from-purple-500 via-pink-500 to-purple-500 rounded-full transition-all duration-100 ease-linear\"\r\n                                    style={{ width: `${(coverPeekTimeLeft / 5) * 100}%` }}\r\n                                />\r\n                            </div>\r\n                            <div className=\"text-center text-white font-bold mt-2 text-sm\">\r\n                                {coverPeekTimeLeft.toFixed(1)}s remaining\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Game Over / Win Message */}\r\n                    {state.status !== 'playing' && (\r\n                        <div className={clsx(\r\n                            \"mx-4 sm:mx-0 p-4 rounded-xl border text-center animate-in zoom-in duration-300\",\r\n                            state.status === 'won' ? \"bg-green-500/10 border-green-500/20\" : \"bg-red-500/10 border-red-500/20\"\r\n                        )}>\r\n                            <h2 className={clsx(\r\n                                \"text-2xl font-bold mb-2\",\r\n                                state.status === 'won' ? \"text-green-400\" : \"text-red-500\"\r\n                            )}>\r\n                                {state.status === 'won' ? \"LEVEL CLEARED\" : \"GAME OVER\"}\r\n                            </h2>\r\n                            <p className=\"text-base text-white mb-4\">\r\n                                {doubleTroubleGame ? (\r\n                                    <>The games were <span className=\"font-bold\">{displayGameName}</span> / <span className=\"font-bold\">{doubleTroubleGame.name}</span></>\r\n                                ) : (\r\n                                    <>The game was <span className=\"font-bold\">{displayGameName}</span></>\r\n                                )}\r\n                            </p>\r\n\r\n                            <div className=\"flex flex-wrap justify-center gap-3\">\r\n                                <button\r\n                                    onClick={() => {\r\n                                        consultantRef.current?.stopSounds();\r\n                                        if (state.isGameOver) {\r\n                                            onRequestHighScore();\r\n                                        } else {\r\n                                            onNextLevel();\r\n                                        }\r\n                                    }}\r\n                                    className=\"inline-flex items-center gap-2 px-5 py-2 bg-white text-black font-bold rounded-full hover:scale-105 transition-transform text-sm\"\r\n                                >\r\n                                    {state.isGameOver ? 'Try Again' : 'Next Level'} <ArrowRight size={20} />\r\n                                </button>\r\n\r\n                                {state.isGameOver && (\r\n                                    <button\r\n                                        onClick={handleShareRun}\r\n                                        disabled={isSharing}\r\n                                        className={clsx(\r\n                                            \"inline-flex items-center gap-2 px-5 py-2 font-bold rounded-full transition-all text-sm\",\r\n                                            shareCopied ? \"bg-green-500 text-white\" : \"bg-blue-600 text-white hover:bg-blue-500 hover:scale-105\"\r\n                                        )}\r\n                                    >\r\n                                        {isSharing ? 'Saving...' : shareCopied ? 'Link Copied!' : 'Share Run'}\r\n                                        {!isSharing && !shareCopied && <span className=\"text-lg\"></span>}\r\n                                    </button>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Input Area */}\r\n                    <div className={clsx(\"px-4 sm:px-0 transition-opacity duration-500 relative z-30\", state.status !== 'playing' && \"opacity-50 pointer-events-none\")}>\r\n                        {errorMessage && (\r\n                            <div className=\"absolute -top-12 left-0 right-0 flex justify-center pointer-events-none z-50\">\r\n                                <div className=\"bg-red-500 text-white px-4 py-2 rounded-full shadow-lg font-bold animate-in fade-in slide-in-from-bottom-2 border border-red-400\">\r\n                                    {errorMessage}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                        {consultantOptions && game ? (\r\n                            <ConsultantOptions\r\n                                ref={consultantRef}\r\n                                options={consultantOptions}\r\n                                correctGameId={game.id}\r\n                                onGuess={(guessedGame) => {\r\n                                    if (guessedGame.id === game.id) {\r\n                                        onGuess(guessedGame);\r\n                                    } else {\r\n                                        // Wrong guess via Consultant = Instant Game Over\r\n                                        onGuess(guessedGame, true);\r\n                                    }\r\n                                }}\r\n                            />\r\n                        ) : (\r\n                            <SearchInput\r\n                                games={allGames}\r\n                                onGuess={handleSearchInputGuess}\r\n                                disabled={state.status !== 'playing' || showShop || isLoading}\r\n                                autoFocus={true}\r\n                                correctAnswers={game ? (doubleTroubleGame ? [game.name, doubleTroubleGame.name] : [game.name]) : []}\r\n                                hideResults={showCoverPeek}\r\n                            />\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Previous Guesses */}\r\n                    {state.guesses.filter(guess => guess.result !== 'correct').length > 0 && (\r\n                        <div className=\"space-y-2 px-4 sm:px-0\">\r\n                            <h3 className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider\">Previous Guesses</h3>\r\n                            <div className=\"space-y-2\">\r\n                                {/* ... existing mapping ... */}\r\n                                {state.guesses\r\n                                    .filter(guess => guess.result !== 'correct')\r\n                                    .slice() // Create a copy before reversing\r\n                                    .reverse()\r\n                                    .map((guess, idx, arr) => {\r\n                                        const originalIdx = arr.length - 1 - idx;\r\n                                        const isSimilar = guess.result === 'similar-name';\r\n                                        const isSkipped = guess.result === 'skipped';\r\n\r\n                                        const colorClass = isSimilar\r\n                                            ? 'text-warning'\r\n                                            : 'text-error';\r\n\r\n                                        const label = isSimilar\r\n                                            ? 'Similar Name'\r\n                                            : isSkipped\r\n                                                ? `SKIPPED ${originalIdx + 1}`\r\n                                                : 'Wrong';\r\n\r\n                                        const icon = isSimilar\r\n                                            ? <AlertCircle size={16} />\r\n                                            : <X size={16} />;\r\n\r\n                                        const borderClass = isSimilar\r\n                                            ? 'border-warning'\r\n                                            : 'border-white/5';\r\n\r\n                                        return (\r\n                                            <div\r\n                                                key={idx}\r\n                                                className={`flex items-center justify-between p-2.5 rounded-lg bg-gray-800/30 border ${borderClass} text-gray-300 animate-in slide-in-from-bottom-2 fade-in text-sm`}\r\n                                                style={{ animationDelay: `${idx * 100}ms` }}\r\n                                            >\r\n                                                <span className=\"font-medium text-white\">{guess.name}</span>\r\n                                                <div className={`flex items-center gap-2 ${colorClass}`}>\r\n                                                    <span className=\"text-[10px] uppercase font-bold\">{label}</span>\r\n                                                    {icon}\r\n                                                </div>\r\n                                            </div>\r\n                                        );\r\n                                    })}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Mobile Only: Bottom Stats (Ticker + HUD) */}\r\n                    <div className=\"block lg:hidden space-y-3 mt-4 px-4 sm:px-0 pb-4\">\r\n                        <TopScoresTicker />\r\n\r\n                        {/* HUD Card */}\r\n                        <div className=\"bg-gray-800/50 p-4 rounded-xl backdrop-blur-sm border border-gray-700 shadow-lg\">\r\n                            <div className=\"grid grid-cols-3 gap-2 text-center\">\r\n                                <div className=\"flex flex-col\">\r\n                                    <span className=\"text-[10px] text-gray-400 uppercase tracking-wider font-bold\">Score</span>\r\n                                    <span className={clsx(\r\n                                        \"text-xl font-bold transition-all duration-300\",\r\n                                        state.score >= state.highScore && state.score > 0\r\n                                            ? \"text-transparent bg-clip-text bg-gradient-to-r from-orange-500 via-yellow-400 to-orange-500 animate-flame-flicker\"\r\n                                            : \"text-yellow-400\"\r\n                                    )}>\r\n                                        {state.score >= state.highScore && state.score > 0 && \" \"}{state.score}{state.score >= state.highScore && state.score > 0 && \" \"}\r\n                                    </span>\r\n                                </div>\r\n                                <div className=\"flex flex-col border-x border-white/5\">\r\n                                    <span className=\"text-[10px] text-gray-400 uppercase tracking-wider font-bold\">Streak</span>\r\n                                    <span className=\"text-xl font-black text-white\">{state.streak}</span>\r\n                                </div>\r\n                                <div className=\"flex flex-col\">\r\n                                    <span className=\"text-[10px] text-gray-400 uppercase tracking-wider font-bold\">Best</span>\r\n                                    <span className=\"text-xl font-bold text-gray-300\">{state.highScore}</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Hot Streak Indicator */}\r\n                        {state.isHotStreakActive && state.guesses.length < 2 && (\r\n                            <div className=\"bg-gradient-to-r from-red-600 to-orange-500 p-0.5 rounded-xl shadow-lg animate-in slide-in-from-right fade-in duration-500\">\r\n                                <div className=\"bg-gray-900/90 backdrop-blur-sm rounded-[10px] p-3 flex items-center justify-center gap-3\">\r\n                                    <Flame className=\"text-orange-500 animate-pulse\" size={24} fill=\"currentColor\" />\r\n                                    <div className=\"flex flex-col\">\r\n                                        <span className=\"text-orange-500 font-black text-lg tracking-wider leading-none\">HOT STREAK</span>\r\n                                        <span className=\"text-orange-300/80 text-[10px] font-bold uppercase tracking-widest\">2x Score Multiplier Active!</span>\r\n                                    </div>\r\n                                    <Flame className=\"text-orange-500 animate-pulse\" size={24} fill=\"currentColor\" />\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Right Column: Sidebar (HUD + Info + Lifelines) */}\r\n                <div className={clsx(\r\n                    \"w-full flex-shrink-0 flex flex-col gap-3 transition-all duration-500 px-4 sm:px-0\",\r\n                    settings.miniaturesInPicture ? \"lg:w-48\" : \"lg:w-72\"\r\n                )}>\r\n                    {/* Desktop Only: Top Stats */}\r\n                    <div className=\"hidden lg:flex flex-col gap-3\">\r\n                        {/* Top Scores Ticker */}\r\n                        <TopScoresTicker />\r\n\r\n                        {/* HUD Card */}\r\n                        <div className=\"bg-gray-800/50 p-4 rounded-xl backdrop-blur-sm border border-gray-700 shadow-lg\">\r\n                            <div className=\"grid grid-cols-3 gap-2 text-center\">\r\n                                <div className=\"flex flex-col\">\r\n                                    <span className=\"text-[10px] text-gray-400 uppercase tracking-wider font-bold\">Score</span>\r\n                                    <span className={clsx(\r\n                                        \"text-xl font-bold transition-all duration-300\",\r\n                                        state.score >= state.highScore && state.score > 0\r\n                                            ? \"text-transparent bg-clip-text bg-gradient-to-r from-orange-500 via-yellow-400 to-orange-500 animate-flame-flicker\"\r\n                                            : \"text-yellow-400\"\r\n                                    )}>\r\n                                        {state.score >= state.highScore && state.score > 0 && \" \"}{state.score}{state.score >= state.highScore && state.score > 0 && \" \"}\r\n                                    </span>\r\n                                </div>\r\n                                <div className=\"flex flex-col border-x border-white/5\">\r\n                                    <span className=\"text-[10px] text-gray-400 uppercase tracking-wider font-bold\">Streak</span>\r\n                                    <span className=\"text-xl font-black text-white\">{state.streak}</span>\r\n                                </div>\r\n                                <div className=\"flex flex-col\">\r\n                                    <span className=\"text-[10px] text-gray-400 uppercase tracking-wider font-bold\">Best</span>\r\n                                    <span className=\"text-xl font-bold text-gray-300\">{state.highScore}</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Hot Streak Indicator */}\r\n                        {state.isHotStreakActive && state.guesses.length < 2 && (\r\n                            <div className=\"bg-gradient-to-r from-red-600 to-orange-500 p-0.5 rounded-xl shadow-lg animate-in slide-in-from-right fade-in duration-500\">\r\n                                <div className=\"bg-gray-900/90 backdrop-blur-sm rounded-[10px] p-3 flex items-center justify-center gap-3\">\r\n                                    <Flame className=\"text-orange-500 animate-pulse\" size={24} fill=\"currentColor\" />\r\n                                    <div className=\"flex flex-col\">\r\n                                        <span className=\"text-orange-500 font-black text-lg tracking-wider leading-none\">HOT STREAK</span>\r\n                                        <span className=\"text-orange-300/80 text-[10px] font-bold uppercase tracking-widest\">2x Score Multiplier Active!</span>\r\n                                    </div>\r\n                                    <Flame className=\"text-orange-500 animate-pulse\" size={24} fill=\"currentColor\" />\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Info Panel */}\r\n                    <InfoPanel game={game ? { ...game, name: displayGameName } as Game : null} guessesMade={state.guesses.length} status={state.status} isLoading={isLoading} />\r\n\r\n                    {/* Lifelines - Rendered via Portal to Sidebar */}\r\n                    {mounted && document.getElementById('sidebar-lifelines-portal') && createPortal(\r\n                        <Lifelines\r\n                            state={state}\r\n                            game={game || undefined}\r\n                            onUseLifeline={handleUseLifeline}\r\n                            animatingButton={animatingButton}\r\n                            doubleTroubleGame={doubleTroubleGame}\r\n                            consultantOptions={consultantOptions}\r\n                            isShopOpen={showShop}\r\n                        />,\r\n                        document.getElementById('sidebar-lifelines-portal')!\r\n                    )}\r\n                </div>\r\n            </div >\r\n            {/* Shop Modal */}\r\n            {showShop && (\r\n                <div className=\"relative z-50\">\r\n                    <ShopModal\r\n                        score={state.score}\r\n                        onBuy={onBuyShopItem}\r\n                        onContinue={() => {\r\n                            setShowShop(false);\r\n                            onMarkShopVisited();\r\n                        }}\r\n                    />\r\n                </div>\r\n            )}\r\n        </div >\r\n    );\r\n};\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\components\\FullScreenToggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\components\\GameArea.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Johan\\repos\\guessthegame\\src\\components\\GameArea.tsx:35:13\n  33 |     useEffect(() => {\n  34 |         if (game) {\n> 35 |             setDisplayGameName(game.name);\n     |             ^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  36 |         }\n  37 |     }, [game?.name]);\n  38 |","line":35,"column":13,"nodeType":null,"endLine":35,"endColumn":31},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'game'. Either include it or remove the dependency array.","line":37,"column":8,"nodeType":"ArrayExpression","endLine":37,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [game, game.name]","fix":{"range":[1480,1492],"text":"[game, game.name]"}}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Johan\\repos\\guessthegame\\src\\components\\GameArea.tsx:42:13\n  40 |     useEffect(() => {\n  41 |         if (status === 'playing') {\n> 42 |             setBackspaceCount(0);\n     |             ^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  43 |             return;\n  44 |         }\n  45 |","line":42,"column":13,"nodeType":null,"endLine":42,"endColumn":30},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'settings.adminKey'. Either include it or remove the dependency array.","line":85,"column":8,"nodeType":"ArrayExpression","endLine":85,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [settings.adminKey, status]","fix":{"range":[3310,3318],"text":"[settings.adminKey, status]"}}]},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported).","line":88,"column":5,"severity":1,"nodeType":null,"fix":{"range":[3362,3389],"text":" "}},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Johan\\repos\\guessthegame\\src\\components\\GameArea.tsx:93:17\n  91 |             const lastGuess = guesses[guesses.length - 1];\n  92 |             if (lastGuess.result === 'similar-name') {\n> 93 |                 setSimilarNameMessage(true);\n     |                 ^^^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  94 |                 // eslint-disable-next-line\n  95 |                 setTimeout(() => setSimilarNameMessage(false), 2000);\n  96 |             }","line":93,"column":17,"nodeType":null,"endLine":93,"endColumn":38},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported).","line":94,"column":17,"severity":1,"nodeType":null,"fix":{"range":[3627,3654],"text":" "}}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":2,"source":"import { useState, useEffect } from 'react';\r\nimport { InfoPanel } from './InfoPanel';\r\nimport { SearchInput } from './SearchInput';\r\nimport { ScreenshotViewer } from './ScreenshotViewer';\r\nimport { AdminGameEditor } from './AdminGameEditor';\r\nimport type { Game, GameStatus, GuessWithResult, LevelProgress } from '../types';\r\nimport { clsx } from 'clsx';\r\nimport { X, ArrowRight, AlertCircle } from 'lucide-react';\r\nimport { useSettings } from '../hooks/useSettings';\r\n\r\ninterface GameAreaProps {\r\n    game: Game | null;\r\n    allGames: Game[];\r\n    guesses: GuessWithResult[];\r\n    status: GameStatus;\r\n    allProgress: Record<number, LevelProgress>;\r\n    onGuess: (name: string) => void;\r\n    onSkip: () => void;\r\n    onNextLevel: () => void;\r\n    isLoading?: boolean;\r\n}\r\n\r\nexport function GameArea({ game, allGames, guesses, status, allProgress, onGuess, onSkip, onNextLevel, isLoading = false }: GameAreaProps) {\r\n    const revealedCount = status === 'playing' ? guesses.length + 1 : 5;\r\n    const [errorMessage, setErrorMessage] = useState<string | null>(null);\r\n    const [similarNameMessage, setSimilarNameMessage] = useState<boolean>(false);\r\n\r\n    // Admin Mode State\r\n    const [adminModalOpen, setAdminModalOpen] = useState(false);\r\n    const [, setBackspaceCount] = useState(0);\r\n    const [displayGameName, setDisplayGameName] = useState(game?.name || '');\r\n\r\n    useEffect(() => {\r\n        if (game) {\r\n            setDisplayGameName(game.name);\r\n        }\r\n    }, [game?.name]);\r\n\r\n    // Admin Access Listener\r\n    useEffect(() => {\r\n        if (status === 'playing') {\r\n            setBackspaceCount(0);\r\n            return;\r\n        }\r\n\r\n        const handleKeyDown = (e: KeyboardEvent) => {\r\n            if (e.key === 'Backspace') {\r\n                setBackspaceCount(prev => {\r\n                    const newCount = prev + 1;\r\n                    if (newCount === 5) {\r\n                        // Verify admin key before opening\r\n                        if (!settings.adminKey) {\r\n                            console.log('No admin key configured');\r\n                            return 0;\r\n                        }\r\n\r\n                        fetch('/api/admin/verify', {\r\n                            method: 'POST',\r\n                            headers: {\r\n                                'Content-Type': 'application/json',\r\n                                'x-admin-key': settings.adminKey\r\n                            }\r\n                        })\r\n                            .then(res => res.json())\r\n                            .then(data => {\r\n                                if (data.success) {\r\n                                    setAdminModalOpen(true);\r\n                                } else {\r\n                                    console.log('Invalid admin key');\r\n                                }\r\n                            })\r\n                            .catch(err => console.error('Admin verification failed', err));\r\n\r\n                        return 0;\r\n                    }\r\n                    return newCount;\r\n                });\r\n            } else {\r\n                setBackspaceCount(0);\r\n            }\r\n        };\r\n\r\n        window.addEventListener('keydown', handleKeyDown);\r\n        return () => window.removeEventListener('keydown', handleKeyDown);\r\n    }, [status]);\r\n\r\n    // Detect similar name guess\r\n    // eslint-disable-next-line\r\n    useEffect(() => {\r\n        if (guesses.length > 0) {\r\n            const lastGuess = guesses[guesses.length - 1];\r\n            if (lastGuess.result === 'similar-name') {\r\n                setSimilarNameMessage(true);\r\n                // eslint-disable-next-line\r\n                setTimeout(() => setSimilarNameMessage(false), 2000);\r\n            }\r\n        }\r\n    }, [guesses]);\r\n\r\n    const handleGuess = (name: string) => {\r\n        const guessedGame = allGames.find(g => g.name === name);\r\n        if (guessedGame) {\r\n            // Check if this game was already WON in any level\r\n            const alreadyWon = Object.values(allProgress).some(level =>\r\n                level.status === 'won' &&\r\n                level.guesses.some(g => g.result === 'correct' && g.name === guessedGame.name)\r\n            );\r\n\r\n            if (alreadyWon) {\r\n                setErrorMessage(`Already guessed: ${guessedGame.name}`);\r\n                setTimeout(() => setErrorMessage(null), 3000);\r\n                return;\r\n            }\r\n        }\r\n        // Always call onGuess, even if it's a bait game (not found in allGames)\r\n        // The hook will handle it as a wrong guess\r\n        onGuess(name);\r\n    };\r\n\r\n    const { settings, isSettingsOpen } = useSettings();\r\n\r\n    // Handle Keyboard Shortcuts (Enter for Next Level, Esc for Skip)\r\n    useEffect(() => {\r\n        const handleKeyDown = (e: KeyboardEvent) => {\r\n            if (adminModalOpen || isSettingsOpen) return;\r\n\r\n            // Next Level on Enter\r\n            if (status !== 'playing' && e.key === 'Enter') {\r\n                if (settings.nextLevelOnEnter) {\r\n                    e.preventDefault();\r\n                    onNextLevel();\r\n                }\r\n            }\r\n\r\n            // Skip on Esc\r\n            if (status === 'playing' && e.key === 'Escape') {\r\n                if (settings.skipOnEsc) {\r\n                    e.preventDefault();\r\n                    onSkip();\r\n                }\r\n            }\r\n        };\r\n\r\n        window.addEventListener('keydown', handleKeyDown);\r\n        return () => window.removeEventListener('keydown', handleKeyDown);\r\n    }, [status, onNextLevel, onSkip, settings, adminModalOpen, isSettingsOpen]);\r\n\r\n    return (\r\n        <div className={clsx(\r\n            \"mx-auto space-y-2 pb-8 game-container standard-game transition-all duration-500\",\r\n            settings.miniaturesInPicture ? \"max-w-7xl\" : \"max-w-5xl\"\r\n        )}>\r\n            {game && (\r\n                <AdminGameEditor\r\n                    isOpen={adminModalOpen}\r\n                    onClose={() => setAdminModalOpen(false)}\r\n                    game={game}\r\n                    onUpdate={(newName) => {\r\n                        setDisplayGameName(newName);\r\n                        // We don't mutate game.name directly here as it's a prop\r\n                    }}\r\n                    onDelete={() => {\r\n                        onSkip();\r\n                    }}\r\n                />\r\n            )}\r\n\r\n            {/* Main Layout: Image + Metadata Side by Side */}\r\n            <div className=\"flex flex-col-reverse lg:flex-row gap-3\">\r\n                {/* Left: Screenshot Viewer */}\r\n                <div className=\"flex-1 space-y-2\">\r\n                    <div className=\"relative\">\r\n                        <ScreenshotViewer\r\n                            screenshots={game?.screenshots || []}\r\n                            revealedCount={revealedCount}\r\n                            status={status}\r\n                            cropPositions={game?.cropPositions || []}\r\n                            miniaturesInPicture={settings.miniaturesInPicture}\r\n                            isLoading={isLoading}\r\n                        />\r\n                        {status === 'playing' && !isLoading && (\r\n                            <button\r\n                                onClick={onSkip}\r\n                                className=\"absolute top-4 left-4 z-20 bg-red-500/80 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-bold shadow-lg backdrop-blur-sm transition-all hover:scale-105 text-sm active:animate-lifeline-slide\"\r\n                            >\r\n                                SKIP\r\n                            </button>\r\n                        )}\r\n                        {similarNameMessage && (\r\n                            <div className=\"absolute top-4 left-0 right-0 flex justify-center pointer-events-none z-50\">\r\n                                <div className=\"bg-warning text-black px-4 py-2 rounded-full shadow-lg font-bold animate-in fade-in slide-in-from-bottom-2 border border-yellow-500 flex items-center gap-2\">\r\n                                    <AlertCircle size={18} />\r\n                                    <span>Similar Name!</span>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Right: Metadata Cards */}\r\n                <div className={clsx(\r\n                    \"flex-shrink-0 transition-all duration-500 px-4 sm:px-0\",\r\n                    settings.miniaturesInPicture ? \"lg:w-32\" : \"lg:w-40\"\r\n                )}>\r\n                    <InfoPanel game={game ? { ...game, name: displayGameName } as Game : null} guessesMade={guesses.length} status={status} isLoading={isLoading} />\r\n                </div>\r\n            </div>\r\n\r\n            {/* Game Over / Win Message */}\r\n            {status !== 'playing' && (\r\n                <div className={clsx(\r\n                    \"mx-4 sm:mx-0 p-4 rounded-xl border text-center animate-in zoom-in duration-300\",\r\n                    status === 'won' ? \"bg-success/10 border-success/20\" : \"bg-error/10 border-error/20\"\r\n                )}>\r\n                    <h2 className={clsx(\r\n                        \"text-2xl font-bold mb-2\",\r\n                        status === 'won' ? \"text-success\" : \"text-error\"\r\n                    )}>\r\n                        {status === 'won' ? \"You Got It!\" : \"Game Over\"}\r\n                    </h2>\r\n                    <p className=\"text-base text-white mb-4\">\r\n                        The game was <span className=\"font-bold\">{displayGameName}</span>\r\n                    </p>\r\n                    <button\r\n                        onClick={onNextLevel}\r\n                        className=\"inline-flex items-center gap-2 px-5 py-2 bg-white text-black font-bold rounded-full hover:scale-105 transition-transform text-sm\"\r\n                    >\r\n                        Next Level <ArrowRight size={20} />\r\n                    </button>\r\n                </div>\r\n            )}\r\n\r\n            {/* Search Input */}\r\n            <div className={clsx(\"px-4 sm:px-0 transition-opacity duration-500 relative z-30\", status !== 'playing' && \"opacity-50 pointer-events-none\")}>\r\n                {errorMessage && (\r\n                    <div className=\"absolute -top-12 left-0 right-0 flex justify-center pointer-events-none z-50\">\r\n                        <div className=\"bg-red-500 text-white px-4 py-2 rounded-full shadow-lg font-bold animate-in fade-in slide-in-from-bottom-2 border border-red-400\">\r\n                            {errorMessage}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n                <SearchInput\r\n                    games={allGames}\r\n                    onGuess={handleGuess}\r\n                    disabled={status !== 'playing' || isLoading}\r\n                    autoFocus={true}\r\n                    correctAnswers={game ? [game.name] : []}\r\n                />\r\n            </div>\r\n\r\n            {/* Previous Guesses */}\r\n            {guesses.filter(guess => guess.result !== 'correct').length > 0 && (\r\n                <div className=\"space-y-2 px-4 sm:px-0\">\r\n                    <h3 className=\"text-sm font-semibold text-muted uppercase tracking-wider\">Previous Guesses</h3>\r\n                    <div className=\"space-y-2\">\r\n                        {guesses\r\n                            .filter(guess => guess.result !== 'correct')\r\n                            .slice() // Create a copy before reversing\r\n                            .reverse()\r\n                            .map((guess, idx, arr) => {\r\n                                const originalIdx = arr.length - 1 - idx;\r\n                                const isSimilar = guess.result === 'similar-name';\r\n                                const isSkipped = guess.result === 'skipped';\r\n\r\n                                const colorClass = isSimilar\r\n                                    ? 'text-warning'\r\n                                    : 'text-error';\r\n\r\n                                const label = isSimilar\r\n                                    ? 'Similar Name'\r\n                                    : isSkipped\r\n                                        ? `SKIPPED ${originalIdx + 1}`\r\n                                        : 'Wrong';\r\n\r\n                                const icon = isSimilar\r\n                                    ? <AlertCircle size={18} />\r\n                                    : <X size={18} />;\r\n\r\n                                const borderClass = isSimilar\r\n                                    ? 'border-warning'\r\n                                    : 'border-white/5';\r\n\r\n                                return (\r\n                                    <div\r\n                                        key={idx}\r\n                                        className={`flex items-center justify-between p-2 rounded-lg bg-surface/50 border ${borderClass} text-muted animate-in slide-in-from-bottom-2 fade-in text-sm`}\r\n                                        style={{ animationDelay: `${idx * 100}ms` }}\r\n                                    >\r\n                                        <span className=\"font-medium text-white\">{guess.name}</span>\r\n                                        <div className={`flex items-center gap-2 ${colorClass}`}>\r\n                                            <span className=\"text-xs uppercase font-bold\">{label}</span>\r\n                                            {icon}\r\n                                        </div>\r\n                                    </div>\r\n                                );\r\n                            })}\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\components\\HighScoreModal.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadHighScores` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\Johan\\repos\\guessthegame\\src\\components\\HighScoreModal.tsx:36:9\n  34 |\n  35 |     useEffect(() => {\n> 36 |         loadHighScores();\n     |         ^^^^^^^^^^^^^^ `loadHighScores` accessed before it is declared\n  37 |     }, []);\n  38 |\n  39 |     // Handle ESC key to close modal\n\nC:\\Users\\Johan\\repos\\guessthegame\\src\\components\\HighScoreModal.tsx:51:5\n  49 |     }, [onClose]);\n  50 |\n> 51 |     const loadHighScores = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 52 |         setLoading(true);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^\n> 53 |         const scores = await fetchHighScores();\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^\n> 54 |         setHighScores(scores);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^\n> 55 |         setLoading(false);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^\n> 56 |     };\n     | ^^^^^^^ `loadHighScores` is declared here\n  57 |\n  58 |     const handleSubmit = async (e: React.FormEvent) => {\n  59 |         e.preventDefault();","line":36,"column":9,"nodeType":null,"endLine":36,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { type HighScore, fetchHighScores, submitHighScore } from '../utils/api';\r\nimport { Trophy, RotateCcw, Send, X, Play } from 'lucide-react';\r\nimport { clsx } from 'clsx';\r\nimport { useIsMobile } from '../hooks/useIsMobile';\r\nimport type { GuessWithResult, LifelineType } from '../types';\r\n\r\ninterface HighScoreModalProps {\r\n    score: number;\r\n    onPlayAgain: () => void;\r\n    onClose: () => void;\r\n    runData?: {\r\n        history: Array<{\r\n            gameId: number;\r\n            score: number;\r\n            status: 'won' | 'skipped' | 'lost';\r\n            guesses: GuessWithResult[];\r\n            lifelinesUsed: LifelineType[];\r\n            correctAnswer: string;\r\n            cropPositions: Array<{ x: number; y: number }>;\r\n        }>;\r\n        totalScore: number;\r\n        totalGames: number;\r\n    };\r\n}\r\n\r\nexport const HighScoreModal: React.FC<HighScoreModalProps> = ({ score, onPlayAgain, onClose, runData }) => {\r\n    const [highScores, setHighScores] = useState<HighScore[]>([]);\r\n    const [name, setName] = useState('');\r\n    const [submitted, setSubmitted] = useState(false);\r\n    const [loading, setLoading] = useState(true);\r\n    const [submitting, setSubmitting] = useState(false);\r\n    const isMobile = useIsMobile();\r\n\r\n    useEffect(() => {\r\n        loadHighScores();\r\n    }, []);\r\n\r\n    // Handle ESC key to close modal\r\n    useEffect(() => {\r\n        const handleKeyDown = (e: KeyboardEvent) => {\r\n            if (e.key === 'Escape') {\r\n                onClose();\r\n            }\r\n        };\r\n\r\n        window.addEventListener('keydown', handleKeyDown);\r\n        return () => window.removeEventListener('keydown', handleKeyDown);\r\n    }, [onClose]);\r\n\r\n    const loadHighScores = async () => {\r\n        setLoading(true);\r\n        const scores = await fetchHighScores();\r\n        setHighScores(scores);\r\n        setLoading(false);\r\n    };\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!name.trim() || submitting) return;\r\n\r\n        setSubmitting(true);\r\n        let runId: string | undefined = undefined;\r\n\r\n        // Ensure we save the run first if data is available\r\n        if (runData) {\r\n            try {\r\n                const response = await fetch('/api/run/save', {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify(runData)\r\n                });\r\n\r\n                if (response.ok) {\r\n                    const data = await response.json();\r\n                    runId = data.id;\r\n                }\r\n            } catch (err) {\r\n                console.error(\"Failed to save run:\", err);\r\n            }\r\n        }\r\n\r\n        await submitHighScore(name, score, runId);\r\n        setSubmitted(true);\r\n        await loadHighScores();\r\n        setSubmitting(false);\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-in fade-in duration-300\">\r\n            <div className=\"bg-gray-900 border border-gray-700 rounded-2xl shadow-2xl max-w-md w-full overflow-hidden flex flex-col max-h-[90vh] relative\">\r\n                {/* Close Button */}\r\n                <button\r\n                    onClick={onClose}\r\n                    className=\"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors z-10 p-1 hover:bg-white/10 rounded-full\"\r\n                >\r\n                    <X size={24} />\r\n                </button>\r\n\r\n                {/* Header */}\r\n                <div className=\"p-6 bg-gradient-to-br from-purple-900/50 to-blue-900/50 border-b border-white/10 text-center\">\r\n                    <h2 className=\"text-3xl font-black text-white mb-2 tracking-tight\">GAME OVER</h2>\r\n                    <div className=\"flex flex-col items-center justify-center gap-1\">\r\n                        <span className=\"text-gray-400 text-sm uppercase tracking-widest font-bold\">Final Score</span>\r\n                        <span className=\"text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-500 drop-shadow-lg\">\r\n                            {score}\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <div className=\"p-6 flex-1 overflow-y-auto custom-scrollbar\">\r\n                    {!submitted ? (\r\n                        <form onSubmit={handleSubmit} className=\"mb-8\">\r\n                            <label className=\"block text-sm font-bold text-gray-400 mb-2 uppercase tracking-wider\">\r\n                                Enter your name\r\n                            </label>\r\n                            <div className=\"flex gap-2\">\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={name}\r\n                                    onChange={(e) => setName(e.target.value)}\r\n                                    maxLength={15}\r\n                                    placeholder=\"Player Name\"\r\n                                    className=\"flex-1 bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white font-bold focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder-gray-600\"\r\n                                    autoFocus={!isMobile}\r\n                                />\r\n                                <button\r\n                                    type=\"submit\"\r\n                                    disabled={!name.trim() || submitting}\r\n                                    className=\"bg-blue-600 hover:bg-blue-500 disabled:bg-gray-700 disabled:text-gray-500 text-white px-4 py-2 rounded-lg font-bold transition-colors flex items-center justify-center\"\r\n                                >\r\n                                    {submitting ? (\r\n                                        <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                                    ) : (\r\n                                        <Send size={20} />\r\n                                    )}\r\n                                </button>\r\n                            </div>\r\n                        </form>\r\n                    ) : (\r\n                        <div className=\"mb-6 p-4 bg-green-500/10 border border-green-500/20 rounded-xl text-center animate-in zoom-in duration-300\">\r\n                            <p className=\"text-green-400 font-bold\">Score Submitted!</p>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"space-y-3\">\r\n                        <div className=\"flex items-center justify-between mb-4\">\r\n                            <h3 className=\"text-lg font-bold text-white flex items-center gap-2\">\r\n                                <Trophy className=\"text-yellow-400\" size={20} />\r\n                                Global Leaderboard\r\n                            </h3>\r\n                        </div>\r\n\r\n                        {loading ? (\r\n                            <div className=\"flex justify-center py-8\">\r\n                                <div className=\"w-8 h-8 border-4 border-blue-500/30 border-t-blue-500 rounded-full animate-spin\" />\r\n                            </div>\r\n                        ) : highScores.length === 0 ? (\r\n                            <div className=\"text-center py-8 text-gray-500 italic\">\r\n                                No scores yet. Be the first!\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"space-y-2\">\r\n                                {highScores.map((s, idx) => (\r\n                                    <div\r\n                                        key={idx}\r\n                                        className={clsx(\r\n                                            \"flex items-center justify-between p-3 rounded-lg border\",\r\n                                            s.name === name && submitted ? \"bg-blue-500/20 border-blue-500/50\" : \"bg-gray-800/50 border-white/5\"\r\n                                        )}\r\n                                    >\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            <span className={clsx(\r\n                                                \"font-mono font-bold w-6 text-right\",\r\n                                                idx === 0 ? \"text-yellow-400\" :\r\n                                                    idx === 1 ? \"text-gray-300\" :\r\n                                                        idx === 2 ? \"text-orange-400\" : \"text-gray-600\"\r\n                                            )}>\r\n                                                {idx + 1}\r\n                                            </span>\r\n                                            <div className=\"flex flex-col\">\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <span className=\"font-bold text-gray-200 truncate max-w-[120px]\">\r\n                                                        {s.name}\r\n                                                    </span>\r\n                                                    {s.runId && (\r\n                                                        <a\r\n                                                            href={`/share/${s.runId}`}\r\n                                                            target=\"_blank\"\r\n                                                            rel=\"noopener noreferrer\"\r\n                                                            className=\"text-white/40 hover:text-blue-400 transition-colors\"\r\n                                                            title=\"Watch Run\"\r\n                                                        >\r\n                                                            <Play size={12} fill=\"currentColor\" />\r\n                                                        </a>\r\n                                                    )}\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                        <span className=\"font-mono font-bold text-yellow-500\">\r\n                                            {s.score}\r\n                                        </span>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Footer */}\r\n                <div className=\"p-4 bg-gray-800/80 border-t border-white/5 backdrop-blur-sm\">\r\n                    <button\r\n                        onClick={onPlayAgain}\r\n                        className=\"w-full bg-white text-black hover:bg-gray-200 py-3 rounded-xl font-black text-lg uppercase tracking-wide transition-transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2\"\r\n                    >\r\n                        <RotateCcw size={20} />\r\n                        Play Again\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\components\\InfoPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\components\\Layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\components\\Lifelines.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\components\\MobileTutorialModal.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Johan\\repos\\guessthegame\\src\\components\\MobileTutorialModal.tsx:190:13\n  188 |     useEffect(() => {\n  189 |         if (isOpen) {\n> 190 |             setCurrentStep(0);\n      |             ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  191 |             setDirection(0);\n  192 |         }\n  193 |     }, [isOpen]);","line":190,"column":13,"nodeType":null,"endLine":190,"endColumn":27}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport type { PanInfo } from 'framer-motion';\r\nimport {\r\n    Gamepad2,\r\n    BookOpen,\r\n    Search,\r\n    Flame,\r\n    LifeBuoy,\r\n    ShoppingCart,\r\n    X,\r\n    Sparkles,\r\n    Target,\r\n    Trophy,\r\n    Coins,\r\n    Eye,\r\n    SkipForward,\r\n    Shuffle,\r\n    HelpCircle,\r\n    ZoomOut,\r\n    FileText\r\n} from 'lucide-react';\r\nimport { clsx } from 'clsx';\r\nimport { TutorialSimulation } from './TutorialSimulation';\r\n\r\ninterface MobileTutorialModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    onComplete: () => void;\r\n}\r\n\r\ninterface TutorialStep {\r\n    icon: React.ReactNode;\r\n    title: string;\r\n    content: React.ReactNode;\r\n    accentColor: string;\r\n}\r\n\r\nconst tutorialSteps: TutorialStep[] = [\r\n    {\r\n        icon: <Gamepad2 size={32} />,\r\n        title: \"Welcome!\",\r\n        accentColor: \"from-purple-500 to-pink-500\",\r\n        content: (\r\n            <div className=\"space-y-4\">\r\n                <p className=\"text-base text-gray-300\">\r\n                    Identify games from their screenshots.\r\n                </p>\r\n                <div className=\"flex items-center gap-3 p-3 bg-white/5 rounded-xl border border-white/10\">\r\n                    <Sparkles className=\"text-yellow-400 flex-shrink-0\" size={20} />\r\n                    <p className=\"text-xs text-gray-400\">\r\n                        Over <span className=\"text-white font-bold\">2600+ games</span>!\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        )\r\n    },\r\n    {\r\n        icon: <BookOpen size={32} />,\r\n        title: \"Standard Mode\",\r\n        accentColor: \"from-blue-500 to-cyan-500\",\r\n        content: (\r\n            <div className=\"space-y-3 px-1\">\r\n                <div className=\"flex items-center gap-3 p-2 bg-white/5 rounded-lg border border-white/5\">\r\n                    <Target className=\"text-blue-400 flex-shrink-0\" size={18} />\r\n                    <div className=\"text-left\">\r\n                        <p className=\"text-white font-medium text-sm\">Relaxed Play</p>\r\n                        <p className=\"text-xs text-gray-400\">No timers, no pressure</p>\r\n                    </div>\r\n                </div>\r\n                <div className=\"flex items-center gap-3 p-2 bg-white/5 rounded-lg border border-white/5\">\r\n                    <Trophy className=\"text-yellow-400 flex-shrink-0\" size={18} />\r\n                    <div className=\"text-left\">\r\n                        <p className=\"text-white font-medium text-sm\">Auto-Save</p>\r\n                        <p className=\"text-xs text-gray-400\">Continue anytime</p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        )\r\n    },\r\n    {\r\n        icon: <Search size={32} />,\r\n        title: \"Progressive Reveal\",\r\n        accentColor: \"from-green-500 to-emerald-500\",\r\n        content: (\r\n            <div className=\"space-y-2\">\r\n                <p className=\"text-gray-300 text-xs\">\r\n                    Wrong guesses reveal more of the image!\r\n                </p>\r\n                <div className=\"rounded-lg overflow-hidden border border-white/10\">\r\n                    <TutorialSimulation />\r\n                </div>\r\n            </div>\r\n        )\r\n    },\r\n    {\r\n        icon: <Flame size={32} />,\r\n        title: \"Endless Mode\",\r\n        accentColor: \"from-orange-500 to-red-500\",\r\n        content: (\r\n            <div className=\"space-y-4\">\r\n                <div className=\"p-3 bg-gradient-to-r from-red-500/10 to-orange-500/10 rounded-xl border border-red-500/20\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center text-xl\">\r\n                            \r\n                        </div>\r\n                        <div className=\"text-left\">\r\n                            <p className=\"text-white font-bold text-sm\">5 Violations = Over</p>\r\n                            <p className=\"text-[10px] text-red-400\">Survival of the fittest</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"grid grid-cols-5 gap-1 text-center\">\r\n                    {[5, 4, 3, 2, 1].map((pts, idx) => (\r\n                        <div key={pts} className=\"p-1.5 bg-white/5 rounded\">\r\n                            <p className=\"text-sm font-bold text-orange-400\">+{pts}</p>\r\n                            <p className=\"text-[8px] text-gray-500\">G{idx + 1}</p>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n        )\r\n    },\r\n    {\r\n        icon: <LifeBuoy size={32} />,\r\n        title: \"Lifelines\",\r\n        accentColor: \"from-cyan-500 to-blue-500\",\r\n        content: (\r\n            <div className=\"grid grid-cols-2 gap-2 text-left\">\r\n                <div className=\"p-2 bg-white/5 rounded flex items-center gap-2\">\r\n                    <Eye className=\"text-purple-400\" size={14} />\r\n                    <span className=\"text-[10px] text-white\">Cover Peek</span>\r\n                </div>\r\n                <div className=\"p-2 bg-white/5 rounded flex items-center gap-2\">\r\n                    <SkipForward className=\"text-red-400\" size={14} />\r\n                    <span className=\"text-[10px] text-white\">Skip Level</span>\r\n                </div>\r\n                <div className=\"p-2 bg-white/5 rounded flex items-center gap-2\">\r\n                    <Shuffle className=\"text-purple-400\" size={14} />\r\n                    <span className=\"text-[10px] text-white\">Anagram</span>\r\n                </div>\r\n                <div className=\"p-2 bg-white/5 rounded flex items-center gap-2\">\r\n                    <HelpCircle className=\"text-green-400\" size={14} />\r\n                    <span className=\"text-[10px] text-white\">Consultant</span>\r\n                </div>\r\n                <div className=\"p-2 bg-white/5 rounded flex items-center gap-2\">\r\n                    <Gamepad2 className=\"text-yellow-400\" size={14} />\r\n                    <span className=\"text-[10px] text-white\">Double Trouble</span>\r\n                </div>\r\n                <div className=\"p-2 bg-white/5 rounded flex items-center gap-2\">\r\n                    <ZoomOut className=\"text-blue-400\" size={14} />\r\n                    <span className=\"text-[10px] text-white\">Zoom Out</span>\r\n                </div>\r\n                <div className=\"p-2 bg-white/5 rounded flex items-center gap-2 col-span-2\">\r\n                    <FileText className=\"text-green-400\" size={14} />\r\n                    <span className=\"text-[10px] text-white\">Synopsis</span>\r\n                </div>\r\n            </div>\r\n        )\r\n    },\r\n    {\r\n        icon: <ShoppingCart size={32} />,\r\n        title: \"The Shop\",\r\n        accentColor: \"from-yellow-500 to-amber-500\",\r\n        content: (\r\n            <div className=\"space-y-4\">\r\n                <p className=\"text-xs text-gray-400\">\r\n                    Appears every <span className=\"text-yellow-400 font-bold\">5 levels</span> in Endless Mode.\r\n                </p>\r\n                <div className=\"flex items-center gap-3 p-3 bg-gradient-to-r from-yellow-500/10 to-amber-500/10 rounded-lg border border-yellow-500/20\">\r\n                    <Coins className=\"text-yellow-400\" size={24} />\r\n                    <div className=\"text-left\">\r\n                        <p className=\"text-white font-bold text-sm\">Buy Power-ups</p>\r\n                        <p className=\"text-[10px] text-gray-400\">Spend points to survive</p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n];\r\n\r\nconst swipeThreshold = 50;\r\n\r\nexport function MobileTutorialModal({ isOpen, onClose, onComplete }: MobileTutorialModalProps) {\r\n    const [currentStep, setCurrentStep] = useState(0);\r\n    const [direction, setDirection] = useState(0);\r\n\r\n    useEffect(() => {\r\n        if (isOpen) {\r\n            setCurrentStep(0);\r\n            setDirection(0);\r\n        }\r\n    }, [isOpen]);\r\n\r\n    const handleDragEnd = (_: MouseEvent | TouchEvent | PointerEvent, info: PanInfo) => {\r\n        const { offset: { x } } = info;\r\n\r\n        if (x < -swipeThreshold && currentStep < tutorialSteps.length - 1) {\r\n            // Swiped left -> next\r\n            setDirection(1);\r\n            setCurrentStep(prev => prev + 1);\r\n        } else if (x > swipeThreshold && currentStep > 0) {\r\n            // Swiped right -> prev\r\n            setDirection(-1);\r\n            setCurrentStep(prev => prev - 1);\r\n        }\r\n    };\r\n\r\n    const handleComplete = () => {\r\n        onComplete();\r\n        onClose();\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    const step = tutorialSteps[currentStep];\r\n    const isLastStep = currentStep === tutorialSteps.length - 1;\r\n\r\n    const variants = {\r\n        enter: (direction: number) => ({\r\n            x: direction > 0 ? '100%' : '-100%',\r\n            opacity: 0,\r\n            scale: 0.95\r\n        }),\r\n        center: {\r\n            zIndex: 1,\r\n            x: 0,\r\n            opacity: 1,\r\n            scale: 1,\r\n            transition: {\r\n                type: \"spring\" as const,\r\n                stiffness: 300,\r\n                damping: 30\r\n            }\r\n        },\r\n        exit: (direction: number) => ({\r\n            zIndex: 0,\r\n            x: direction < 0 ? '100%' : '-100%',\r\n            opacity: 0,\r\n            scale: 0.95,\r\n            transition: {\r\n                type: \"spring\" as const,\r\n                stiffness: 300,\r\n                damping: 30\r\n            }\r\n        })\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-[100] flex flex-col bg-background/95 backdrop-blur-xl\">\r\n            {/* Close button */}\r\n            <div className=\"absolute top-4 right-4 z-30\">\r\n                <button\r\n                    onClick={onClose}\r\n                    className=\"p-2 text-white/50 hover:text-white\"\r\n                >\r\n                    <X size={24} />\r\n                </button>\r\n            </div>\r\n\r\n            {/* Swipeable Content Area */}\r\n            <div className=\"flex-1 relative w-full overflow-hidden flex flex-col justify-center\">\r\n                <AnimatePresence initial={false} custom={direction}>\r\n                    <motion.div\r\n                        key={currentStep}\r\n                        custom={direction}\r\n                        variants={variants}\r\n                        initial=\"enter\"\r\n                        animate=\"center\"\r\n                        exit=\"exit\"\r\n                        drag=\"x\"\r\n                        dragConstraints={{ left: 0, right: 0 }}\r\n                        dragElastic={0.2}\r\n                        onDragEnd={handleDragEnd}\r\n                        className=\"absolute inset-0 px-6 py-4 flex flex-col items-center justify-center text-center w-full h-full cursor-grab active:cursor-grabbing\"\r\n                    >\r\n                        {/* Special full-height layout for simulation step (index 2) */}\r\n                        {currentStep === 2 ? (\r\n                            <div className=\"flex-1 flex flex-col w-full max-w-md px-2\">\r\n                                <p className=\"text-gray-300 text-xs text-center mb-2\">\r\n                                    Wrong guesses reveal more of the image!\r\n                                </p>\r\n                                <div className=\"flex-1 rounded-lg overflow-hidden border border-white/10 min-h-0\">\r\n                                    <TutorialSimulation />\r\n                                </div>\r\n                            </div>\r\n                        ) : (\r\n                            <>\r\n                                {/* Icon Bubble */}\r\n                                <div className={clsx(\r\n                                    \"w-16 h-16 rounded-2xl bg-gradient-to-br flex items-center justify-center text-white mb-4 shadow-2xl relative\",\r\n                                    step.accentColor\r\n                                )}>\r\n                                    <div className=\"absolute inset-0 rounded-2xl bg-white/20 animate-pulse\"></div>\r\n                                    {step.icon}\r\n                                </div>\r\n\r\n                                {/* Title */}\r\n                                <h2 className=\"text-2xl font-bold text-white mb-4 tracking-tight relative\">\r\n                                    {step.title}\r\n                                    <span className={clsx(\"absolute -bottom-1 left-1/2 -translate-x-1/2 w-10 h-0.5 rounded-full opacity-50 bg-gradient-to-r\", step.accentColor)}></span>\r\n                                </h2>\r\n\r\n                                {/* Content */}\r\n                                <div className=\"w-full max-w-sm\">\r\n                                    {step.content}\r\n                                </div>\r\n\r\n                                {/* Tap to finish on last step */}\r\n                                {isLastStep && (\r\n                                    <button\r\n                                        onClick={handleComplete}\r\n                                        className=\"mt-6 px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-bold rounded-full shadow-lg flex items-center gap-2 active:scale-95 transition-transform\"\r\n                                    >\r\n                                        Let's Play <Sparkles size={18} />\r\n                                    </button>\r\n                                )}\r\n                            </>\r\n                        )}\r\n                    </motion.div>\r\n                </AnimatePresence>\r\n            </div>\r\n\r\n            {/* Dot indicators at bottom */}\r\n            <div className=\"pb-8 pt-4 z-20 flex justify-center gap-2\">\r\n                {tutorialSteps.map((_, idx) => (\r\n                    <div\r\n                        key={idx}\r\n                        className={clsx(\r\n                            \"rounded-full transition-all duration-300\",\r\n                            idx === currentStep\r\n                                ? \"w-6 h-2 bg-white\"\r\n                                : \"w-2 h-2 bg-white/30\"\r\n                        )}\r\n                    />\r\n                ))}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\components\\PageTransition.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\components\\RunSummary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\components\\ScreenshotViewer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\components\\SearchInput.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'correctAnswers'. Either include it or remove the dependency array.","line":96,"column":8,"nodeType":"ArrayExpression","endLine":96,"endColumn":48,"suggestions":[{"desc":"Update the dependencies array to be: [correctAnswers, searchQuery]","fix":{"range":[3820,3860],"text":"[correctAnswers, searchQuery]"}}]},{"ruleId":"react-hooks/use-memo","severity":2,"message":"Error: Expected the dependency list to be an array of simple expressions (e.g. `x`, `x.y.z`, `x?.y?.z`)\n\nExpected the dependency list to be an array of simple expressions (e.g. `x`, `x.y.z`, `x?.y?.z`).\n\nC:\\Users\\Johan\\repos\\guessthegame\\src\\components\\SearchInput.tsx:96:22\n  94 |\n  95 |         return uniqueResults;\n> 96 |     }, [searchQuery, correctAnswers?.join(',')]);\n     |                      ^^^^^^^^^^^^^^^^^^^^^^^^^ Expected the dependency list to be an array of simple expressions (e.g. `x`, `x.y.z`, `x?.y?.z`)\n  97 |\n  98 |     useEffect(() => {\n  99 |         setSelectedIndex(0);","line":96,"column":22,"nodeType":null,"endLine":96,"endColumn":47},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a complex expression in the dependency array. Extract it to a separate variable so it can be statically checked.","line":96,"column":22,"nodeType":"ChainExpression","endLine":96,"endColumn":47}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport React, { useState, useMemo, useRef, useEffect } from 'react';\r\nimport { Search, Send } from 'lucide-react';\r\nimport { clsx } from 'clsx';\r\nimport type { Game } from '../types';\r\nimport { initializeSearchIndex, search } from '../utils/searchIndex';\r\n\r\ninterface SearchInputProps {\r\n    readonly games: Game[];\r\n    readonly onGuess: (name: string) => void;\r\n    readonly disabled: boolean;\r\n    readonly autoFocus?: boolean;\r\n    readonly correctAnswers?: string[];\r\n    readonly hideResults?: boolean;\r\n}\r\n\r\nexport function SearchInput({ games, onGuess, disabled, autoFocus, correctAnswers, hideResults }: SearchInputProps) {\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [displayValue, setDisplayValue] = useState('');\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const [selectedIndex, setSelectedIndex] = useState(0);\r\n    const inputRef = useRef<HTMLInputElement>(null);\r\n    const listRef = useRef<HTMLUListElement>(null);\r\n    const skipNextFocus = useRef(false);\r\n\r\n    // Auto-focus when enabled, but check for touch devices to avoid keyboard popping up\r\n    useEffect(() => {\r\n        if (!disabled && autoFocus && inputRef.current) {\r\n            // Check if device supports touch (likely mobile/tablet)\r\n            const isTouch = window.matchMedia('(pointer: coarse)').matches;\r\n            if (isTouch) return;\r\n\r\n            // Small timeout to ensure DOM is ready and prevent fighting with other focus events\r\n            const timer = setTimeout(() => {\r\n                inputRef.current?.focus();\r\n            }, 10);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [disabled, autoFocus]);\r\n\r\n    // Initialize search index\r\n    useMemo(() => {\r\n        initializeSearchIndex(games);\r\n    }, [games]);\r\n\r\n    const results = useMemo(() => {\r\n        if (!searchQuery) return [];\r\n        const allResults = search(searchQuery);\r\n\r\n        // Deduplicate by name (case-insensitive)\r\n        const seen = new Set<string>();\r\n        const uniqueResults = allResults.filter(result => {\r\n            const lowerName = result.name.toLowerCase();\r\n            if (seen.has(lowerName)) {\r\n                return false;\r\n            }\r\n            seen.add(lowerName);\r\n            return true;\r\n        });\r\n\r\n        // Prioritize correct answers if they exist in the results\r\n        if (correctAnswers && correctAnswers.length > 0) {\r\n            const correctMatches: typeof uniqueResults = [];\r\n            const otherMatches: typeof uniqueResults = [];\r\n\r\n            uniqueResults.forEach(result => {\r\n                if (correctAnswers.includes(result.name)) {\r\n                    correctMatches.push(result);\r\n                } else {\r\n                    otherMatches.push(result);\r\n                }\r\n            });\r\n\r\n            // If we found correct matches, shuffle them into the top 5\r\n            if (correctMatches.length > 0) {\r\n                // Take enough other matches to fill up to 5 slots (or less if not enough results)\r\n                const poolSize = 5;\r\n                const slotsNeeded = Math.max(0, poolSize - correctMatches.length);\r\n                const topOthers = otherMatches.slice(0, slotsNeeded);\r\n                const remainingOthers = otherMatches.slice(slotsNeeded);\r\n\r\n                // Combine and shuffle the top pool\r\n                const topPool = [...correctMatches, ...topOthers];\r\n\r\n                // Fisher-Yates shuffle for the top pool\r\n                for (let i = topPool.length - 1; i > 0; i--) {\r\n                    const j = Math.floor(Math.random() * (i + 1));\r\n                    [topPool[i], topPool[j]] = [topPool[j], topPool[i]];\r\n                }\r\n\r\n                return [...topPool, ...remainingOthers];\r\n            }\r\n        }\r\n\r\n        return uniqueResults;\r\n    }, [searchQuery, correctAnswers?.join(',')]);\r\n\r\n    useEffect(() => {\r\n        setSelectedIndex(0);\r\n    }, [results]);\r\n\r\n    useEffect(() => {\r\n        if (isOpen && listRef.current) {\r\n            const selectedElement = listRef.current.children[selectedIndex] as HTMLElement;\r\n            if (selectedElement) {\r\n                selectedElement.scrollIntoView({ block: 'nearest' });\r\n            }\r\n        }\r\n    }, [selectedIndex, isOpen]);\r\n\r\n    const handleSubmit = (e?: React.FormEvent) => {\r\n        e?.preventDefault();\r\n        if (disabled) return;\r\n\r\n        if (results.length > 0 && isOpen) {\r\n            submitGuess(results[selectedIndex].name);\r\n        } else if (displayValue) {\r\n            // If exact match exists in database, allow it\r\n            const potentialMatches = search(displayValue);\r\n            const exactMatch = potentialMatches.find(g => g.name.toLowerCase() === displayValue.toLowerCase());\r\n\r\n            if (exactMatch) {\r\n                submitGuess(exactMatch.name);\r\n            }\r\n        }\r\n    };\r\n\r\n    const submitGuess = (name: string) => {\r\n        onGuess(name);\r\n        setSearchQuery('');\r\n        setDisplayValue('');\r\n        setIsOpen(false);\r\n    };\r\n\r\n    const fillQuery = (name: string) => {\r\n        setSearchQuery(name);\r\n        setDisplayValue(name);\r\n        setIsOpen(false);\r\n        skipNextFocus.current = true;\r\n        inputRef.current?.focus();\r\n    };\r\n\r\n    const handleKeyDown = (e: React.KeyboardEvent) => {\r\n        if (e.key === 'ArrowDown') {\r\n            e.preventDefault();\r\n            const nextIndex = (selectedIndex + 1) % results.length;\r\n            setSelectedIndex(nextIndex);\r\n            if (results[nextIndex]) {\r\n                setDisplayValue(results[nextIndex].name);\r\n            }\r\n        } else if (e.key === 'ArrowUp') {\r\n            e.preventDefault();\r\n            const prevIndex = (selectedIndex - 1 + results.length) % results.length;\r\n            setSelectedIndex(prevIndex);\r\n            if (results[prevIndex]) {\r\n                setDisplayValue(results[prevIndex].name);\r\n            }\r\n        } else if (e.key === 'Escape') {\r\n            setIsOpen(false);\r\n        }\r\n    };\r\n\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n    // Handle click outside\r\n    useEffect(() => {\r\n        const handleClickOutside = (event: MouseEvent) => {\r\n            if (containerRef.current && !containerRef.current.contains(event.target as Node)) {\r\n                setIsOpen(false);\r\n            }\r\n        };\r\n\r\n        document.addEventListener('mousedown', handleClickOutside);\r\n        return () => {\r\n            document.removeEventListener('mousedown', handleClickOutside);\r\n        };\r\n    }, []);\r\n\r\n    return (\r\n        <div ref={containerRef} className=\"relative w-full z-20\">\r\n            <form onSubmit={handleSubmit} className=\"relative\">\r\n                <div className=\"relative group\">\r\n                    <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                        <Search className=\"text-muted group-focus-within:text-primary transition-colors\" size={18} />\r\n                    </div>\r\n                    <input\r\n                        ref={inputRef}\r\n                        type=\"text\"\r\n                        value={displayValue}\r\n                        onChange={e => {\r\n                            const val = e.target.value;\r\n                            setSearchQuery(val);\r\n                            setDisplayValue(val);\r\n                            setIsOpen(true);\r\n                        }}\r\n                        onFocus={() => {\r\n                            if (skipNextFocus.current) {\r\n                                skipNextFocus.current = false;\r\n                                return;\r\n                            }\r\n                            setIsOpen(true);\r\n                        }}\r\n                        onClick={() => setIsOpen(true)}\r\n                        onKeyDown={handleKeyDown}\r\n                        disabled={disabled}\r\n                        placeholder={disabled ? \"Game Over\" : \"Type to search for a game...\"}\r\n                        className=\"w-full pl-11 pr-11 py-2.5 glass-panel rounded-xl text-base text-text focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all shadow-lg placeholder:text-muted\"\r\n                    />\r\n                    <button\r\n                        type=\"submit\"\r\n                        disabled={disabled || !displayValue}\r\n                        className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-muted hover:text-white disabled:opacity-50 transition-colors\"\r\n                    >\r\n                        <Send size={18} />\r\n                    </button>\r\n                </div>\r\n            </form>\r\n\r\n            {isOpen && !hideResults && results.length > 0 && (\r\n                <ul\r\n                    ref={listRef}\r\n                    className=\"absolute w-full mt-2 bg-surface border border-white/10 rounded-xl shadow-2xl overflow-hidden max-h-48 overflow-y-auto custom-scrollbar animate-in fade-in slide-in-from-top-2\"\r\n                >\r\n                    {results.map((game, idx) => {\r\n                        const isSelected = idx === selectedIndex;\r\n                        const buttonClass = isSelected\r\n                            ? \"bg-primary/20 text-white\"\r\n                            : \"text-muted hover:bg-white/5 hover:text-white\";\r\n\r\n                        return (\r\n                            <li key={game.id}>\r\n                                <button\r\n                                    onClick={() => fillQuery(game.name)}\r\n                                    className={clsx(\r\n                                        \"w-full text-left px-3 py-2 flex items-center justify-between transition-colors text-sm\",\r\n                                        buttonClass\r\n                                    )}\r\n                                >\r\n                                    <span className=\"font-medium\">{game.name}</span>\r\n                                </button>\r\n                            </li>\r\n                        );\r\n                    })}\r\n                </ul>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\components\\SettingsModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\components\\ShopModal.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'items'. Either include it or remove the dependency array.","line":32,"column":8,"nodeType":"ArrayExpression","endLine":32,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [items]","fix":{"range":[1209,1211],"text":"[items]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport confetti from 'canvas-confetti';\r\nimport { getShopItems } from '../utils/endlessUtils';\r\n\r\ninterface ShopModalProps {\r\n    score: number;\r\n    onBuy: (itemId: string, cost?: number) => void;\r\n    onContinue: () => void;\r\n}\r\n\r\nexport const ShopModal: React.FC<ShopModalProps> = ({ score, onBuy, onContinue }) => {\r\n    const items = getShopItems();\r\n    const [purchasedItems, setPurchasedItems] = useState<Set<string>>(new Set());\r\n    const [discountedItemIds, setDiscountedItemIds] = useState<Set<string>>(new Set());\r\n\r\n    const modalRef = React.useRef<HTMLDivElement>(null);\r\n\r\n    // Randomize discounts on mount\r\n    // Randomize discounts on mount\r\n    useEffect(() => {\r\n        const eligibleItems = items.filter(i => i.id !== 'greed');\r\n\r\n        // Fisher-Yates shuffle\r\n        const shuffled = [...eligibleItems];\r\n        for (let i = shuffled.length - 1; i > 0; i--) {\r\n            const j = Math.floor(Math.random() * (i + 1));\r\n            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\r\n        }\r\n\r\n        const selected = new Set(shuffled.slice(0, 2).map(i => i.id));\r\n        setDiscountedItemIds(selected);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        // Grand entrance effect\r\n        const duration = 3000;\r\n        const end = Date.now() + duration;\r\n\r\n        const getOrigins = () => {\r\n            if (!modalRef.current) return { left: 0, right: 1, top: 0.6 };\r\n            const rect = modalRef.current.getBoundingClientRect();\r\n            return {\r\n                left: rect.left / window.innerWidth,\r\n                right: rect.right / window.innerWidth,\r\n                top: (rect.top + rect.height / 2) / window.innerHeight\r\n            };\r\n        };\r\n\r\n        // 1. Central explosion\r\n        confetti({\r\n            particleCount: 75,\r\n            spread: 100,\r\n            origin: { y: 0.6 },\r\n            colors: ['#FFD700', '#FFA500', '#FFFFFF', '#FF0000'],\r\n            zIndex: 10000 // Higher than modal\r\n        });\r\n\r\n        // 2. Side cannons\r\n        (function frame() {\r\n            const origins = getOrigins();\r\n\r\n            confetti({\r\n                particleCount: 2,\r\n                angle: 135, // Angle pointing slightly up and out from right side of modal (relative to origin)\r\n                spread: 55,\r\n                origin: { x: origins.left, y: origins.top }, // Left side of modal\r\n                colors: ['#FFD700', '#FFA500'],\r\n                zIndex: 10000\r\n            });\r\n\r\n            confetti({\r\n                particleCount: 2,\r\n                angle: 40,\r\n                spread: 55,\r\n                origin: { x: origins.right, y: origins.top },\r\n                colors: ['#FFD700', '#FFA500'],\r\n                zIndex: 10000\r\n            });\r\n\r\n            if (Date.now() < end) {\r\n                requestAnimationFrame(frame);\r\n            }\r\n        }());\r\n    }, []);\r\n\r\n    // Check if \"Greed is Good\" has been purchased\r\n    const greedPurchased = purchasedItems.has('greed');\r\n    // Check if any other item has been purchased\r\n    const otherItemPurchased = Array.from(purchasedItems).some(id => id !== 'greed');\r\n\r\n    const handleBuy = (itemId: string, cost: number) => {\r\n        // Mark item as purchased\r\n        setPurchasedItems(prev => new Set(prev).add(itemId));\r\n        // Call the original onBuy handler\r\n        onBuy(itemId, cost);\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/80 flex items-center justify-center z-40 p-4\">\r\n            <div ref={modalRef} className=\"bg-gray-900 border border-gray-700 rounded-xl p-6 max-w-2xl w-full shadow-2xl\">\r\n                <h2 className=\"text-3xl font-bold text-white mb-2 text-center\">The Shop</h2>\r\n                <p className=\"text-gray-400 text-center mb-8\">Spend your hard-earned points to survive longer.</p>\r\n\r\n                <div className=\"flex justify-center mb-8\">\r\n                    <div className=\"bg-gray-800 px-6 py-3 rounded-lg border border-yellow-500/30\">\r\n                        <span className=\"text-gray-400 mr-2\">Current Score:</span>\r\n                        <span className=\"text-2xl font-bold text-yellow-400\">{score}</span>\r\n                    </div>\r\n                </div>\r\n\r\n                {greedPurchased && (\r\n                    <div className=\"mb-4 p-3 bg-orange-900/30 border border-orange-500/50 rounded-lg\">\r\n                        <p className=\"text-orange-300 text-sm text-center font-medium\">\r\n                             You chose Greed is Good - all other shop items are now unavailable!\r\n                        </p>\r\n                    </div>\r\n                )}\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8\">\r\n                    {items.map((item) => {\r\n                        const isDiscounted = discountedItemIds.has(item.id);\r\n                        const originalCost = item.cost;\r\n                        const finalCost = isDiscounted ? originalCost - 1 : originalCost;\r\n\r\n                        const canAfford = score >= finalCost;\r\n                        const isGreed = item.id === 'greed';\r\n                        const alreadyPurchased = purchasedItems.has(item.id);\r\n\r\n                        // Determine if item should be disabled\r\n                        const isDisabled =\r\n                            alreadyPurchased ||\r\n                            !canAfford ||\r\n                            (isGreed && otherItemPurchased) ||\r\n                            (!isGreed && greedPurchased);\r\n\r\n                        // Enhanced description for Greed is Good\r\n                        const description = isGreed\r\n                            ? `${item.description}  WARNING: Choosing this will lock out all other shop items!`\r\n                            : item.description;\r\n\r\n                        return (\r\n                            <div\r\n                                key={item.id}\r\n                                className={`bg-gray-800 border rounded-lg p-4 flex flex-col transition-opacity ${isDisabled && !canAfford ? 'opacity-40' :\r\n                                    isDisabled ? 'opacity-50' : 'opacity-100'\r\n                                    } ${isGreed && !isDisabled ? 'border-orange-500/50' : 'border-gray-700'\r\n                                    } relative overflow-hidden`}\r\n                            >\r\n                                {isDiscounted && !isDisabled && !alreadyPurchased && (\r\n                                    <div className=\"absolute top-0 right-0 bg-red-600 text-white text-[10px] uppercase font-bold px-2 py-0.5 rounded-bl-lg shadow-md animate-pulse\">\r\n                                        Discount!\r\n                                    </div>\r\n                                )}\r\n                                <h3 className=\"text-lg font-bold text-white mb-1\">{item.name}</h3>\r\n                                <p className={`text-sm mb-4 flex-grow ${isGreed ? 'text-orange-300' : 'text-gray-400'\r\n                                    }`}>\r\n                                    {description}\r\n                                </p>\r\n                                <div className=\"flex items-center justify-between mt-auto\">\r\n                                    <div className=\"flex flex-col\">\r\n                                        {isDiscounted ? (\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <span className=\"text-xs text-gray-500 line-through\">{originalCost} pts</span>\r\n                                                <span className=\"font-bold text-green-400\">{finalCost} pts</span>\r\n                                            </div>\r\n                                        ) : (\r\n                                            <span className={`font-bold ${item.cost < 0 ? 'text-green-400' : 'text-yellow-400'}`}>\r\n                                                {item.cost < 0 ? `+${Math.abs(item.cost)}` : item.cost} pts\r\n                                            </span>\r\n                                        )}\r\n                                    </div>\r\n                                    <button\r\n                                        onClick={() => handleBuy(item.id, finalCost)}\r\n                                        disabled={isDisabled}\r\n                                        className={`px-3 py-1 rounded text-sm font-medium transition-colors ${!isDisabled\r\n                                            ? 'bg-blue-600 hover:bg-blue-500 text-white cursor-pointer'\r\n                                            : 'bg-gray-700 text-gray-500 cursor-not-allowed'\r\n                                            }`}\r\n                                    >\r\n                                        {alreadyPurchased ? 'Purchased' : 'Buy'}\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n\r\n                <div className=\"flex justify-center\">\r\n                    <button\r\n                        onClick={onContinue}\r\n                        className=\"px-8 py-3 bg-green-600 hover:bg-green-500 text-white font-bold rounded-lg transition-colors text-lg\"\r\n                    >\r\n                        Continue Run\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\components\\Sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\components\\StatsModal.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot reassign variable after render completes\n\nReassigning `cumulativePercent` after render has completed can cause inconsistent behavior on subsequent renders. Consider using state instead.\n\nC:\\Users\\Johan\\repos\\guessthegame\\src\\components\\StatsModal.tsx:45:9\n  43 |         const percent = genreTotal > 0 ? (data.total / genreTotal) * 100 : 0;\n  44 |         const start = cumulativePercent;\n> 45 |         cumulativePercent += percent;\n     |         ^^^^^^^^^^^^^^^^^ Cannot reassign `cumulativePercent` after render completes\n  46 |         return `${GENRE_COLORS[idx % GENRE_COLORS.length]} ${start}% ${cumulativePercent}%`;\n  47 |     });\n  48 |     const pieGradient = pieSegments.length > 0","line":45,"column":9,"nodeType":null,"endLine":45,"endColumn":26}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { X, RotateCcw, Trophy, Target, TrendingUp } from 'lucide-react';\r\nimport type { EndlessStats } from '../hooks/useEndlessStats';\r\n\r\ninterface StatsModalProps {\r\n    stats: EndlessStats;\r\n    totalGames: number;\r\n    winRate: number;\r\n    averageGuesses: number;\r\n    onReset: () => void;\r\n    onClose: () => void;\r\n}\r\n\r\n// Colors for the charts\r\nconst GENRE_COLORS = [\r\n    '#f43f5e', '#f97316', '#eab308', '#22c55e', '#06b6d4',\r\n    '#3b82f6', '#8b5cf6', '#ec4899', '#14b8a6', '#a3e635'\r\n];\r\n\r\nconst DECADE_COLORS: Record<string, string> = {\r\n    '1980s': '#8b5cf6',\r\n    '1990s': '#3b82f6',\r\n    '2000s': '#22c55e',\r\n    '2010s': '#f97316',\r\n    '2020s': '#f43f5e',\r\n};\r\n\r\nexport function StatsModal({ stats, totalGames, winRate, averageGuesses, onReset, onClose }: StatsModalProps) {\r\n    // Sort genres by total games played\r\n    const sortedGenres = Object.entries(stats.genreStats)\r\n        .sort((a, b) => b[1].total - a[1].total)\r\n        .slice(0, 8); // Top 8 genres\r\n\r\n    // Sort decades chronologically\r\n    const sortedDecades = Object.entries(stats.decadeStats)\r\n        .sort((a, b) => a[0].localeCompare(b[0]));\r\n\r\n    // Calculate total for pie chart percentages\r\n    const genreTotal = sortedGenres.reduce((sum, [, data]) => sum + data.total, 0);\r\n\r\n    // Generate pie chart CSS gradient\r\n    let cumulativePercent = 0;\r\n    const pieSegments = sortedGenres.map(([, data], idx) => {\r\n        const percent = genreTotal > 0 ? (data.total / genreTotal) * 100 : 0;\r\n        const start = cumulativePercent;\r\n        cumulativePercent += percent;\r\n        return `${GENRE_COLORS[idx % GENRE_COLORS.length]} ${start}% ${cumulativePercent}%`;\r\n    });\r\n    const pieGradient = pieSegments.length > 0\r\n        ? `conic-gradient(${pieSegments.join(', ')})`\r\n        : 'conic-gradient(#374151 0% 100%)';\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-in fade-in duration-200\">\r\n            <div className=\"bg-surface border border-white/10 rounded-xl p-6 max-w-lg w-full shadow-2xl animate-in zoom-in-95 duration-200 relative max-h-[90vh] overflow-y-auto custom-scrollbar\">\r\n                <button\r\n                    onClick={onClose}\r\n                    className=\"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors\"\r\n                >\r\n                    <X size={24} />\r\n                </button>\r\n\r\n                <h2 className=\"text-2xl font-bold mb-6 text-white flex items-center gap-2\">\r\n                     Your Statistics\r\n                </h2>\r\n\r\n                {/* Summary Cards */}\r\n                <div className=\"grid grid-cols-3 gap-3 mb-6\">\r\n                    <div className=\"bg-gray-800/50 rounded-lg p-3 text-center border border-white/5\">\r\n                        <Trophy className=\"w-5 h-5 text-yellow-400 mx-auto mb-1\" />\r\n                        <div className=\"text-2xl font-bold text-white\">{stats.totalCorrect}</div>\r\n                        <div className=\"text-xs text-gray-400\">Correct Guesses</div>\r\n                    </div>\r\n                    <div className=\"bg-gray-800/50 rounded-lg p-3 text-center border border-white/5\">\r\n                        <Target className=\"w-5 h-5 text-blue-400 mx-auto mb-1\" />\r\n                        <div className=\"text-2xl font-bold text-white\">{winRate.toFixed(0)}%</div>\r\n                        <div className=\"text-xs text-gray-400\">Guess Accuracy</div>\r\n                    </div>\r\n                    <div className=\"bg-gray-800/50 rounded-lg p-3 text-center border border-white/5\">\r\n                        <TrendingUp className=\"w-5 h-5 text-green-400 mx-auto mb-1\" />\r\n                        <div className=\"text-2xl font-bold text-white\">{averageGuesses.toFixed(1)}</div>\r\n                        <div className=\"text-xs text-gray-400\">Avg Guesses</div>\r\n                    </div>\r\n                </div>\r\n\r\n\r\n\r\n                {/* Genre Breakdown */}\r\n                {sortedGenres.length > 0 && (\r\n                    <div className=\"mb-6\">\r\n                        <h3 className=\"text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3\">Genre Breakdown - Your best genres</h3>\r\n                        <div className=\"flex gap-4\">\r\n                            {/* Pie Chart */}\r\n                            <div\r\n                                className=\"w-24 h-24 rounded-full flex-shrink-0\"\r\n                                style={{ background: pieGradient }}\r\n                            />\r\n                            {/* Legend */}\r\n                            <div className=\"flex-1 grid grid-cols-2 gap-x-3 gap-y-1 text-xs\">\r\n                                {sortedGenres.map(([genre, data], idx) => (\r\n                                    <div key={genre} className=\"flex items-center gap-1.5 truncate\">\r\n                                        <div\r\n                                            className=\"w-2.5 h-2.5 rounded-sm flex-shrink-0\"\r\n                                            style={{ backgroundColor: GENRE_COLORS[idx % GENRE_COLORS.length] }}\r\n                                        />\r\n                                        <span className=\"text-gray-300 truncate\">{genre}</span>\r\n                                        <span className=\"text-gray-500 ml-auto\">{((data.total / genreTotal) * 100).toFixed(0)}%</span>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Decade Breakdown */}\r\n                {sortedDecades.length > 0 && (\r\n                    <div className=\"mb-6\">\r\n                        <h3 className=\"text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3\">Decade Performance - Your best decades</h3>\r\n                        <div className=\"space-y-2\">\r\n                            {sortedDecades.map(([decade, data]) => {\r\n                                const successRate = data.total > 0 ? (data.correct / data.total) * 100 : 0;\r\n                                return (\r\n                                    <div key={decade} className=\"flex items-center gap-2\">\r\n                                        <span className=\"text-xs text-gray-400 w-12\">{decade}</span>\r\n                                        <div className=\"flex-1 bg-gray-800 rounded-full h-4 overflow-hidden\">\r\n                                            <div\r\n                                                className=\"h-full rounded-full transition-all duration-500\"\r\n                                                style={{\r\n                                                    width: `${successRate}%`,\r\n                                                    backgroundColor: DECADE_COLORS[decade] || '#6b7280',\r\n                                                }}\r\n                                            />\r\n                                        </div>\r\n                                        <span className=\"text-xs text-gray-400 w-10 text-right\">{successRate.toFixed(0)}%</span>\r\n                                    </div>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Empty State */}\r\n                {totalGames === 0 && (\r\n                    <div className=\"text-center py-8 text-gray-400\">\r\n                        <p className=\"text-lg mb-2\">No games played yet!</p>\r\n                        <p className=\"text-sm\">Play some Endless Mode to see your stats here.</p>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Reset Button */}\r\n                <div className=\"mt-6 pt-4 border-t border-white/10 flex justify-between items-center\">\r\n                    <button\r\n                        onClick={() => {\r\n                            if (window.confirm('Are you sure you want to reset all statistics? This cannot be undone.')) {\r\n                                onReset();\r\n                            }\r\n                        }}\r\n                        className=\"flex items-center gap-2 px-3 py-1.5 text-sm text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded-lg transition-colors\"\r\n                    >\r\n                        <RotateCcw size={14} />\r\n                        Reset Stats\r\n                    </button>\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"px-4 py-2 bg-white text-black font-bold rounded-lg hover:bg-gray-200 transition-colors\"\r\n                    >\r\n                        Done\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\components\\TopScoresTicker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\components\\TutorialModal.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Johan\\repos\\guessthegame\\src\\components\\TutorialModal.tsx:253:13\n  251 |     useEffect(() => {\n  252 |         if (isOpen) {\n> 253 |             setCurrentStep(0);\n      |             ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  254 |             setDirection('next');\n  255 |         }\n  256 |     }, [isOpen]);","line":253,"column":13,"nodeType":null,"endLine":253,"endColumn":27}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport {\r\n    Gamepad2,\r\n    BookOpen,\r\n    Search,\r\n    Flame,\r\n    LifeBuoy,\r\n    ShoppingCart,\r\n    ChevronLeft,\r\n    ChevronRight,\r\n    X,\r\n    Sparkles,\r\n    Target,\r\n    Trophy,\r\n    HelpCircle,\r\n    Shuffle,\r\n    ZoomOut,\r\n    SkipForward,\r\n    Coins,\r\n    Eye,\r\n    FileText\r\n} from 'lucide-react';\r\nimport { clsx } from 'clsx';\r\nimport { TutorialSimulation } from './TutorialSimulation';\r\n\r\ninterface TutorialModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    onComplete: () => void;\r\n}\r\n\r\ninterface TutorialStep {\r\n    icon: React.ReactNode;\r\n    title: string;\r\n    content: React.ReactNode;\r\n    accentColor: string;\r\n}\r\n\r\nconst tutorialSteps: TutorialStep[] = [\r\n    {\r\n        icon: <Gamepad2 size={48} />,\r\n        title: \"Welcome to Guess The Game Ultimate!\",\r\n        accentColor: \"from-purple-500 to-pink-500\",\r\n        content: (\r\n            <div className=\"space-y-4\">\r\n                <p className=\"text-lg text-gray-300\">\r\n                    Test your gaming knowledge by identifying games from their screenshots.\r\n                </p>\r\n                <div className=\"flex items-center gap-3 p-4 bg-white/5 rounded-xl border border-white/10\">\r\n                    <Sparkles className=\"text-yellow-400 flex-shrink-0\" size={24} />\r\n                    <p className=\"text-sm text-gray-400\">\r\n                        Over <span className=\"text-white font-bold\">2600+ games</span> to discover across all genres and eras!\r\n                    </p>\r\n                </div>\r\n                <p className=\"text-gray-400 text-sm\">\r\n                    This quick guide will show you how to play both game modes.\r\n                </p>\r\n            </div>\r\n        )\r\n    },\r\n    {\r\n        icon: <BookOpen size={48} />,\r\n        title: \"Standard Mode\",\r\n        accentColor: \"from-blue-500 to-cyan-500\",\r\n        content: (\r\n            <div className=\"space-y-4\">\r\n                <p className=\"text-gray-300\">\r\n                    The relaxed way to play  no pressure, just fun!\r\n                </p>\r\n                <div className=\"grid gap-3\">\r\n                    <div className=\"flex items-start gap-3 p-3 bg-white/5 rounded-lg\">\r\n                        <Target className=\"text-blue-400 flex-shrink-0 mt-0.5\" size={20} />\r\n                        <div>\r\n                            <p className=\"text-white font-medium\">Play at Your Own Pace</p>\r\n                            <p className=\"text-sm text-gray-400\">No time limits, no penalties</p>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex items-start gap-3 p-3 bg-white/5 rounded-lg\">\r\n                        <Trophy className=\"text-yellow-400 flex-shrink-0 mt-0.5\" size={20} />\r\n                        <div>\r\n                            <p className=\"text-white font-medium\">Progress Saved Automatically</p>\r\n                            <p className=\"text-sm text-gray-400\">Come back anytime and continue</p>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex items-start gap-3 p-3 bg-white/5 rounded-lg\">\r\n                        <Gamepad2 className=\"text-green-400 flex-shrink-0 mt-0.5\" size={20} />\r\n                        <div>\r\n                            <p className=\"text-white font-medium\">Jump to Any Level</p>\r\n                            <p className=\"text-sm text-gray-400\">Use the sidebar to select levels</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        )\r\n    },\r\n    {\r\n        icon: <Search size={48} />,\r\n        title: \"Progressive Reveal System\",\r\n        accentColor: \"from-green-500 to-emerald-500\",\r\n        content: (\r\n            <div className=\"space-y-4\">\r\n                <p className=\"text-gray-300 text-sm\">\r\n                    Each game starts with a zoomed-in screenshot. Wrong guesses zoom out and reveal more of the image!\r\n                </p>\r\n\r\n                {/* New Simulation Component */}\r\n                <div className=\"mt-2 -mx-2\">\r\n                    <TutorialSimulation />\r\n                </div>\r\n            </div>\r\n        )\r\n    },\r\n    {\r\n        icon: <Flame size={48} />,\r\n        title: \"Endless Mode\",\r\n        accentColor: \"from-orange-500 to-red-500\",\r\n        content: (\r\n            <div className=\"space-y-4\">\r\n                <p className=\"text-gray-300\">\r\n                    The ultimate challenge  roguelike stakes with permadeath!\r\n                </p>\r\n                <div className=\"p-4 bg-gradient-to-r from-red-500/10 to-orange-500/10 rounded-xl border border-red-500/20\">\r\n                    <div className=\"flex items-center gap-3 mb-3\">\r\n                        <div className=\"w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center\">\r\n                            <span className=\"text-2xl\"></span>\r\n                        </div>\r\n                        <div>\r\n                            <p className=\"text-white font-bold\">5 Wrong Guesses = Game Over</p>\r\n                            <p className=\"text-sm text-red-400\">Your run ends, but glory awaits...</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"grid grid-cols-5 gap-2 text-center\">\r\n                    {[5, 4, 3, 2, 1].map((pts, idx) => (\r\n                        <div key={pts} className=\"p-2 bg-white/5 rounded-lg\">\r\n                            <p className=\"text-lg font-bold text-orange-400\">+{pts}</p>\r\n                            <p className=\"text-[10px] text-gray-500\">Guess {idx + 1}</p>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n                <p className=\"text-sm text-gray-400 text-center\">\r\n                    Points earned based on which guess gets it right\r\n                </p>\r\n            </div>\r\n        )\r\n    },\r\n    {\r\n        icon: <LifeBuoy size={48} />,\r\n        title: \"Lifelines\",\r\n        accentColor: \"from-cyan-500 to-blue-500\",\r\n        content: (\r\n            <div className=\"space-y-3\">\r\n                <p className=\"text-gray-300 text-sm\">\r\n                    Powerful tools to help you survive in Endless Mode:\r\n                </p>\r\n                <div className=\"grid gap-2\">\r\n                    <div className=\"flex items-center gap-3 p-2.5 bg-white/5 rounded-lg\">\r\n                        <Eye className=\"text-purple-400 flex-shrink-0\" size={18} />\r\n                        <div className=\"flex-1\">\r\n                            <span className=\"text-white font-medium text-sm\">Cover Peek</span>\r\n                            <span className=\"text-gray-500 text-xs ml-2\"> Shows cover art briefly</span>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-3 p-2.5 bg-white/5 rounded-lg\">\r\n                        <SkipForward className=\"text-red-400 flex-shrink-0\" size={18} />\r\n                        <div className=\"flex-1\">\r\n                            <span className=\"text-white font-medium text-sm\">Skip</span>\r\n                            <span className=\"text-gray-500 text-xs ml-2\"> Move to next (0 pts)</span>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-3 p-2.5 bg-white/5 rounded-lg\">\r\n                        <Shuffle className=\"text-purple-400 flex-shrink-0\" size={18} />\r\n                        <div className=\"flex-1\">\r\n                            <span className=\"text-white font-medium text-sm\">Anagram</span>\r\n                            <span className=\"text-gray-500 text-xs ml-2\"> Scrambled title hint</span>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-3 p-2.5 bg-white/5 rounded-lg\">\r\n                        <HelpCircle className=\"text-green-400 flex-shrink-0\" size={18} />\r\n                        <div className=\"flex-1\">\r\n                            <span className=\"text-white font-medium text-sm\">Consultant</span>\r\n                            <span className=\"text-gray-500 text-xs ml-2\"> Multiple choice (1 correct, 3 wrong)</span>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-3 p-2.5 bg-white/5 rounded-lg\">\r\n                        <Gamepad2 className=\"text-yellow-400 flex-shrink-0\" size={18} />\r\n                        <div className=\"flex-1\">\r\n                            <span className=\"text-white font-medium text-sm\">Double Trouble</span>\r\n                            <span className=\"text-gray-500 text-xs ml-2\"> Blend 2 games, guess either</span>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-3 p-2.5 bg-white/5 rounded-lg\">\r\n                        <ZoomOut className=\"text-blue-400 flex-shrink-0\" size={18} />\r\n                        <div className=\"flex-1\">\r\n                            <span className=\"text-white font-medium text-sm\">Zoom Out</span>\r\n                            <span className=\"text-gray-500 text-xs ml-2\"> Reveal full image</span>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-3 p-2.5 bg-white/5 rounded-lg\">\r\n                        <FileText className=\"text-green-400 flex-shrink-0\" size={18} />\r\n                        <div className=\"flex-1\">\r\n                            <span className=\"text-white font-medium text-sm\">Synopsis</span>\r\n                            <span className=\"text-gray-500 text-xs ml-2\"> Read game summary</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        )\r\n    },\r\n    {\r\n        icon: <ShoppingCart size={48} />,\r\n        title: \"The Shop\",\r\n        accentColor: \"from-yellow-500 to-amber-500\",\r\n        content: (\r\n            <div className=\"space-y-4\">\r\n                <p className=\"text-gray-300\">\r\n                    Every <span className=\"text-yellow-400 font-bold\">5 levels</span> in Endless Mode, the shop appears!\r\n                </p>\r\n                <div className=\"p-4 bg-gradient-to-r from-yellow-500/10 to-amber-500/10 rounded-xl border border-yellow-500/20\">\r\n                    <div className=\"flex items-center gap-3 mb-3\">\r\n                        <Coins className=\"text-yellow-400\" size={28} />\r\n                        <div>\r\n                            <p className=\"text-white font-bold\">Spend Points, Gain Power</p>\r\n                            <p className=\"text-sm text-gray-400\">Refill lifelines to extend your run</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"flex items-start gap-3 p-3 bg-orange-500/10 rounded-lg border border-orange-500/20\">\r\n                    <span className=\"text-xl\"></span>\r\n                    <div>\r\n                        <p className=\"text-orange-300 font-medium text-sm\">Greed is Good</p>\r\n                        <p className=\"text-xs text-gray-400\">\r\n                            Risky choice: Get +10 points immediately, but locks all other shop items!\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n                <p className=\"text-sm text-gray-400 text-center\">\r\n                    Manage your resources wisely  every point counts!\r\n                </p>\r\n            </div>\r\n        )\r\n    }\r\n];\r\n\r\nexport function TutorialModal({ isOpen, onClose, onComplete }: TutorialModalProps) {\r\n    const [currentStep, setCurrentStep] = useState(0);\r\n    const [direction, setDirection] = useState<'next' | 'prev'>('next');\r\n    const [isAnimating, setIsAnimating] = useState(false);\r\n\r\n    // Reset to first step when modal opens\r\n    useEffect(() => {\r\n        if (isOpen) {\r\n            setCurrentStep(0);\r\n            setDirection('next');\r\n        }\r\n    }, [isOpen]);\r\n\r\n    const handleNext = () => {\r\n        if (isAnimating) return;\r\n\r\n        if (currentStep < tutorialSteps.length - 1) {\r\n            setDirection('next');\r\n            setIsAnimating(true);\r\n            setTimeout(() => {\r\n                setCurrentStep(prev => prev + 1);\r\n                setIsAnimating(false);\r\n            }, 150);\r\n        } else {\r\n            onComplete();\r\n            onClose();\r\n        }\r\n    };\r\n\r\n    const handlePrev = () => {\r\n        if (isAnimating || currentStep === 0) return;\r\n\r\n        setDirection('prev');\r\n        setIsAnimating(true);\r\n        setTimeout(() => {\r\n            setCurrentStep(prev => prev - 1);\r\n            setIsAnimating(false);\r\n        }, 150);\r\n    };\r\n\r\n    const handleStepClick = (index: number) => {\r\n        if (isAnimating || index === currentStep) return;\r\n\r\n        setDirection(index > currentStep ? 'next' : 'prev');\r\n        setIsAnimating(true);\r\n        setTimeout(() => {\r\n            setCurrentStep(index);\r\n            setIsAnimating(false);\r\n        }, 150);\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    const step = tutorialSteps[currentStep];\r\n    const isLastStep = currentStep === tutorialSteps.length - 1;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4 animate-in fade-in duration-300\">\r\n            {/* Backdrop */}\r\n            <div\r\n                className=\"absolute inset-0 bg-black/85 backdrop-blur-md\"\r\n                onClick={onClose}\r\n            />\r\n\r\n            {/* Modal */}\r\n            <div className=\"relative w-full max-w-lg bg-surface border border-white/10 rounded-2xl shadow-2xl overflow-hidden animate-in zoom-in-95 duration-300 max-h-[90vh] flex flex-col\">\r\n                {/* Accent gradient bar */}\r\n                <div className={clsx(\r\n                    \"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r transition-all duration-500\",\r\n                    step.accentColor\r\n                )} />\r\n\r\n                {/* Close button */}\r\n                <button\r\n                    onClick={onClose}\r\n                    className=\"absolute top-4 right-4 z-10 p-2 text-gray-400 hover:text-white hover:bg-white/10 rounded-lg transition-all\"\r\n                >\r\n                    <X size={20} />\r\n                </button>\r\n\r\n                {/* Content */}\r\n                <div className=\"p-4 sm:p-6 pt-12 sm:pt-8 overflow-y-auto custom-scrollbar\">\r\n                    {/* Icon and Title */}\r\n                    <div className={clsx(\r\n                        \"flex flex-col items-center text-center mb-6 transition-all duration-300\",\r\n                        isAnimating && (direction === 'next' ? \"opacity-0 -translate-x-4\" : \"opacity-0 translate-x-4\")\r\n                    )}>\r\n                        <div className={clsx(\r\n                            \"w-20 h-20 rounded-2xl bg-gradient-to-br flex items-center justify-center text-white mb-4 shadow-lg\",\r\n                            step.accentColor\r\n                        )}>\r\n                            {step.icon}\r\n                        </div>\r\n                        <h2 className=\"text-2xl font-bold text-white\">{step.title}</h2>\r\n                    </div>\r\n\r\n                    {/* Step Content */}\r\n                    <div className={clsx(\r\n                        \"min-h-[240px] transition-all duration-300\",\r\n                        isAnimating && (direction === 'next' ? \"opacity-0 translate-x-8\" : \"opacity-0 -translate-x-8\")\r\n                    )}>\r\n                        {step.content}\r\n                    </div>\r\n\r\n                    {/* Step Indicators */}\r\n                    <div className=\"flex justify-center gap-2 mt-6 mb-4\">\r\n                        {tutorialSteps.map((_, index) => (\r\n                            <button\r\n                                key={index}\r\n                                onClick={() => handleStepClick(index)}\r\n                                className={clsx(\r\n                                    \"w-2.5 h-2.5 rounded-full transition-all duration-300\",\r\n                                    index === currentStep\r\n                                        ? \"bg-white scale-125\"\r\n                                        : \"bg-white/30 hover:bg-white/50\"\r\n                                )}\r\n                            />\r\n                        ))}\r\n                    </div>\r\n\r\n                    {/* Navigation */}\r\n                    <div className=\"flex items-center justify-between gap-4 mt-4\">\r\n                        <button\r\n                            onClick={handlePrev}\r\n                            disabled={currentStep === 0}\r\n                            className={clsx(\r\n                                \"flex items-center gap-2 px-4 py-2.5 rounded-xl font-medium transition-all\",\r\n                                currentStep === 0\r\n                                    ? \"text-gray-600 cursor-not-allowed\"\r\n                                    : \"text-gray-300 hover:text-white hover:bg-white/10\"\r\n                            )}\r\n                        >\r\n                            <ChevronLeft size={20} />\r\n                            <span>Back</span>\r\n                        </button>\r\n\r\n                        <span className=\"text-sm text-gray-500\">\r\n                            {currentStep + 1} / {tutorialSteps.length}\r\n                        </span>\r\n\r\n                        <button\r\n                            onClick={handleNext}\r\n                            className={clsx(\r\n                                \"flex items-center gap-2 px-5 py-2.5 rounded-xl font-bold transition-all\",\r\n                                isLastStep\r\n                                    ? \"bg-gradient-to-r from-green-500 to-emerald-500 text-white hover:scale-105 shadow-lg shadow-green-500/25\"\r\n                                    : \"bg-white text-black hover:scale-105\"\r\n                            )}\r\n                        >\r\n                            <span>{isLastStep ? \"Let's Play!\" : \"Next\"}</span>\r\n                            {!isLastStep && <ChevronRight size={20} />}\r\n                            {isLastStep && <Sparkles size={20} />}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\components\\TutorialSimulation.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\hooks\\useAppSettings.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":52,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":52,"endColumn":28}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Context for managing user settings\r\nimport React, { useState, useEffect, createContext, useContext } from 'react';\r\n\r\nconst STORAGE_KEY = 'guessthegame_settings';\r\n\r\nexport interface Settings {\r\n    nextLevelOnEnter: boolean;\r\n    skipOnEsc: boolean;\r\n}\r\n\r\nconst DEFAULT_SETTINGS: Settings = {\r\n    nextLevelOnEnter: false,\r\n    skipOnEsc: false,\r\n};\r\n\r\ninterface SettingsContextType {\r\n    settings: Settings;\r\n    updateSetting: (key: keyof Settings, value: boolean) => void;\r\n}\r\n\r\nconst SettingsContext = createContext<SettingsContextType | undefined>(undefined);\r\n\r\nexport function SettingsProvider({ children }: { children: React.ReactNode }) {\r\n    const [settings, setSettings] = useState<Settings>(() => {\r\n        try {\r\n            const saved = localStorage.getItem(STORAGE_KEY);\r\n            if (saved) {\r\n                return { ...DEFAULT_SETTINGS, ...JSON.parse(saved) };\r\n            }\r\n        } catch (e) {\r\n            console.error('Failed to load settings:', e);\r\n        }\r\n        return DEFAULT_SETTINGS;\r\n    });\r\n\r\n    useEffect(() => {\r\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(settings));\r\n    }, [settings]);\r\n\r\n    const updateSetting = (key: keyof Settings, value: boolean) => {\r\n        setSettings(prev => ({ ...prev, [key]: value }));\r\n    };\r\n\r\n    return (\r\n        <SettingsContext.Provider value={{ settings, updateSetting }\r\n        }>\r\n            {children}\r\n        </SettingsContext.Provider>\r\n    );\r\n}\r\n\r\nexport function useSettings() {\r\n    const context = useContext(SettingsContext);\r\n    if (context === undefined) {\r\n        throw new Error('useSettings must be used within a SettingsProvider');\r\n    }\r\n    return context;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\hooks\\useEndlessState.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'shuffledRated' is never reassigned. Use 'const' instead.","line":52,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":52,"endColumn":22,"fix":{"range":[1929,1977],"text":"const shuffledRated = shuffleArray(friendlyRated);"}},{"ruleId":"prefer-const","severity":2,"message":"'shuffledNew' is never reassigned. Use 'const' instead.","line":53,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":53,"endColumn":20,"fix":{"range":[1983,2027],"text":"const shuffledNew = shuffleArray(friendlyNew);"}},{"ruleId":"prefer-const","severity":2,"message":"'shuffledStandard' is never reassigned. Use 'const' instead.","line":54,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":54,"endColumn":25,"fix":{"range":[2033,2084],"text":"const shuffledStandard = shuffleArray(standardGames);"}},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Johan\\repos\\guessthegame\\src\\hooks\\useEndlessState.ts:166:13\n  164 |         if (state.gameOrder.length === 0 && allGames.length > 0) {\n  165 |             const weightedIds = generateWeightedGameOrder(allGames);\n> 166 |             setState(prev => ({ ...prev, gameOrder: weightedIds }));\n      |             ^^^^^^^^ Avoid calling setState() directly within an effect\n  167 |         }\n  168 |     }, [allGames, state.gameOrder.length]);\n  169 |","line":166,"column":13,"nodeType":null,"endLine":166,"endColumn":21},{"ruleId":"react-hooks/preserve-manual-memoization","severity":2,"message":"Compilation Skipped: Existing memoization could not be preserved\n\nReact Compiler has skipped optimizing this component because the existing manual memoization could not be preserved. The inferred dependencies did not match the manually specified dependencies, which could cause the value to change more or less frequently than expected. The inferred dependency was `state.hotStreakCount`, but the source dependencies were [state.isGameOver, state.status, currentGame, state.guesses]. Inferred different dependency than source.\n\nC:\\Users\\Johan\\repos\\guessthegame\\src\\hooks\\useEndlessState.ts:181:37\n  179 |     const currentGame = allGames.find(g => g.id === currentGameId);\n  180 |\n> 181 |     const submitGuess = useCallback((game: Game, isFatal: boolean = false) => {\n      |                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 182 |         if (state.isGameOver || state.status !== 'playing' || !currentGame) return;\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 183 |\n      \n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 257 |         }\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 258 |     }, [state.isGameOver, state.status, currentGame, state.guesses]);\n      | ^^^^^^ Could not preserve existing manual memoization\n  259 |\n  260 |     const skipGuess = useCallback(() => {\n  261 |         if (state.isGameOver || state.status !== 'playing' || !currentGame) return;","line":181,"column":37,"nodeType":null,"endLine":258,"endColumn":6},{"ruleId":"react-hooks/preserve-manual-memoization","severity":2,"message":"Compilation Skipped: Existing memoization could not be preserved\n\nReact Compiler has skipped optimizing this component because the existing manual memoization could not be preserved. The inferred dependencies did not match the manually specified dependencies, which could cause the value to change more or less frequently than expected. The inferred dependency was `state.streak`, but the source dependencies were [state.isGameOver, state.status, currentGame, state.guesses]. Inferred different dependency than source.\n\nC:\\Users\\Johan\\repos\\guessthegame\\src\\hooks\\useEndlessState.ts:181:37\n  179 |     const currentGame = allGames.find(g => g.id === currentGameId);\n  180 |\n> 181 |     const submitGuess = useCallback((game: Game, isFatal: boolean = false) => {\n      |                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 182 |         if (state.isGameOver || state.status !== 'playing' || !currentGame) return;\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 183 |\n      \n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 257 |         }\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 258 |     }, [state.isGameOver, state.status, currentGame, state.guesses]);\n      | ^^^^^^ Could not preserve existing manual memoization\n  259 |\n  260 |     const skipGuess = useCallback(() => {\n  261 |         if (state.isGameOver || state.status !== 'playing' || !currentGame) return;","line":181,"column":37,"nodeType":null,"endLine":258,"endColumn":6},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has missing dependencies: 'state.hotStreakCount' and 'state.streak'. Either include them or remove the dependency array.","line":258,"column":8,"nodeType":"ArrayExpression","endLine":258,"endColumn":68,"suggestions":[{"desc":"Update the dependencies array to be: [state.isGameOver, state.status, state.guesses, state.hotStreakCount, state.streak, currentGame]","fix":{"range":[9560,9620],"text":"[state.isGameOver, state.status, state.guesses, state.hotStreakCount, state.streak, currentGame]"}}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":3,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport type { Game, EndlessState, LifelineType, GuessResult } from '../types';\r\nimport { calculateScore, getShopItems, generateRandomCrop } from '../utils/endlessUtils';\r\nimport { areSimilarNames } from '../utils/seriesDetection';\r\n\r\n\r\n// Proper Fisher-Yates shuffle algorithm (unbiased)\r\nfunction shuffleArray<T>(array: T[]): T[] {\r\n    const result = [...array];\r\n    for (let i = result.length - 1; i > 0; i--) {\r\n        const j = Math.floor(Math.random() * (i + 1));\r\n        [result[i], result[j]] = [result[j], result[i]];\r\n    }\r\n    return result;\r\n}\r\n\r\n// Helper to generate a random integer between min and max (inclusive)\r\nfunction getRandomInt(min: number, max: number): number {\r\n    return Math.floor(Math.random() * (max - min + 1)) + min;\r\n}\r\n\r\nfunction generateWeightedGameOrder(allGames: Game[]): number[] {\r\n    // 1. Classify games into Friendly (Rated/New) and Standard pools with fuzzy thresholds\r\n    const friendlyRated: Game[] = [];\r\n    const friendlyNew: Game[] = [];\r\n    const standardGames: Game[] = [];\r\n\r\n    allGames.forEach(game => {\r\n        // Fuzzy thresholds per game\r\n        const ratingThreshold = getRandomInt(88, 91);\r\n        const yearThreshold = getRandomInt(2010, 2015);\r\n\r\n        // Check if game is \"Friendly\"\r\n        // Ensure rating exists (some games might not have it, treat as 0)\r\n        const rating = game.rating || 0;\r\n        const year = game.year || 0;\r\n\r\n        const isRated = rating >= ratingThreshold;\r\n        const isNew = year >= yearThreshold;\r\n\r\n        if (isRated) {\r\n            // Prioritize \"Rated\" classification for games that are both (to boost the smaller pool)\r\n            friendlyRated.push(game);\r\n        } else if (isNew) {\r\n            friendlyNew.push(game);\r\n        } else {\r\n            standardGames.push(game);\r\n        }\r\n    });\r\n\r\n    // Shuffle all pools initially\r\n    let shuffledRated = shuffleArray(friendlyRated);\r\n    let shuffledNew = shuffleArray(friendlyNew);\r\n    let shuffledStandard = shuffleArray(standardGames);\r\n\r\n    const finalOrder: number[] = [];\r\n    const friendlyProbabilities = [1.0, 0.9, 0.7, 0.4, 0.3]; // Probabilities for first 5 games\r\n\r\n    // 2. Select first 5 games based on probabilities\r\n    for (let i = 0; i < 5; i++) {\r\n        // If we run out of games in total, stop\r\n        if (shuffledRated.length === 0 && shuffledNew.length === 0 && shuffledStandard.length === 0) break;\r\n\r\n        const chance = friendlyProbabilities[i] ?? 0;\r\n        const roll = Math.random();\r\n\r\n        let pickedGame: Game | undefined;\r\n\r\n        if (roll < chance && (shuffledRated.length > 0 || shuffledNew.length > 0)) {\r\n            // Pick Friendly\r\n            // 50/50 chance between Rated and New (if both available)\r\n            const useRated = Math.random() < 0.5;\r\n\r\n            if (useRated && shuffledRated.length > 0) {\r\n                pickedGame = shuffledRated.pop();\r\n            } else if (!useRated && shuffledNew.length > 0) {\r\n                pickedGame = shuffledNew.pop();\r\n            } else {\r\n                // Fallback if the chosen pool was empty\r\n                pickedGame = shuffledRated.pop() || shuffledNew.pop();\r\n            }\r\n        } else {\r\n            // Pick Standard (or fallback to friendly if standard is empty)\r\n            pickedGame = shuffledStandard.pop() || shuffledRated.pop() || shuffledNew.pop();\r\n        }\r\n\r\n        if (pickedGame) {\r\n            finalOrder.push(pickedGame.id);\r\n        }\r\n    }\r\n\r\n    // 3. Fill the rest\r\n    const remainingGames = [...shuffledRated, ...shuffledNew, ...shuffledStandard];\r\n    const shuffledRemaining = shuffleArray(remainingGames);\r\n\r\n    shuffledRemaining.forEach(g => finalOrder.push(g.id));\r\n\r\n    return finalOrder;\r\n}\r\n\r\nconst STORAGE_KEY = 'guessthegame_endless_state';\r\nconst HIGH_SCORE_KEY = 'guessthegame_endless_highscore';\r\n\r\nconst INITIAL_STATE: EndlessState = {\r\n    score: 0,\r\n    streak: 0,\r\n    highScore: 0,\r\n    lifelines: {\r\n        skip: 1,\r\n        anagram: 1,\r\n        consultant: 1,\r\n        double_trouble: 1,\r\n        zoom_out: 1,\r\n        cover_peek: 1,\r\n        synopsis: 1\r\n    },\r\n    currentLevelIndex: 0,\r\n    gameOrder: [],\r\n    isGameOver: false,\r\n    highScoreModalShown: false,\r\n    status: 'playing',\r\n    guesses: [],\r\n    history: [],\r\n    currentLevelLifelinesUsed: [],\r\n    doubleTroubleGameId: null,\r\n    zoomOutActive: false,\r\n    cropPositions: [],\r\n    hotStreakCount: 0,\r\n    isHotStreakActive: false,\r\n    lastShopStreak: 0\r\n};\r\n\r\nexport const useEndlessState = (allGames: Game[]) => {\r\n    const [state, setState] = useState<EndlessState>(() => {\r\n        const saved = localStorage.getItem(STORAGE_KEY);\r\n        const savedHighScore = localStorage.getItem(HIGH_SCORE_KEY);\r\n        const parsedState = saved ? JSON.parse(saved) : INITIAL_STATE;\r\n\r\n        // Ensure high score is up to date\r\n        if (savedHighScore) {\r\n            parsedState.highScore = Math.max(parsedState.highScore, Number.parseInt(savedHighScore, 10));\r\n        }\r\n\r\n        // Ensure crop positions exist (for legacy state or fresh start)\r\n        if (!parsedState.cropPositions || parsedState.cropPositions.length === 0) {\r\n            parsedState.cropPositions = Array(5).fill(0).map(() => generateRandomCrop());\r\n        }\r\n\r\n        // Ensure lastShopStreak exists (for legacy state)\r\n        if (parsedState.lastShopStreak === undefined) {\r\n            parsedState.lastShopStreak = 0;\r\n        }\r\n\r\n        // Ensure currentLevelLifelinesUsed exists\r\n        if (!parsedState.currentLevelLifelinesUsed) {\r\n            parsedState.currentLevelLifelinesUsed = [];\r\n        }\r\n\r\n        return parsedState;\r\n    });\r\n\r\n    // Initialize game order if empty\r\n    useEffect(() => {\r\n        if (state.gameOrder.length === 0 && allGames.length > 0) {\r\n            const weightedIds = generateWeightedGameOrder(allGames);\r\n            setState(prev => ({ ...prev, gameOrder: weightedIds }));\r\n        }\r\n    }, [allGames, state.gameOrder.length]);\r\n\r\n    // Save state on change\r\n    useEffect(() => {\r\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));\r\n        if (state.score > state.highScore) {\r\n            localStorage.setItem(HIGH_SCORE_KEY, state.score.toString());\r\n        }\r\n    }, [state]);\r\n\r\n    const currentGameId = state.gameOrder[state.currentLevelIndex];\r\n    const currentGame = allGames.find(g => g.id === currentGameId);\r\n\r\n    const submitGuess = useCallback((game: Game, isFatal: boolean = false) => {\r\n        if (state.isGameOver || state.status !== 'playing' || !currentGame) return;\r\n\r\n        let result: GuessResult = 'wrong';\r\n        if (game.id === currentGame.id) {\r\n            result = 'correct';\r\n        } else {\r\n            if (areSimilarNames(game.name, currentGame.name)) {\r\n                result = 'similar-name';\r\n            }\r\n        }\r\n\r\n        const newGuesses = [...state.guesses, { name: game.name, result }];\r\n\r\n        if (result === 'correct') {\r\n            const isCloseToPerfect = newGuesses.length <= 2;\r\n            const newHotStreakCount = isCloseToPerfect ? state.hotStreakCount + 1 : 0;\r\n            const isHotStreakActive = newHotStreakCount >= 3;\r\n\r\n            let points = calculateScore(newGuesses.length);\r\n\r\n            // Balance Change: Progressive difficulty bonus\r\n            // Every time the shop appears (every 5 levels), increase flat score by 1\r\n            // e.g. Levels 1-5 (streak 0-4): +0\r\n            // Levels 6-10 (streak 5-9): +1\r\n            const difficultyBonus = Math.floor(state.streak / 5);\r\n            points += difficultyBonus;\r\n\r\n            if (isHotStreakActive) {\r\n                points *= 2;\r\n            }\r\n\r\n            setState(prev => ({\r\n                ...prev,\r\n                score: prev.score + points,\r\n                streak: prev.streak + 1,\r\n                status: 'won',\r\n                guesses: newGuesses,\r\n                highScore: Math.max(prev.highScore, prev.score + points),\r\n                history: [...prev.history, {\r\n                    gameId: currentGame.id,\r\n                    score: points,\r\n                    status: 'won',\r\n                    guesses: newGuesses,\r\n                    lifelinesUsed: prev.currentLevelLifelinesUsed,\r\n                    correctAnswer: currentGame.name,\r\n                    cropPositions: prev.cropPositions\r\n                }],\r\n                hotStreakCount: newHotStreakCount,\r\n                isHotStreakActive: isHotStreakActive\r\n            }));\r\n        } else if (newGuesses.length >= 5 || isFatal) {\r\n            // Permadeath or Fatal Error (Consultant wrong guess)\r\n            setState(prev => ({\r\n                ...prev,\r\n                isGameOver: true,\r\n                highScoreModalShown: false, // Reset when game over happens\r\n                status: 'lost',\r\n                guesses: newGuesses,\r\n                history: [...prev.history, {\r\n                    gameId: currentGame.id,\r\n                    score: 0,\r\n                    status: 'lost',\r\n                    guesses: newGuesses,\r\n                    lifelinesUsed: prev.currentLevelLifelinesUsed,\r\n                    correctAnswer: currentGame.name,\r\n                    cropPositions: prev.cropPositions\r\n                }],\r\n                hotStreakCount: 0,\r\n                isHotStreakActive: false\r\n            }));\r\n        } else {\r\n            setState(prev => ({\r\n                ...prev,\r\n                guesses: newGuesses\r\n            }));\r\n        }\r\n    }, [state.isGameOver, state.status, currentGame, state.guesses]);\r\n\r\n    const skipGuess = useCallback(() => {\r\n        if (state.isGameOver || state.status !== 'playing' || !currentGame) return;\r\n\r\n        const newGuesses = [...state.guesses, { name: \"Skipped\", result: 'skipped' as GuessResult }];\r\n\r\n        if (newGuesses.length >= 5) {\r\n            // Permadeath\r\n            setState(prev => ({\r\n                ...prev,\r\n                isGameOver: true,\r\n                highScoreModalShown: false, // Reset when game over happens\r\n                status: 'lost',\r\n                guesses: newGuesses,\r\n                history: [...prev.history, {\r\n                    gameId: currentGame.id,\r\n                    score: 0,\r\n                    status: 'lost',\r\n                    guesses: newGuesses,\r\n                    lifelinesUsed: prev.currentLevelLifelinesUsed,\r\n                    correctAnswer: currentGame.name,\r\n                    cropPositions: prev.cropPositions\r\n                }],\r\n                hotStreakCount: 0,\r\n                isHotStreakActive: false\r\n            }));\r\n        } else {\r\n            setState(prev => ({\r\n                ...prev,\r\n                guesses: newGuesses\r\n            }));\r\n        }\r\n    }, [state.isGameOver, state.status, currentGame, state.guesses]);\r\n\r\n    const nextLevel = useCallback(() => {\r\n        if (state.isGameOver) {\r\n            // Reset run with a fresh shuffled game order (weighted)\r\n            const weightedIds = generateWeightedGameOrder(allGames);\r\n            setState({\r\n                ...INITIAL_STATE,\r\n                highScore: state.highScore,\r\n                highScoreModalShown: false, // Reset for new game\r\n                gameOrder: weightedIds,\r\n                cropPositions: Array(5).fill(0).map(() => generateRandomCrop())\r\n            });\r\n        } else {\r\n            setState(prev => ({\r\n                ...prev,\r\n                currentLevelIndex: prev.currentLevelIndex + 1,\r\n                status: 'playing',\r\n                guesses: [],\r\n                currentLevelLifelinesUsed: [], // Reset for new level\r\n                doubleTroubleGameId: null,\r\n                zoomOutActive: false,\r\n                cropPositions: Array(5).fill(0).map(() => generateRandomCrop())\r\n            }));\r\n        }\r\n    }, [state.isGameOver, state.highScore, allGames]);\r\n\r\n    const useLifeline = useCallback((type: LifelineType) => {\r\n        if (state.lifelines[type] <= 0 || state.status !== 'playing') return;\r\n\r\n        setState(prev => {\r\n            const newLifelines = { ...prev.lifelines, [type]: prev.lifelines[type] - 1 };\r\n            const newLifelinesUsed = [...prev.currentLevelLifelinesUsed, type];\r\n\r\n            if (type === 'skip') {\r\n                return {\r\n                    ...prev,\r\n                    lifelines: newLifelines,\r\n                    status: 'won', // Treat as won but 0 points\r\n                    history: [...prev.history, {\r\n                        gameId: currentGameId,\r\n                        score: 0,\r\n                        status: 'skipped',\r\n                        guesses: [...prev.guesses], // Current guesses at time of skip\r\n                        lifelinesUsed: newLifelinesUsed,\r\n                        correctAnswer: currentGame?.name || 'Unknown',\r\n                        cropPositions: prev.cropPositions\r\n                    }],\r\n                    currentLevelLifelinesUsed: newLifelinesUsed,\r\n                    hotStreakCount: 0,\r\n                    isHotStreakActive: false\r\n                };\r\n            }\r\n\r\n            if (type === 'zoom_out') {\r\n                return {\r\n                    ...prev,\r\n                    lifelines: newLifelines,\r\n                    currentLevelLifelinesUsed: newLifelinesUsed,\r\n                    zoomOutActive: true\r\n                };\r\n            }\r\n\r\n            return {\r\n                ...prev,\r\n                lifelines: newLifelines,\r\n                currentLevelLifelinesUsed: newLifelinesUsed\r\n            };\r\n        });\r\n    }, [state.lifelines, state.status, currentGameId, currentGame]);\r\n\r\n    const buyShopItem = useCallback((itemId: string, cost?: number) => {\r\n        const item = getShopItems().find(i => i.id === itemId);\r\n        if (!item) return;\r\n\r\n        const finalCost = cost !== undefined ? cost : item.cost;\r\n\r\n        if (state.score < finalCost) return; // Should be handled by UI too\r\n\r\n        setState(prev => {\r\n            const newLifelines = { ...prev.lifelines };\r\n            if (item.type === 'refill_skip') newLifelines.skip += 1;\r\n            if (item.type === 'refill_anagram') newLifelines.anagram += 1;\r\n            if (item.type === 'refill_consultant') newLifelines.consultant += 1;\r\n            if (item.type === 'refill_double_trouble') newLifelines.double_trouble += 1;\r\n            if (item.type === 'refill_zoom_out') newLifelines.zoom_out += 1;\r\n            if (item.type === 'refill_cover_peek') newLifelines.cover_peek += 1;\r\n            if (item.type === 'refill_synopsis') newLifelines.synopsis += 1;\r\n\r\n            return {\r\n                ...prev,\r\n                score: prev.score - finalCost, // finalCost is negative for bonus points (if bonus points could adhere to this, but they likely won't be discounted), so this works\r\n                lifelines: newLifelines\r\n            };\r\n        });\r\n    }, [state.score]);\r\n\r\n    const markHighScoreModalShown = useCallback(() => {\r\n        setState(prev => ({ ...prev, highScoreModalShown: true }));\r\n    }, []);\r\n\r\n    const markShopVisited = useCallback(() => {\r\n        setState(prev => ({ ...prev, lastShopStreak: prev.streak }));\r\n    }, []);\r\n\r\n    return {\r\n        state,\r\n        currentGame,\r\n        submitGuess,\r\n        skipGuess,\r\n        nextLevel,\r\n        useLifeline,\r\n        buyShopItem,\r\n        markHighScoreModalShown,\r\n        markShopVisited\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\hooks\\useEndlessStats.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\hooks\\useGameState.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\hooks\\useIsMobile.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\hooks\\useObfuscatedImages.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Johan\\repos\\guessthegame\\src\\hooks\\useObfuscatedImages.ts:31:13\n  29 |\n  30 |         if (!imageUrls || imageUrls.length === 0) {\n> 31 |             setBlobs([]);\n     |             ^^^^^^^^ Avoid calling setState() directly within an effect\n  32 |             return;\n  33 |         }\n  34 |","line":31,"column":13,"nodeType":null,"endLine":31,"endColumn":21},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'imageUrls'. Either include it or remove the dependency array.","line":80,"column":8,"nodeType":"ArrayExpression","endLine":80,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [currentKey, imageUrls]","fix":{"range":[3408,3420],"text":"[currentKey, imageUrls]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from 'react';\r\n\r\n/**\r\n * A hook that takes an array of image URLs and returns an array of Blob URLs.\r\n * This obfuscates the original source URL from the DOM.\r\n * \r\n * OPTIMIZATION: Loads images incrementally so the UI can display them as they arrive, \r\n * rather than waiting for all of them to finish (which was causing LCP delays).\r\n */\r\nexport function useObfuscatedImages(imageUrls: string[] | undefined): (string | null)[] {\r\n    // secure-key based on content to detect changes immediately\r\n    const currentKey = JSON.stringify(imageUrls || []);\r\n\r\n    // We need to keep track of mounted state to avoid setting state on unmounted components\r\n    // and to handle cleanup correctly.\r\n    const mountedRef = useRef(true);\r\n\r\n    // Initialize with nulls so we can render loading states or partial content immediately\r\n    const [blobs, setBlobs] = useState<(string | null)[]>(\r\n        imageUrls ? new Array(imageUrls.length).fill(null) : []\r\n    );\r\n\r\n    // Track the current key in a ref so we can ignore stale async results\r\n    const activeKeyRef = useRef(currentKey);\r\n\r\n    useEffect(() => {\r\n        mountedRef.current = true;\r\n        activeKeyRef.current = currentKey;\r\n\r\n        if (!imageUrls || imageUrls.length === 0) {\r\n            setBlobs([]);\r\n            return;\r\n        }\r\n\r\n        // Reset blobs slightly if the key changed (to clear old images), \r\n        // but try to keep the length consistent to avoid layout shift if possible\r\n        setBlobs(new Array(imageUrls.length).fill(null));\r\n\r\n        const fetchImage = async (url: string, index: number) => {\r\n            try {\r\n                const response = await fetch(url);\r\n                const blob = await response.blob();\r\n                const objectUrl = URL.createObjectURL(blob);\r\n\r\n                // Only update if we are still mounted and this result is for the current set of images\r\n                if (mountedRef.current && activeKeyRef.current === currentKey) {\r\n                    setBlobs(prev => {\r\n                        const next = [...prev];\r\n                        // If there was a previous blob at this index (rare race condition), revoke it? \r\n                        // Actually, the cleanup effect handles the *previous render's* blobs. \r\n                        // For the same render cycle, we just overwrite.\r\n                        next[index] = objectUrl;\r\n                        return next;\r\n                    });\r\n                } else {\r\n                    // Result came back too late or unmounted\r\n                    URL.revokeObjectURL(objectUrl);\r\n                }\r\n            } catch (error) {\r\n                console.error(`Failed to obfuscate image at index ${index}:`, url, error);\r\n                // Fallback to original URL on failure\r\n                if (mountedRef.current && activeKeyRef.current === currentKey) {\r\n                    setBlobs(prev => {\r\n                        const next = [...prev];\r\n                        next[index] = url;\r\n                        return next;\r\n                    });\r\n                }\r\n            }\r\n        };\r\n\r\n        // Fire off all requests in parallel, but handle them individually\r\n        imageUrls.forEach((url, index) => {\r\n            fetchImage(url, index);\r\n        });\r\n\r\n        return () => {\r\n            mountedRef.current = false;\r\n        };\r\n    }, [currentKey]); // Re-run when input URLs change\r\n\r\n    // Cleanup effect: Revoke all created object URLs when the component unmounts \r\n    // or when the blobs state updates (to clean up replaced blobs).\r\n    // Note: This is a bit tricky with incremental updates. We want to cleanup \r\n    // blobs that are *removed* from state.\r\n\r\n    // Simpler approach for cleanup: Just track all blobs ever created by this hook instance\r\n    // in a ref, and clean them up on unmount. \r\n    // However, react strict mode might double invoke. \r\n\r\n    // Let's stick to cleaning up what is currently in state when unmounting\r\n    // or when the key changes.\r\n    useEffect(() => {\r\n        return () => {\r\n            // We can't access the *latest* state here easily in the cleanup of the main effect \r\n            // without adding it to deps, which causes loops.\r\n            // Instead, we trust that when `blobs` updates, the previous values might need cleanup?\r\n            // No, standard `useEffect` cleanup runs before the *next* effect run.\r\n        };\r\n    }, []);\r\n\r\n    // We need a separate effect to clean up blobs when they are replaced or unmounted.\r\n    // It's safer to just track the previous blobs in a Ref for cleanup.\r\n    const activeBlobsRef = useRef<(string | null)[]>([]);\r\n\r\n    useEffect(() => {\r\n        // Update ref whenever state changes so we know what to clean up later\r\n        activeBlobsRef.current = blobs;\r\n    }, [blobs]);\r\n\r\n    useEffect(() => {\r\n        return () => {\r\n            // Cleanup all active blobs on unmount\r\n            activeBlobsRef.current.forEach(url => {\r\n                if (url && url.startsWith('blob:')) {\r\n                    URL.revokeObjectURL(url);\r\n                }\r\n            });\r\n        };\r\n    }, []);\r\n\r\n    return blobs;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\hooks\\useSettings.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":130,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":130,"endColumn":28}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, createContext, useContext } from 'react';\r\n\r\nconst STORAGE_KEY = 'guessthegame_settings';\r\nconst TUTORIAL_KEY = 'guessthegame_tutorial_seen';\r\nconst LOCK_TIP_KEY = 'guessthegame_lock_tip_seen';\r\n\r\nexport interface Settings {\r\n    nextLevelOnEnter: boolean;\r\n    skipOnEsc: boolean;\r\n    adminKey: string;\r\n    theme: 'default' | 'retro';\r\n    miniaturesInPicture: boolean;\r\n    miniaturesLocked: boolean;\r\n}\r\n\r\nconst DEFAULT_SETTINGS: Settings = {\r\n    nextLevelOnEnter: false,\r\n    skipOnEsc: false,\r\n    adminKey: '',\r\n    theme: 'default',\r\n    miniaturesInPicture: false,\r\n    miniaturesLocked: false\r\n};\r\n\r\ninterface SettingsContextType {\r\n    settings: Settings;\r\n    updateSetting: (key: keyof Settings, value: boolean | string) => void;\r\n    isSettingsOpen: boolean;\r\n    setIsSettingsOpen: (isOpen: boolean) => void;\r\n    // Tutorial state\r\n    hasSeenTutorial: boolean;\r\n    isTutorialOpen: boolean;\r\n    setIsTutorialOpen: (isOpen: boolean) => void;\r\n    markTutorialSeen: () => void;\r\n    // Lock tip state\r\n    hasSeenLockTip: boolean;\r\n    markLockTipSeen: () => void;\r\n}\r\n\r\nconst SettingsContext = createContext<SettingsContextType | undefined>(undefined);\r\n\r\nexport function SettingsProvider({ children }: { children: React.ReactNode }) {\r\n    const [settings, setSettings] = useState<Settings>(() => {\r\n        try {\r\n            const saved = localStorage.getItem(STORAGE_KEY);\r\n            if (saved) {\r\n                return { ...DEFAULT_SETTINGS, ...JSON.parse(saved) };\r\n            }\r\n        } catch (e) {\r\n            console.error('Failed to load settings:', e);\r\n        }\r\n        return DEFAULT_SETTINGS;\r\n    });\r\n\r\n    // Tutorial state\r\n    const [hasSeenTutorial, setHasSeenTutorial] = useState<boolean>(() => {\r\n        try {\r\n            return localStorage.getItem(TUTORIAL_KEY) === 'true';\r\n        } catch {\r\n            return false;\r\n        }\r\n    });\r\n    const [isTutorialOpen, setIsTutorialOpen] = useState(false);\r\n\r\n    // Lock tip state\r\n    const [hasSeenLockTip, setHasSeenLockTip] = useState<boolean>(() => {\r\n        try {\r\n            return localStorage.getItem(LOCK_TIP_KEY) === 'true';\r\n        } catch {\r\n            return false;\r\n        }\r\n    });\r\n\r\n    const markLockTipSeen = () => {\r\n        setHasSeenLockTip(true);\r\n        try {\r\n            localStorage.setItem(LOCK_TIP_KEY, 'true');\r\n        } catch (e) {\r\n            console.error('Failed to save lock tip state:', e);\r\n        }\r\n    };\r\n\r\n    // Auto-open tutorial for first-time users (after a brief delay for smooth UX)\r\n    useEffect(() => {\r\n        if (!hasSeenTutorial) {\r\n            const timer = setTimeout(() => {\r\n                setIsTutorialOpen(true);\r\n            }, 500);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [hasSeenTutorial]);\r\n\r\n    const markTutorialSeen = () => {\r\n        setHasSeenTutorial(true);\r\n        try {\r\n            localStorage.setItem(TUTORIAL_KEY, 'true');\r\n        } catch (e) {\r\n            console.error('Failed to save tutorial state:', e);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(settings));\r\n    }, [settings]);\r\n\r\n    const updateSetting = (key: keyof Settings, value: boolean | string) => {\r\n        setSettings(prev => ({ ...prev, [key]: value }));\r\n    };\r\n\r\n    const [isSettingsOpen, setIsSettingsOpen] = useState(false);\r\n\r\n    return (\r\n        <SettingsContext.Provider value={{\r\n            settings,\r\n            updateSetting,\r\n            isSettingsOpen,\r\n            setIsSettingsOpen,\r\n            hasSeenTutorial,\r\n            isTutorialOpen,\r\n            setIsTutorialOpen,\r\n            markTutorialSeen,\r\n            hasSeenLockTip,\r\n            markLockTipSeen\r\n        }}>\r\n            {children}\r\n        </SettingsContext.Provider>\r\n    );\r\n}\r\n\r\nexport function useSettings() {\r\n    const context = useContext(SettingsContext);\r\n    if (context === undefined) {\r\n        throw new Error('useSettings must be used within a SettingsProvider');\r\n    }\r\n    return context;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\utils\\api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\utils\\endlessUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\utils\\redaction.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\utils\\searchIndex.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\src\\utils\\seriesDetection.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":219,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":219,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":247,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":247,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Sophisticated game series detection utility\r\n * Handles various naming patterns to detect if two games belong to the same series\r\n */\r\n\r\n// Common words to ignore when comparing game names\r\nconst STOP_WORDS = new Set(['the', 'a', 'an', 'of', 'and', 'or', 'in', 'on', 'at', 'to', 'for']);\r\n\r\n// Iconic series names that should trigger a match if present in both games\r\n// This overrides standard logic to ensure obvious series matches are caught\r\nconst ICONIC_SERIES = [\r\n    \"Mario\", \"Zelda\", \"Metroid\", \"Pokemon\", \"Pokmon\", \"Final Fantasy\",\r\n    \"Resident Evil\", \"Silent Hill\", \"Street Fighter\", \"Sonic\", \"Halo\",\r\n    \"God of War\", \"Call of Duty\", \"Battlefield\", \"Assassin's Creed\",\r\n    \"Grand Theft Auto\", \"GTA\", \"Metal Gear\", \"Mortal Kombat\", \"Persona\",\r\n    \"Kingdom Hearts\", \"Dark Souls\", \"Elden Ring\", \"Bloodborne\", \"Mass Effect\",\r\n    \"Dragon Age\", \"Fallout\", \"Elder Scrolls\", \"Uncharted\", \"The Last of Us\",\r\n    \"Tomb Raider\", \"Civilization\", \"Warcraft\", \"StarCraft\", \"Diablo\",\r\n    \"Overwatch\", \"Doom\", \"Quake\", \"Wolfenstein\", \"Half-Life\", \"Portal\",\r\n    \"Left 4 Dead\", \"Counter-Strike\", \"Borderlands\", \"BioShock\", \"Spyro\",\r\n    \"Crash Bandicoot\", \"Ratchet & Clank\", \"Sly Cooper\", \"Need for Speed\",\r\n    \"Burnout\", \"Tony Hawk\", \"Guitar Hero\", \"Rock Band\", \"Lego\", \"Star Wars\",\r\n    \"Batman\", \"Spider-Man\", \"X-Men\", \"Avengers\", \"Mega Man\", \"Castlevania\",\r\n    \"Pac-Man\", \"Donkey Kong\", \"Sims\", \"Tetris\", \"Gran Turismo\", \"Forza\",\r\n    \"Fable\", \"Gears of War\", \"Splinter Cell\", \"Rainbow Six\", \"Ghost Recon\",\r\n    \"Hitman\", \"Devil May Cry\", \"Yakuza\", \"Like a Dragon\", \"Monster Hunter\",\r\n    \"Fire Emblem\", \"Xenoblade\", \"Dragon Quest\", \"Tales of\", \"Shin Megami Tensei\",\r\n    \"Sid Meier's\"\r\n];\r\n\r\n// Patterns to remove when normalizing game names\r\nconst REMOVAL_PATTERNS = [\r\n    // Numbers (both Arabic and Roman numerals at word boundaries)\r\n    /\\b(I{1,3}|IV|V|VI{0,3}|IX|X|XI{0,3}|XIV|XV|XVI{0,3}|XIX|XX)\\b/gi,\r\n    /\\b\\d+\\b/g,\r\n\r\n    // Edition markers\r\n    /\\b(HD|Remastered|Definitive|Enhanced|Special|Collector's?|Ultimate|Complete|GOTY|Game of the Year)\\s*(Edition)?\\b/gi,\r\n\r\n    // Platform indicators\r\n    /\\b(PS[1-5]|Xbox|PC|Windows|Mac|Linux|Switch|Mobile|iOS|Android)\\b/gi,\r\n\r\n    // Online/Offline indicators\r\n    /\\b(Online|Offline|Multiplayer|Single[ -]?player)\\b/gi,\r\n\r\n    // Years (1990-2099)\r\n    /\\b(19\\d{2}|20\\d{2})\\b/g,\r\n\r\n    // Common suffixes in parentheses\r\n    /\\([^)]*\\)/g,\r\n];\r\n\r\n/**\r\n * Escape special characters for regex\r\n */\r\nfunction escapeRegExp(string: string): string {\r\n    return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\r\n}\r\n\r\n/**\r\n * Normalize a game name by removing common variations\r\n */\r\nfunction normalizeGameName(name: string): string {\r\n    let normalized = name.trim();\r\n\r\n    // Remove leading articles (The, A, An)\r\n    // We do this BEFORE other removals to ensure clean start\r\n    normalized = normalized.replace(/^(The|A|An)\\s+/i, '');\r\n\r\n    // Apply all removal patterns\r\n    for (const pattern of REMOVAL_PATTERNS) {\r\n        normalized = normalized.replace(pattern, ' ');\r\n    }\r\n\r\n    // Clean up whitespace\r\n    normalized = normalized.replace(/\\s+/g, ' ').trim();\r\n\r\n    return normalized.toLowerCase();\r\n}\r\n\r\n/**\r\n * Extract the \"core\" series name by removing subtitles after colons\r\n */\r\nfunction extractCoreName(name: string): string {\r\n    // Remove everything after the first colon (subtitles)\r\n    const withoutSubtitle = name.split(':')[0].trim();\r\n\r\n    // Normalize it\r\n    return normalizeGameName(withoutSubtitle);\r\n}\r\n\r\n/**\r\n * Tokenize a game name into significant words\r\n */\r\nfunction tokenize(name: string): string[] {\r\n    return name\r\n        .toLowerCase()\r\n        .replace(/[^\\w\\s]/g, ' ') // Replace punctuation with spaces\r\n        .split(/\\s+/)\r\n        .filter(word => word.length > 0 && !STOP_WORDS.has(word));\r\n}\r\n\r\n/**\r\n * Calculate token overlap percentage between two game names\r\n */\r\nfunction calculateTokenOverlap(name1: string, name2: string): number {\r\n    const tokens1 = tokenize(name1);\r\n    const tokens2 = tokenize(name2);\r\n\r\n    if (tokens1.length === 0 || tokens2.length === 0) {\r\n        return 0;\r\n    }\r\n\r\n    // Count matching tokens\r\n    const set1 = new Set(tokens1);\r\n    const set2 = new Set(tokens2);\r\n    const intersection = new Set([...set1].filter(x => set2.has(x)));\r\n\r\n    // Calculate overlap as percentage of smaller set\r\n    const smaller = Math.min(set1.size, set2.size);\r\n    return intersection.size / smaller;\r\n}\r\n\r\n/**\r\n * Check if two strings are identical core names\r\n */\r\nfunction haveSameCoreName(name1: string, name2: string): boolean {\r\n    const core1 = extractCoreName(name1);\r\n    const core2 = extractCoreName(name2);\r\n\r\n    // Must be at least 3 characters to avoid false positives like \"The\", \"Star\", etc.\r\n    if (core1.length < 3 || core2.length < 3) {\r\n        return false;\r\n    }\r\n\r\n    return core1 === core2;\r\n}\r\n\r\n/**\r\n * Check if two strings have significant token overlap\r\n * This catches cases where core names might differ slightly but are clearly related\r\n */\r\nfunction haveSignificantOverlap(name1: string, name2: string): boolean {\r\n    const overlap = calculateTokenOverlap(name1, name2);\r\n    const tokens1 = tokenize(name1);\r\n    const tokens2 = tokenize(name2);\r\n\r\n    // Need at least 2 significant words and 70% overlap\r\n    // This avoids \"Star Fox\" matching \"Star Wars\" (only 1 word matches)\r\n    const minTokens = Math.min(tokens1.length, tokens2.length);\r\n\r\n    if (minTokens < 2) {\r\n        // For single-word names, require exact match\r\n        return overlap === 1.0;\r\n    }\r\n\r\n    // For multi-word names, require 70% overlap (lowered from 80% to be more aggressive)\r\n    // This means \"The Elder Scrolls: Skyrim\" and \"The Elder Scrolls: Online\"\r\n    // will match (both have \"elder\" and \"scrolls\" = 100% of significant words)\r\n    return overlap >= 0.7;\r\n}\r\n\r\n/**\r\n * Get the first significant word from a game name\r\n * This is crucial for series like \"Metro 2033\" vs \"Metro Exodus\"\r\n */\r\nfunction getFirstSignificantWord(name: string): string | null {\r\n    const tokens = tokenize(name);\r\n\r\n    // Return the first token that's at least 3 characters\r\n    // This avoids matching on short words like \"of\", \"the\", etc. that slipped through\r\n    for (const token of tokens) {\r\n        if (token.length >= 3) {\r\n            return token;\r\n        }\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\n/**\r\n * Check if two games have the same first significant word\r\n * This is a strong indicator of the same series (Metro, Fallout, Dark Souls, etc.)\r\n */\r\nfunction haveSameFirstWord(name1: string, name2: string): boolean {\r\n    const first1 = getFirstSignificantWord(name1);\r\n    const first2 = getFirstSignificantWord(name2);\r\n\r\n    if (!first1 || !first2) {\r\n        return false;\r\n    }\r\n\r\n    // Match if the first significant word is the same AND it's at least 4 characters\r\n    // This avoids false positives like \"Call of Duty\" vs \"Call of Juarez\"\r\n    // but catches \"Metro 2033\" vs \"Metro Exodus\", \"Fallout 3\" vs \"Fallout New Vegas\"\r\n    return first1 === first2 && first1.length >= 4;\r\n}\r\n\r\n/**\r\n * Check if one normalized name is a substring of the other\r\n * This catches \"Super Metroid\" vs \"Metroid\", \"The Legend of Zelda\" vs \"Zelda\"\r\n * Enforces word boundaries to avoid \"Metro\" matching \"Metroid\"\r\n */\r\nfunction haveSubstringMatch(name1: string, name2: string): boolean {\r\n    const n1 = normalizeGameName(name1);\r\n    const n2 = normalizeGameName(name2);\r\n\r\n    // Ignore very short names to prevent false positives\r\n    if (n1.length < 3 || n2.length < 3) {\r\n        return false;\r\n    }\r\n\r\n    // Check if shorter name is in longer name with word boundaries\r\n    const [shorter, longer] = n1.length < n2.length ? [n1, n2] : [n2, n1];\r\n\r\n    try {\r\n        const regex = new RegExp(`\\\\b${escapeRegExp(shorter)}\\\\b`, 'i');\r\n        return regex.test(longer);\r\n    } catch (e) {\r\n        // Fallback to simple inclusion if regex fails (unlikely)\r\n        return longer.includes(shorter);\r\n    }\r\n}\r\n\r\n/**\r\n * Check if both games belong to the same iconic series\r\n * This is a manual override for obvious series matches\r\n */\r\nfunction haveIconicSeriesMatch(name1: string, name2: string): boolean {\r\n    // Normalize names to remove accents (e.g. Pokmon -> Pokemon)\r\n    // This ensures we catch variations like \"Pokemon\" vs \"Pokmon\"\r\n    const normalize = (str: string) => str.toLowerCase().normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\");\r\n\r\n    const n1 = normalize(name1);\r\n    const n2 = normalize(name2);\r\n\r\n    for (const series of ICONIC_SERIES) {\r\n        const s = normalize(series);\r\n\r\n        // Check if the series name is present in BOTH game names\r\n        // Use word boundaries to prevent \"Halo\" matching \"Shallow\"\r\n        try {\r\n            const regex = new RegExp(`\\\\b${escapeRegExp(s)}\\\\b`, 'i');\r\n            if (regex.test(n1) && regex.test(n2)) {\r\n                return true;\r\n            }\r\n        } catch (e) {\r\n            // Fallback to simple inclusion\r\n            if (n1.includes(s) && n2.includes(s)) {\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\n/**\r\n * Main function: Check if two games have similar names (likely same series)\r\n */\r\nexport function areSimilarNames(gameName1: string, gameName2: string): boolean {\r\n    // Don't match if names are identical (same game)\r\n    if (gameName1.toLowerCase() === gameName2.toLowerCase()) {\r\n        return false;\r\n    }\r\n\r\n    // Strategy 0: Iconic Series Override (Highest Priority)\r\n    if (haveIconicSeriesMatch(gameName1, gameName2)) {\r\n        return true;\r\n    }\r\n\r\n    // Strategy 1: Check if they have the same core name (before the colon)\r\n    if (haveSameCoreName(gameName1, gameName2)) {\r\n        return true;\r\n    }\r\n\r\n    // Strategy 2: Check if the first significant word matches\r\n    // This catches \"Metro 2033\" vs \"Metro Exodus\", \"Fallout 3\" vs \"Fallout 4\"\r\n    if (haveSameFirstWord(gameName1, gameName2)) {\r\n        return true;\r\n    }\r\n\r\n    // Strategy 3: Check for significant token overlap\r\n    if (haveSignificantOverlap(gameName1, gameName2)) {\r\n        return true;\r\n    }\r\n\r\n    // Strategy 4: Substring match (Aggressive)\r\n    // Catches \"Super Metroid\" vs \"Metroid\"\r\n    if (haveSubstringMatch(gameName1, gameName2)) {\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\tailwind.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Johan\\repos\\guessthegame\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]