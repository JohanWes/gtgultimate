version: '3.8'

networks:
  proxynet:
    name: proxynet
    external: true

services:
  guessthegame:
    # Map external port to internal port
    # Format: "HOST_PORT:CONTAINER_PORT"
    # Change 5173 to any port you want to access on your host
    ports:
      - "${VITE_PORT:-5173}:${PORT:-3000}"
    build:
      context: .
      dockerfile: Dockerfile
      args:
        # These build args are baked into the built app
        VITE_IGDB_CLIENT_ID: "${VITE_IGDB_CLIENT_ID}"
        VITE_IGDB_CLIENT_SECRET: "${VITE_IGDB_CLIENT_SECRET}"
        VITE_PORT: "${VITE_PORT:-5173}"
    image: guessthegame
    container_name: guessthegame
    restart: unless-stopped
    environment:
      # Runtime environment variables
      NODE_ENV: "${NODE_ENV:-production}"
      HOST: "${HOST:-0.0.0.0}"
      PORT: "${PORT:-3000}"
      ADMIN_KEY: "${ADMIN_KEY}"
    volumes:
      # Mount data directory for persistent highscores
      - ./data:/app/data
    networks:
      - proxynet
